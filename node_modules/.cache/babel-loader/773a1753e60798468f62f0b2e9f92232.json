{"ast":null,"code":"var _jsxFileName = \"/home/me-admin/Downloads/my-app/src/Components/ColumnLeft/DialogsHeader.js\";\n\n/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { compose } from 'recompose';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport { withTranslation } from 'react-i18next';\nimport { Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle, Button, IconButton } from '@material-ui/core';\nimport SearchIcon from '@material-ui/icons/Search';\nimport CloseIcon from '@material-ui/icons/Close';\nimport SpeedDialIcon from '@material-ui/lab/SpeedDialIcon';\nimport MainMenuButton from './MainMenuButton';\nimport { isAuthorizationReady } from '../../Utils/Common';\nimport { ANIMATION_DURATION_100MS } from '../../Constants';\nimport AppStore from '../../Stores/ApplicationStore';\nimport TdLibController from '../../Controllers/TdLibController';\nimport '../ColumnMiddle/Header.css';\nimport { withRestoreRef, withSaveRef } from '../../Utils/HOC';\nconst styles = {\n  headerIconButton: {\n    margin: '8px 12px 8px 0'\n  },\n  dialogText: {\n    whiteSpace: 'pre-wrap'\n  }\n};\n\nclass DialogsHeader extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.onUpdateAuthorizationState = update => {\n      this.setState({\n        authorizationState: update.authorization_state\n      });\n    };\n\n    this.handleLogOut = () => {\n      this.setState({\n        open: true\n      });\n    };\n\n    this.handleDone = () => {\n      this.handleClose();\n      TdLibController.logOut();\n    };\n\n    this.handleClose = () => {\n      this.setState({\n        open: false\n      });\n    };\n\n    this.handleSearch = () => {\n      const _this$props = this.props,\n            onSearch = _this$props.onSearch,\n            openSearch = _this$props.openSearch;\n      const authorizationState = this.state.authorizationState;\n      if (!isAuthorizationReady(authorizationState)) return;\n      onSearch(!openSearch);\n    };\n\n    this.handleKeyDown = event => {\n      if (event.keyCode === 13) {\n        event.preventDefault();\n      }\n    };\n\n    this.handleKeyUp = () => {\n      const onSearchTextChange = this.props.onSearchTextChange;\n      const searchInput = this.searchInputRef.current;\n      const innerText = searchInput.innerText;\n      const innerHTML = searchInput.innerHTML;\n\n      if (innerHTML && (innerHTML === '<br>' || innerHTML === '<div><br></div>')) {\n        searchInput.innerHTML = '';\n      }\n\n      onSearchTextChange(innerText);\n    };\n\n    this.handlePaste = event => {\n      const plainText = event.clipboardData.getData('text/plain');\n\n      if (plainText) {\n        event.preventDefault();\n        document.execCommand('insertHTML', false, plainText);\n      }\n    };\n\n    this.searchInputRef = React.createRef();\n    this.state = {\n      authorizationState: AppStore.getAuthorizationState(),\n      open: false\n    };\n  }\n\n  setInitQuery(query) {\n    const onSearchTextChange = this.props.onSearchTextChange;\n    const searchInput = this.searchInputRef.current;\n\n    if (searchInput) {\n      searchInput.innerText = query;\n\n      if (searchInput.childNodes.length > 0) {\n        const range = document.createRange();\n        range.setStart(searchInput.childNodes[0], searchInput.childNodes[0].length);\n        range.collapse(true);\n        const selection = window.getSelection();\n        selection.removeAllRanges();\n        selection.addRange(range);\n      }\n\n      searchInput.focus();\n      onSearchTextChange(query);\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n    const _this$props2 = this.props,\n          openSearch = _this$props2.openSearch,\n          text = _this$props2.text;\n\n    if (openSearch) {\n      const searchInput = this.searchInputRef.current;\n\n      if (openSearch !== prevProps.openSearch) {\n        setTimeout(() => {\n          if (searchInput) {\n            searchInput.focus();\n          }\n        }, ANIMATION_DURATION_100MS);\n      }\n    }\n  }\n\n  componentDidMount() {\n    AppStore.on('updateAuthorizationState', this.onUpdateAuthorizationState);\n  }\n\n  componentWillUnmount() {\n    AppStore.removeListener('updateAuthorizationState', this.onUpdateAuthorizationState);\n  }\n\n  render() {\n    const _this$props3 = this.props,\n          classes = _this$props3.classes,\n          onClick = _this$props3.onClick,\n          openSearch = _this$props3.openSearch,\n          t = _this$props3.t;\n    const open = this.state.open;\n    const confirmLogoutDialog = open ? React.createElement(Dialog, {\n      transitionDuration: 0,\n      open: open,\n      onClose: this.handleClose,\n      \"aria-labelledby\": \"form-dialog-title\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155\n      },\n      __self: this\n    }, React.createElement(DialogTitle, {\n      id: \"form-dialog-title\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156\n      },\n      __self: this\n    }, t('AppName')), React.createElement(DialogContent, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157\n      },\n      __self: this\n    }, React.createElement(DialogContentText, {\n      className: classes.dialogText,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158\n      },\n      __self: this\n    }, t('AreYouSureLogout'))), React.createElement(DialogActions, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160\n      },\n      __self: this\n    }, React.createElement(Button, {\n      onClick: this.handleClose,\n      color: \"primary\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161\n      },\n      __self: this\n    }, t('Cancel')), React.createElement(Button, {\n      onClick: this.handleDone,\n      color: \"primary\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164\n      },\n      __self: this\n    }, t('Ok')))) : null;\n    return React.createElement(\"div\", {\n      className: \"header-master\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172\n      },\n      __self: this\n    }, !openSearch ? React.createElement(React.Fragment, null, React.createElement(MainMenuButton, {\n      onLogOut: this.handleLogOut,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175\n      },\n      __self: this\n    }), confirmLogoutDialog, React.createElement(\"div\", {\n      className: \"header-status grow cursor-pointer\",\n      onClick: onClick,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      className: \"header-status-content\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178\n      },\n      __self: this\n    }, t('AppName')))) : React.createElement(React.Fragment, null, React.createElement(\"div\", {\n      className: \"header-search-input grow\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      id: \"header-search-inputbox\",\n      ref: this.searchInputRef,\n      placeholder: t('Search'),\n      contentEditable: true,\n      suppressContentEditableWarning: true,\n      onKeyDown: this.handleKeyDown,\n      onKeyUp: this.handleKeyUp,\n      onPaste: this.handlePaste,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184\n      },\n      __self: this\n    }))), React.createElement(IconButton, {\n      className: classes.headerIconButton,\n      \"aria-label\": t('Search'),\n      onMouseDown: this.handleSearch,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197\n      },\n      __self: this\n    }, React.createElement(SpeedDialIcon, {\n      open: openSearch,\n      icon: React.createElement(SearchIcon, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201\n        },\n        __self: this\n      }),\n      openIcon: React.createElement(CloseIcon, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201\n        },\n        __self: this\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201\n      },\n      __self: this\n    })));\n  }\n\n}\n\nDialogsHeader.propTypes = {\n  openSearch: PropTypes.bool.isRequired,\n  onClick: PropTypes.func.isRequired,\n  onSearch: PropTypes.func.isRequired,\n  onSearchTextChange: PropTypes.func.isRequired\n};\nconst enhance = compose(withSaveRef(), withTranslation(), withStyles(styles), withRestoreRef());\nexport default enhance(DialogsHeader);","map":{"version":3,"sources":["/home/me-admin/Downloads/my-app/src/Components/ColumnLeft/DialogsHeader.js"],"names":["React","PropTypes","compose","withStyles","withTranslation","Dialog","DialogActions","DialogContent","DialogContentText","DialogTitle","Button","IconButton","SearchIcon","CloseIcon","SpeedDialIcon","MainMenuButton","isAuthorizationReady","ANIMATION_DURATION_100MS","AppStore","TdLibController","withRestoreRef","withSaveRef","styles","headerIconButton","margin","dialogText","whiteSpace","DialogsHeader","Component","constructor","props","onUpdateAuthorizationState","update","setState","authorizationState","authorization_state","handleLogOut","open","handleDone","handleClose","logOut","handleSearch","onSearch","openSearch","state","handleKeyDown","event","keyCode","preventDefault","handleKeyUp","onSearchTextChange","searchInput","searchInputRef","current","innerText","innerHTML","handlePaste","plainText","clipboardData","getData","document","execCommand","createRef","getAuthorizationState","setInitQuery","query","childNodes","length","range","createRange","setStart","collapse","selection","window","getSelection","removeAllRanges","addRange","focus","componentDidUpdate","prevProps","prevState","snapshot","text","setTimeout","componentDidMount","on","componentWillUnmount","removeListener","render","classes","onClick","t","confirmLogoutDialog","propTypes","bool","isRequired","func","enhance"],"mappings":";;AAAA;;;;;;AAOA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,SAASC,OAAT,QAAwB,WAAxB;AACA,OAAOC,UAAP,MAAuB,qCAAvB;AACA,SAASC,eAAT,QAAgC,eAAhC;AACA,SACIC,MADJ,EAEIC,aAFJ,EAGIC,aAHJ,EAIIC,iBAJJ,EAKIC,WALJ,EAMIC,MANJ,EAOIC,UAPJ,QAQO,mBARP;AASA,OAAOC,UAAP,MAAuB,2BAAvB;AACA,OAAOC,SAAP,MAAsB,0BAAtB;AACA,OAAOC,aAAP,MAA0B,gCAA1B;AACA,OAAOC,cAAP,MAA2B,kBAA3B;AACA,SAASC,oBAAT,QAAqC,oBAArC;AACA,SAASC,wBAAT,QAAyC,iBAAzC;AACA,OAAOC,QAAP,MAAqB,+BAArB;AACA,OAAOC,eAAP,MAA4B,mCAA5B;AACA,OAAO,4BAAP;AACA,SAASC,cAAT,EAAyBC,WAAzB,QAA4C,iBAA5C;AAEA,MAAMC,MAAM,GAAG;AACXC,EAAAA,gBAAgB,EAAE;AACdC,IAAAA,MAAM,EAAE;AADM,GADP;AAIXC,EAAAA,UAAU,EAAE;AACRC,IAAAA,UAAU,EAAE;AADJ;AAJD,CAAf;;AASA,MAAMC,aAAN,SAA4B3B,KAAK,CAAC4B,SAAlC,CAA4C;AACxCC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACf,UAAMA,KAAN;;AADe,SAsDnBC,0BAtDmB,GAsDUC,MAAM,IAAI;AACnC,WAAKC,QAAL,CAAc;AAAEC,QAAAA,kBAAkB,EAAEF,MAAM,CAACG;AAA7B,OAAd;AACH,KAxDkB;;AAAA,SA0DnBC,YA1DmB,GA0DJ,MAAM;AACjB,WAAKH,QAAL,CAAc;AAAEI,QAAAA,IAAI,EAAE;AAAR,OAAd;AACH,KA5DkB;;AAAA,SA8DnBC,UA9DmB,GA8DN,MAAM;AACf,WAAKC,WAAL;AACApB,MAAAA,eAAe,CAACqB,MAAhB;AACH,KAjEkB;;AAAA,SAmEnBD,WAnEmB,GAmEL,MAAM;AAChB,WAAKN,QAAL,CAAc;AAAEI,QAAAA,IAAI,EAAE;AAAR,OAAd;AACH,KArEkB;;AAAA,SAuEnBI,YAvEmB,GAuEJ,MAAM;AAAA,0BACgB,KAAKX,KADrB;AAAA,YACTY,QADS,eACTA,QADS;AAAA,YACCC,UADD,eACCA,UADD;AAAA,YAETT,kBAFS,GAEc,KAAKU,KAFnB,CAETV,kBAFS;AAGjB,UAAI,CAAClB,oBAAoB,CAACkB,kBAAD,CAAzB,EAA+C;AAE/CQ,MAAAA,QAAQ,CAAC,CAACC,UAAF,CAAR;AACH,KA7EkB;;AAAA,SA+EnBE,aA/EmB,GA+EHC,KAAK,IAAI;AACrB,UAAIA,KAAK,CAACC,OAAN,KAAkB,EAAtB,EAA0B;AACtBD,QAAAA,KAAK,CAACE,cAAN;AACH;AACJ,KAnFkB;;AAAA,SAqFnBC,WArFmB,GAqFL,MAAM;AAAA,YACRC,kBADQ,GACe,KAAKpB,KADpB,CACRoB,kBADQ;AAEhB,YAAMC,WAAW,GAAG,KAAKC,cAAL,CAAoBC,OAAxC;AAEA,YAAMC,SAAS,GAAGH,WAAW,CAACG,SAA9B;AACA,YAAMC,SAAS,GAAGJ,WAAW,CAACI,SAA9B;;AAEA,UAAIA,SAAS,KAAKA,SAAS,KAAK,MAAd,IAAwBA,SAAS,KAAK,iBAA3C,CAAb,EAA4E;AACxEJ,QAAAA,WAAW,CAACI,SAAZ,GAAwB,EAAxB;AACH;;AAEDL,MAAAA,kBAAkB,CAACI,SAAD,CAAlB;AACH,KAjGkB;;AAAA,SAmGnBE,WAnGmB,GAmGLV,KAAK,IAAI;AACnB,YAAMW,SAAS,GAAGX,KAAK,CAACY,aAAN,CAAoBC,OAApB,CAA4B,YAA5B,CAAlB;;AACA,UAAIF,SAAJ,EAAe;AACXX,QAAAA,KAAK,CAACE,cAAN;AACAY,QAAAA,QAAQ,CAACC,WAAT,CAAqB,YAArB,EAAmC,KAAnC,EAA0CJ,SAA1C;AACH;AACJ,KAzGkB;;AAGf,SAAKL,cAAL,GAAsBpD,KAAK,CAAC8D,SAAN,EAAtB;AAEA,SAAKlB,KAAL,GAAa;AACTV,MAAAA,kBAAkB,EAAEhB,QAAQ,CAAC6C,qBAAT,EADX;AAET1B,MAAAA,IAAI,EAAE;AAFG,KAAb;AAIH;;AAED2B,EAAAA,YAAY,CAACC,KAAD,EAAQ;AAAA,UACRf,kBADQ,GACe,KAAKpB,KADpB,CACRoB,kBADQ;AAGhB,UAAMC,WAAW,GAAG,KAAKC,cAAL,CAAoBC,OAAxC;;AACA,QAAIF,WAAJ,EAAiB;AACbA,MAAAA,WAAW,CAACG,SAAZ,GAAwBW,KAAxB;;AACA,UAAId,WAAW,CAACe,UAAZ,CAAuBC,MAAvB,GAAgC,CAApC,EAAuC;AACnC,cAAMC,KAAK,GAAGR,QAAQ,CAACS,WAAT,EAAd;AACAD,QAAAA,KAAK,CAACE,QAAN,CAAenB,WAAW,CAACe,UAAZ,CAAuB,CAAvB,CAAf,EAA0Cf,WAAW,CAACe,UAAZ,CAAuB,CAAvB,EAA0BC,MAApE;AACAC,QAAAA,KAAK,CAACG,QAAN,CAAe,IAAf;AAEA,cAAMC,SAAS,GAAGC,MAAM,CAACC,YAAP,EAAlB;AACAF,QAAAA,SAAS,CAACG,eAAV;AACAH,QAAAA,SAAS,CAACI,QAAV,CAAmBR,KAAnB;AACH;;AACDjB,MAAAA,WAAW,CAAC0B,KAAZ;AACA3B,MAAAA,kBAAkB,CAACe,KAAD,CAAlB;AACH;AACJ;;AAEDa,EAAAA,kBAAkB,CAACC,SAAD,EAAYC,SAAZ,EAAuBC,QAAvB,EAAiC;AAAA,yBAClB,KAAKnD,KADa;AAAA,UACvCa,UADuC,gBACvCA,UADuC;AAAA,UAC3BuC,IAD2B,gBAC3BA,IAD2B;;AAG/C,QAAIvC,UAAJ,EAAgB;AACZ,YAAMQ,WAAW,GAAG,KAAKC,cAAL,CAAoBC,OAAxC;;AACA,UAAIV,UAAU,KAAKoC,SAAS,CAACpC,UAA7B,EAAyC;AACrCwC,QAAAA,UAAU,CAAC,MAAM;AACb,cAAIhC,WAAJ,EAAiB;AACbA,YAAAA,WAAW,CAAC0B,KAAZ;AACH;AACJ,SAJS,EAIP5D,wBAJO,CAAV;AAKH;AACJ;AACJ;;AAEDmE,EAAAA,iBAAiB,GAAG;AAChBlE,IAAAA,QAAQ,CAACmE,EAAT,CAAY,0BAAZ,EAAwC,KAAKtD,0BAA7C;AACH;;AAEDuD,EAAAA,oBAAoB,GAAG;AACnBpE,IAAAA,QAAQ,CAACqE,cAAT,CAAwB,0BAAxB,EAAoD,KAAKxD,0BAAzD;AACH;;AAuDDyD,EAAAA,MAAM,GAAG;AAAA,yBACuC,KAAK1D,KAD5C;AAAA,UACG2D,OADH,gBACGA,OADH;AAAA,UACYC,OADZ,gBACYA,OADZ;AAAA,UACqB/C,UADrB,gBACqBA,UADrB;AAAA,UACiCgD,CADjC,gBACiCA,CADjC;AAAA,UAEGtD,IAFH,GAEY,KAAKO,KAFjB,CAEGP,IAFH;AAIL,UAAMuD,mBAAmB,GAAGvD,IAAI,GAC5B,oBAAC,MAAD;AAAQ,MAAA,kBAAkB,EAAE,CAA5B;AAA+B,MAAA,IAAI,EAAEA,IAArC;AAA2C,MAAA,OAAO,EAAE,KAAKE,WAAzD;AAAsE,yBAAgB,mBAAtF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI,oBAAC,WAAD;AAAa,MAAA,EAAE,EAAC,mBAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAqCoD,CAAC,CAAC,SAAD,CAAtC,CADJ,EAEI,oBAAC,aAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI,oBAAC,iBAAD;AAAmB,MAAA,SAAS,EAAEF,OAAO,CAAChE,UAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAmDkE,CAAC,CAAC,kBAAD,CAApD,CADJ,CAFJ,EAKI,oBAAC,aAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI,oBAAC,MAAD;AAAQ,MAAA,OAAO,EAAE,KAAKpD,WAAtB;AAAmC,MAAA,KAAK,EAAC,SAAzC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACKoD,CAAC,CAAC,QAAD,CADN,CADJ,EAII,oBAAC,MAAD;AAAQ,MAAA,OAAO,EAAE,KAAKrD,UAAtB;AAAkC,MAAA,KAAK,EAAC,SAAxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACKqD,CAAC,CAAC,IAAD,CADN,CAJJ,CALJ,CAD4B,GAe5B,IAfJ;AAiBA,WACI;AAAK,MAAA,SAAS,EAAC,eAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACK,CAAChD,UAAD,GACG,0CACI,oBAAC,cAAD;AAAgB,MAAA,QAAQ,EAAE,KAAKP,YAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADJ,EAEKwD,mBAFL,EAGI;AAAK,MAAA,SAAS,EAAC,mCAAf;AAAmD,MAAA,OAAO,EAAEF,OAA5D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAM,MAAA,SAAS,EAAC,uBAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAyCC,CAAC,CAAC,SAAD,CAA1C,CADJ,CAHJ,CADH,GASG,0CACI;AAAK,MAAA,SAAS,EAAC,0BAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AACI,MAAA,EAAE,EAAC,wBADP;AAEI,MAAA,GAAG,EAAE,KAAKvC,cAFd;AAGI,MAAA,WAAW,EAAEuC,CAAC,CAAC,QAAD,CAHlB;AAII,MAAA,eAAe,MAJnB;AAKI,MAAA,8BAA8B,MALlC;AAMI,MAAA,SAAS,EAAE,KAAK9C,aANpB;AAOI,MAAA,OAAO,EAAE,KAAKI,WAPlB;AAQI,MAAA,OAAO,EAAE,KAAKO,WARlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADJ,CADJ,CAVR,EAyBI,oBAAC,UAAD;AACI,MAAA,SAAS,EAAEiC,OAAO,CAAClE,gBADvB;AAEI,oBAAYoE,CAAC,CAAC,QAAD,CAFjB;AAGI,MAAA,WAAW,EAAE,KAAKlD,YAHtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAII,oBAAC,aAAD;AAAe,MAAA,IAAI,EAAEE,UAArB;AAAiC,MAAA,IAAI,EAAE,oBAAC,UAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAvC;AAAuD,MAAA,QAAQ,EAAE,oBAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAjE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAJJ,CAzBJ,CADJ;AAkCH;;AAnKuC;;AAsK5ChB,aAAa,CAACkE,SAAd,GAA0B;AACtBlD,EAAAA,UAAU,EAAE1C,SAAS,CAAC6F,IAAV,CAAeC,UADL;AAEtBL,EAAAA,OAAO,EAAEzF,SAAS,CAAC+F,IAAV,CAAeD,UAFF;AAGtBrD,EAAAA,QAAQ,EAAEzC,SAAS,CAAC+F,IAAV,CAAeD,UAHH;AAItB7C,EAAAA,kBAAkB,EAAEjD,SAAS,CAAC+F,IAAV,CAAeD;AAJb,CAA1B;AAOA,MAAME,OAAO,GAAG/F,OAAO,CACnBmB,WAAW,EADQ,EAEnBjB,eAAe,EAFI,EAGnBD,UAAU,CAACmB,MAAD,CAHS,EAInBF,cAAc,EAJK,CAAvB;AAOA,eAAe6E,OAAO,CAACtE,aAAD,CAAtB","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { compose } from 'recompose';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport { withTranslation } from 'react-i18next';\nimport {\n    Dialog,\n    DialogActions,\n    DialogContent,\n    DialogContentText,\n    DialogTitle,\n    Button,\n    IconButton\n} from '@material-ui/core';\nimport SearchIcon from '@material-ui/icons/Search';\nimport CloseIcon from '@material-ui/icons/Close';\nimport SpeedDialIcon from '@material-ui/lab/SpeedDialIcon';\nimport MainMenuButton from './MainMenuButton';\nimport { isAuthorizationReady } from '../../Utils/Common';\nimport { ANIMATION_DURATION_100MS } from '../../Constants';\nimport AppStore from '../../Stores/ApplicationStore';\nimport TdLibController from '../../Controllers/TdLibController';\nimport '../ColumnMiddle/Header.css';\nimport { withRestoreRef, withSaveRef } from '../../Utils/HOC';\n\nconst styles = {\n    headerIconButton: {\n        margin: '8px 12px 8px 0'\n    },\n    dialogText: {\n        whiteSpace: 'pre-wrap'\n    }\n};\n\nclass DialogsHeader extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.searchInputRef = React.createRef();\n\n        this.state = {\n            authorizationState: AppStore.getAuthorizationState(),\n            open: false\n        };\n    }\n\n    setInitQuery(query) {\n        const { onSearchTextChange } = this.props;\n\n        const searchInput = this.searchInputRef.current;\n        if (searchInput) {\n            searchInput.innerText = query;\n            if (searchInput.childNodes.length > 0) {\n                const range = document.createRange();\n                range.setStart(searchInput.childNodes[0], searchInput.childNodes[0].length);\n                range.collapse(true);\n\n                const selection = window.getSelection();\n                selection.removeAllRanges();\n                selection.addRange(range);\n            }\n            searchInput.focus();\n            onSearchTextChange(query);\n        }\n    }\n\n    componentDidUpdate(prevProps, prevState, snapshot) {\n        const { openSearch, text } = this.props;\n\n        if (openSearch) {\n            const searchInput = this.searchInputRef.current;\n            if (openSearch !== prevProps.openSearch) {\n                setTimeout(() => {\n                    if (searchInput) {\n                        searchInput.focus();\n                    }\n                }, ANIMATION_DURATION_100MS);\n            }\n        }\n    }\n\n    componentDidMount() {\n        AppStore.on('updateAuthorizationState', this.onUpdateAuthorizationState);\n    }\n\n    componentWillUnmount() {\n        AppStore.removeListener('updateAuthorizationState', this.onUpdateAuthorizationState);\n    }\n\n    onUpdateAuthorizationState = update => {\n        this.setState({ authorizationState: update.authorization_state });\n    };\n\n    handleLogOut = () => {\n        this.setState({ open: true });\n    };\n\n    handleDone = () => {\n        this.handleClose();\n        TdLibController.logOut();\n    };\n\n    handleClose = () => {\n        this.setState({ open: false });\n    };\n\n    handleSearch = () => {\n        const { onSearch, openSearch } = this.props;\n        const { authorizationState } = this.state;\n        if (!isAuthorizationReady(authorizationState)) return;\n\n        onSearch(!openSearch);\n    };\n\n    handleKeyDown = event => {\n        if (event.keyCode === 13) {\n            event.preventDefault();\n        }\n    };\n\n    handleKeyUp = () => {\n        const { onSearchTextChange } = this.props;\n        const searchInput = this.searchInputRef.current;\n\n        const innerText = searchInput.innerText;\n        const innerHTML = searchInput.innerHTML;\n\n        if (innerHTML && (innerHTML === '<br>' || innerHTML === '<div><br></div>')) {\n            searchInput.innerHTML = '';\n        }\n\n        onSearchTextChange(innerText);\n    };\n\n    handlePaste = event => {\n        const plainText = event.clipboardData.getData('text/plain');\n        if (plainText) {\n            event.preventDefault();\n            document.execCommand('insertHTML', false, plainText);\n        }\n    };\n\n    render() {\n        const { classes, onClick, openSearch, t } = this.props;\n        const { open } = this.state;\n\n        const confirmLogoutDialog = open ? (\n            <Dialog transitionDuration={0} open={open} onClose={this.handleClose} aria-labelledby='form-dialog-title'>\n                <DialogTitle id='form-dialog-title'>{t('AppName')}</DialogTitle>\n                <DialogContent>\n                    <DialogContentText className={classes.dialogText}>{t('AreYouSureLogout')}</DialogContentText>\n                </DialogContent>\n                <DialogActions>\n                    <Button onClick={this.handleClose} color='primary'>\n                        {t('Cancel')}\n                    </Button>\n                    <Button onClick={this.handleDone} color='primary'>\n                        {t('Ok')}\n                    </Button>\n                </DialogActions>\n            </Dialog>\n        ) : null;\n\n        return (\n            <div className='header-master'>\n                {!openSearch ? (\n                    <>\n                        <MainMenuButton onLogOut={this.handleLogOut} />\n                        {confirmLogoutDialog}\n                        <div className='header-status grow cursor-pointer' onClick={onClick}>\n                            <span className='header-status-content'>{t('AppName')}</span>\n                        </div>\n                    </>\n                ) : (\n                    <>\n                        <div className='header-search-input grow'>\n                            <div\n                                id='header-search-inputbox'\n                                ref={this.searchInputRef}\n                                placeholder={t('Search')}\n                                contentEditable\n                                suppressContentEditableWarning\n                                onKeyDown={this.handleKeyDown}\n                                onKeyUp={this.handleKeyUp}\n                                onPaste={this.handlePaste}\n                            />\n                        </div>\n                    </>\n                )}\n                <IconButton\n                    className={classes.headerIconButton}\n                    aria-label={t('Search')}\n                    onMouseDown={this.handleSearch}>\n                    <SpeedDialIcon open={openSearch} icon={<SearchIcon />} openIcon={<CloseIcon />} />\n                </IconButton>\n            </div>\n        );\n    }\n}\n\nDialogsHeader.propTypes = {\n    openSearch: PropTypes.bool.isRequired,\n    onClick: PropTypes.func.isRequired,\n    onSearch: PropTypes.func.isRequired,\n    onSearchTextChange: PropTypes.func.isRequired\n};\n\nconst enhance = compose(\n    withSaveRef(),\n    withTranslation(),\n    withStyles(styles),\n    withRestoreRef()\n);\n\nexport default enhance(DialogsHeader);\n"]},"metadata":{},"sourceType":"module"}