{"ast":null,"code":"import _classCallCheck from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import FileProgress from'./FileProgress';import{getChatUserId}from'../../Utils/Chat';import{PROFILE_PHOTO_BIG_SIZE}from'../../Constants';import FileStore from'../../Stores/FileStore';import'./ProfileMediaViewer.css';var ProfileMediaViewerContent=/*#__PURE__*/function(_React$Component){_inherits(ProfileMediaViewerContent,_React$Component);function ProfileMediaViewerContent(props){var _this;_classCallCheck(this,ProfileMediaViewerContent);_this=_possibleConstructorReturn(this,_getPrototypeOf(ProfileMediaViewerContent).call(this,props));_this.onClientUpdateChatBlob=function(update){var _this$props=_this.props,chatId=_this$props.chatId,photo=_this$props.photo;if(chatId===update.chatId&&photo.big.id===update.fileId){var file=FileStore.get(update.fileId)||_this.state.file;_this.setState({file:file});}};_this.onClientUpdateUserBlob=function(update){var _this$props2=_this.props,chatId=_this$props2.chatId,photo=_this$props2.photo;var userId=getChatUserId(chatId);if(userId===update.userId&&photo.big.id===update.fileId){var file=FileStore.get(update.fileId)||_this.state.file;_this.setState({file:file});}};_this.handleContentClick=function(event){if(event)event.stopPropagation();_this.props.onClick(event);};var _this$props3=_this.props,_chatId=_this$props3.chatId,_photo=_this$props3.photo;var _file=_photo.big;_file=FileStore.get(_file.id)||_file;_this.state={prevChatId:_chatId,prevPhoto:_photo,width:PROFILE_PHOTO_BIG_SIZE,height:PROFILE_PHOTO_BIG_SIZE,file:_file};return _this;}_createClass(ProfileMediaViewerContent,[{key:\"componentDidMount\",value:function componentDidMount(){FileStore.on('clientUpdateChatBlob',this.onClientUpdateChatBlob);FileStore.on('clientUpdateUserBlob',this.onClientUpdateUserBlob);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){FileStore.removeListener('clientUpdateChatBlob',this.onClientUpdateChatBlob);FileStore.removeListener('clientUpdateUserBlob',this.onClientUpdateUserBlob);}},{key:\"render\",value:function render(){var _this$state=this.state,width=_this$state.width,height=_this$state.height,file=_this$state.file;if(!file)return null;var blob=FileStore.getBlob(file.id)||file.blob;var src=FileStore.getBlobUrl(blob);console.log('img.render ',src);return React.createElement(\"div\",{className:\"media-viewer-content\"},React.createElement(\"img\",{className:\"media-viewer-content-image\",src:src,alt:\"\",onClick:this.handleContentClick}),React.createElement(FileProgress,{file:file}));}}],[{key:\"getDerivedStateFromProps\",value:function getDerivedStateFromProps(props,state){var chatId=props.chatId,photo=props.photo;if(chatId!==state.prevChatId||photo!==state.prevPhoto){return{prevChatId:chatId,prevPhoto:photo,width:PROFILE_PHOTO_BIG_SIZE,height:PROFILE_PHOTO_BIG_SIZE,file:photo.big};}return null;}}]);return ProfileMediaViewerContent;}(React.Component);export default ProfileMediaViewerContent;","map":{"version":3,"sources":["/Users/yosuahalim/Documents/Projects/telegram-app/src/Components/Viewer/ProfileMediaViewerContent.js"],"names":["React","FileProgress","getChatUserId","PROFILE_PHOTO_BIG_SIZE","FileStore","ProfileMediaViewerContent","props","onClientUpdateChatBlob","update","chatId","photo","big","id","fileId","file","get","state","setState","onClientUpdateUserBlob","userId","handleContentClick","event","stopPropagation","onClick","prevChatId","prevPhoto","width","height","on","removeListener","blob","getBlob","src","getBlobUrl","console","log","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport FileProgress from './FileProgress';\nimport { getChatUserId } from '../../Utils/Chat';\nimport { PROFILE_PHOTO_BIG_SIZE } from '../../Constants';\nimport FileStore from '../../Stores/FileStore';\nimport './ProfileMediaViewer.css';\n\nclass ProfileMediaViewerContent extends React.Component {\n    constructor(props) {\n        super(props);\n\n        const { chatId, photo } = this.props;\n\n        let { big: file } = photo;\n        file = FileStore.get(file.id) || file;\n\n        this.state = {\n            prevChatId: chatId,\n            prevPhoto: photo,\n            width: PROFILE_PHOTO_BIG_SIZE,\n            height: PROFILE_PHOTO_BIG_SIZE,\n            file: file\n        };\n    }\n\n    static getDerivedStateFromProps(props, state) {\n        const { chatId, photo } = props;\n\n        if (chatId !== state.prevChatId || photo !== state.prevPhoto) {\n            return {\n                prevChatId: chatId,\n                prevPhoto: photo,\n                width: PROFILE_PHOTO_BIG_SIZE,\n                height: PROFILE_PHOTO_BIG_SIZE,\n                file: photo.big\n            };\n        }\n\n        return null;\n    }\n\n    componentDidMount() {\n        FileStore.on('clientUpdateChatBlob', this.onClientUpdateChatBlob);\n        FileStore.on('clientUpdateUserBlob', this.onClientUpdateUserBlob);\n    }\n\n    componentWillUnmount() {\n        FileStore.removeListener('clientUpdateChatBlob', this.onClientUpdateChatBlob);\n        FileStore.removeListener('clientUpdateUserBlob', this.onClientUpdateUserBlob);\n    }\n\n    onClientUpdateChatBlob = update => {\n        const { chatId, photo } = this.props;\n\n        if (chatId === update.chatId && photo.big.id === update.fileId) {\n            const file = FileStore.get(update.fileId) || this.state.file;\n            this.setState({\n                file: file\n            });\n        }\n    };\n\n    onClientUpdateUserBlob = update => {\n        const { chatId, photo } = this.props;\n        const userId = getChatUserId(chatId);\n\n        if (userId === update.userId && photo.big.id === update.fileId) {\n            const file = FileStore.get(update.fileId) || this.state.file;\n            this.setState({\n                file: file\n            });\n        }\n    };\n\n    handleContentClick = event => {\n        if (event) event.stopPropagation();\n\n        this.props.onClick(event);\n    };\n\n    render() {\n        const { width, height, file } = this.state;\n        if (!file) return null;\n\n        const blob = FileStore.getBlob(file.id) || file.blob;\n        const src = FileStore.getBlobUrl(blob);\n\n        console.log('img.render ', src);\n        return (\n            <div className='media-viewer-content'>\n                <img className='media-viewer-content-image' src={src} alt='' onClick={this.handleContentClick} />\n                <FileProgress file={file} />\n            </div>\n        );\n    }\n}\n\nProfileMediaViewerContent.propTypes = {\n    chatId: PropTypes.number.isRequired,\n    photo: PropTypes.object.isRequired\n};\n\nexport default ProfileMediaViewerContent;\n"]},"metadata":{},"sourceType":"module"}