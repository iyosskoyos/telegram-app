{"ast":null,"code":"var _jsxFileName = \"/home/chilly/Projects/Capacitor/telegram-app/src/Components/Tile/SharedMedia/SharedDocument.js\";\n\n/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { compose } from 'recompose';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport { withTranslation } from 'react-i18next';\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport Checkbox from '@material-ui/core/Checkbox/';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport MenuList from '@material-ui/core/MenuList';\nimport Popover from '@material-ui/core/Popover';\nimport { getChatShortTitle, isPrivateChat } from '../../../Utils/Chat';\nimport { getMedia, openMedia } from '../../../Utils/Message';\nimport { forwardMessages, openChat } from '../../../Actions/Client';\nimport MessageStore from '../../../Stores/MessageStore';\nimport TdLibController from '../../../Controllers/TdLibController';\nimport './SharedDocument.css';\nconst styles = {\n  menuListRoot: {\n    minWidth: 150\n  }\n};\n\nclass SharedDocument extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.handleOpenMessage = event => {\n      this.handleCloseContextMenu(event);\n      const _this$props = this.props,\n            chatId = _this$props.chatId,\n            messageId = _this$props.messageId;\n      openChat(chatId, messageId);\n    };\n\n    this.handleForward = event => {\n      this.handleCloseContextMenu(event);\n      const _this$props2 = this.props,\n            chatId = _this$props2.chatId,\n            messageId = _this$props2.messageId;\n      forwardMessages(chatId, [messageId]);\n    };\n\n    this.handleDelete = event => {\n      this.handleCloseContextMenu(event);\n      const _this$props3 = this.props,\n            chatId = _this$props3.chatId,\n            messageId = _this$props3.messageId;\n      const message = MessageStore.get(chatId, messageId);\n      if (!message) return null;\n      const can_be_deleted_for_all_users = message.can_be_deleted_for_all_users;\n      this.setState({\n        openDeleteDialog: true,\n        canBeDeletedForAllUsers: can_be_deleted_for_all_users,\n        revoke: can_be_deleted_for_all_users\n      });\n    };\n\n    this.handleContextMenu = async event => {\n      if (event) {\n        event.preventDefault();\n        event.stopPropagation();\n      }\n\n      const contextMenu = this.state.contextMenu;\n\n      if (contextMenu) {\n        this.setState({\n          contextMenu: false\n        });\n      } else {\n        const left = event.clientX;\n        const top = event.clientY;\n        this.setState({\n          contextMenu: true,\n          left,\n          top\n        });\n      }\n    };\n\n    this.handleCloseContextMenu = event => {\n      if (event) {\n        event.stopPropagation();\n      }\n\n      this.setState({\n        contextMenu: false\n      });\n    };\n\n    this.handleRevokeChange = () => {\n      this.setState({\n        revoke: !this.state.revoke\n      });\n    };\n\n    this.handleCloseDelete = () => {\n      this.setState({\n        openDeleteDialog: false\n      });\n    };\n\n    this.handleDeleteContinue = () => {\n      const _this$props4 = this.props,\n            chatId = _this$props4.chatId,\n            messageId = _this$props4.messageId;\n      const revoke = this.state.revoke;\n      this.handleCloseDelete();\n      TdLibController.send({\n        '@type': 'deleteMessages',\n        chat_id: chatId,\n        message_ids: [messageId],\n        revoke: revoke\n      });\n    };\n\n    this.state = {\n      contextMenu: false,\n      left: 0,\n      top: 0,\n      openDeleteDialog: false,\n      revoke: false\n    };\n  }\n\n  render() {\n    const _this$props5 = this.props,\n          chatId = _this$props5.chatId,\n          classes = _this$props5.classes,\n          messageId = _this$props5.messageId,\n          showOpenMessage = _this$props5.showOpenMessage,\n          t = _this$props5.t;\n    const _this$state = this.state,\n          contextMenu = _this$state.contextMenu,\n          left = _this$state.left,\n          top = _this$state.top,\n          openDeleteDialog = _this$state.openDeleteDialog,\n          revoke = _this$state.revoke;\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return null;\n    const can_be_forwarded = message.can_be_forwarded,\n          can_be_deleted_only_for_self = message.can_be_deleted_only_for_self,\n          can_be_deleted_for_all_users = message.can_be_deleted_for_all_users;\n    const count = 1;\n    return React.createElement(\"div\", {\n      className: \"shared-document\",\n      onContextMenu: this.handleContextMenu,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145\n      },\n      __self: this\n    }, getMedia(message, () => openMedia(chatId, messageId, true)), React.createElement(Popover, {\n      open: contextMenu,\n      onClose: this.handleCloseContextMenu,\n      anchorReference: \"anchorPosition\",\n      anchorPosition: {\n        top,\n        left\n      },\n      anchorOrigin: {\n        vertical: 'bottom',\n        horizontal: 'right'\n      },\n      transformOrigin: {\n        vertical: 'top',\n        horizontal: 'left'\n      },\n      onMouseDown: e => e.stopPropagation(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147\n      },\n      __self: this\n    }, React.createElement(MenuList, {\n      classes: {\n        root: classes.menuListRoot\n      },\n      onClick: e => e.stopPropagation(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161\n      },\n      __self: this\n    }, showOpenMessage && React.createElement(MenuItem, {\n      onClick: this.handleOpenMessage,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162\n      },\n      __self: this\n    }, t('GoToMessage')), can_be_forwarded && React.createElement(MenuItem, {\n      onClick: this.handleForward,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163\n      },\n      __self: this\n    }, t('Forward')), (can_be_deleted_only_for_self || can_be_deleted_for_all_users) && React.createElement(MenuItem, {\n      onClick: this.handleDelete,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165\n      },\n      __self: this\n    }, t('Delete')))), React.createElement(Dialog, {\n      transitionDuration: 0,\n      open: openDeleteDialog,\n      onClose: this.handleCloseDelete,\n      \"aria-labelledby\": \"delete-dialog-title\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169\n      },\n      __self: this\n    }, React.createElement(DialogTitle, {\n      id: \"delete-dialog-title\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174\n      },\n      __self: this\n    }, \"Confirm\"), React.createElement(DialogContent, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175\n      },\n      __self: this\n    }, React.createElement(DialogContentText, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176\n      },\n      __self: this\n    }, count === 1 ? 'Are you sure you want to delete 1 message?' : \"Are you sure you want to delete \".concat(count, \" messages?\")), can_be_deleted_for_all_users && React.createElement(FormControlLabel, {\n      control: React.createElement(Checkbox, {\n        checked: revoke,\n        onChange: this.handleRevokeChange,\n        color: \"primary\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184\n        },\n        __self: this\n      }),\n      label: isPrivateChat(chatId) ? \"Delete for \".concat(getChatShortTitle(chatId)) : 'Delete for all',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182\n      },\n      __self: this\n    })), React.createElement(DialogActions, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192\n      },\n      __self: this\n    }, React.createElement(Button, {\n      onClick: this.handleCloseDelete,\n      color: \"primary\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193\n      },\n      __self: this\n    }, \"Cancel\"), React.createElement(Button, {\n      onClick: this.handleDeleteContinue,\n      color: \"primary\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196\n      },\n      __self: this\n    }, \"Ok\"))));\n  }\n\n}\n\nSharedDocument.propTypes = {\n  chatId: PropTypes.number.isRequired,\n  messageId: PropTypes.number.isRequired,\n  showOpenMessage: PropTypes.number.isRequired\n};\nconst enhance = compose(withStyles(styles, {\n  withTheme: true\n}), withTranslation());\nexport default enhance(SharedDocument);","map":{"version":3,"sources":["/home/chilly/Projects/Capacitor/telegram-app/src/Components/Tile/SharedMedia/SharedDocument.js"],"names":["React","PropTypes","compose","withStyles","withTranslation","Button","Dialog","DialogActions","DialogContent","DialogContentText","DialogTitle","FormControlLabel","Checkbox","MenuItem","MenuList","Popover","getChatShortTitle","isPrivateChat","getMedia","openMedia","forwardMessages","openChat","MessageStore","TdLibController","styles","menuListRoot","minWidth","SharedDocument","Component","constructor","props","handleOpenMessage","event","handleCloseContextMenu","chatId","messageId","handleForward","handleDelete","message","get","can_be_deleted_for_all_users","setState","openDeleteDialog","canBeDeletedForAllUsers","revoke","handleContextMenu","preventDefault","stopPropagation","contextMenu","state","left","clientX","top","clientY","handleRevokeChange","handleCloseDelete","handleDeleteContinue","send","chat_id","message_ids","render","classes","showOpenMessage","t","can_be_forwarded","can_be_deleted_only_for_self","count","vertical","horizontal","e","root","propTypes","number","isRequired","enhance","withTheme"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { compose } from 'recompose';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport { withTranslation } from 'react-i18next';\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport Checkbox from '@material-ui/core/Checkbox/';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport MenuList from '@material-ui/core/MenuList';\nimport Popover from '@material-ui/core/Popover';\nimport { getChatShortTitle, isPrivateChat } from '../../../Utils/Chat';\nimport { getMedia, openMedia } from '../../../Utils/Message';\nimport { forwardMessages, openChat } from '../../../Actions/Client';\nimport MessageStore from '../../../Stores/MessageStore';\nimport TdLibController from '../../../Controllers/TdLibController';\nimport './SharedDocument.css';\n\nconst styles = {\n    menuListRoot: {\n        minWidth: 150\n    }\n};\n\nclass SharedDocument extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            contextMenu: false,\n            left: 0,\n            top: 0,\n            openDeleteDialog: false,\n            revoke: false\n        };\n    }\n\n    handleOpenMessage = event => {\n        this.handleCloseContextMenu(event);\n\n        const { chatId, messageId } = this.props;\n\n        openChat(chatId, messageId);\n    };\n\n    handleForward = event => {\n        this.handleCloseContextMenu(event);\n\n        const { chatId, messageId } = this.props;\n\n        forwardMessages(chatId, [messageId]);\n    };\n\n    handleDelete = event => {\n        this.handleCloseContextMenu(event);\n\n        const { chatId, messageId } = this.props;\n\n        const message = MessageStore.get(chatId, messageId);\n        if (!message) return null;\n\n        const { can_be_deleted_for_all_users } = message;\n\n        this.setState({\n            openDeleteDialog: true,\n            canBeDeletedForAllUsers: can_be_deleted_for_all_users,\n            revoke: can_be_deleted_for_all_users\n        });\n    };\n\n    handleContextMenu = async event => {\n        if (event) {\n            event.preventDefault();\n            event.stopPropagation();\n        }\n        const { contextMenu } = this.state;\n\n        if (contextMenu) {\n            this.setState({ contextMenu: false });\n        } else {\n            const left = event.clientX;\n            const top = event.clientY;\n\n            this.setState({\n                contextMenu: true,\n                left,\n                top\n            });\n        }\n    };\n\n    handleCloseContextMenu = event => {\n        if (event) {\n            event.stopPropagation();\n        }\n\n        this.setState({ contextMenu: false });\n    };\n\n    handleRevokeChange = () => {\n        this.setState({ revoke: !this.state.revoke });\n    };\n\n    handleCloseDelete = () => {\n        this.setState({ openDeleteDialog: false });\n    };\n\n    handleDeleteContinue = () => {\n        const { chatId, messageId } = this.props;\n        const { revoke } = this.state;\n\n        this.handleCloseDelete();\n\n        TdLibController.send({\n            '@type': 'deleteMessages',\n            chat_id: chatId,\n            message_ids: [messageId],\n            revoke: revoke\n        });\n    };\n\n    render() {\n        const { chatId, classes, messageId, showOpenMessage, t } = this.props;\n        const { contextMenu, left, top, openDeleteDialog, revoke } = this.state;\n\n        const message = MessageStore.get(chatId, messageId);\n        if (!message) return null;\n\n        const { can_be_forwarded, can_be_deleted_only_for_self, can_be_deleted_for_all_users } = message;\n        const count = 1;\n\n        return (\n            <div className='shared-document' onContextMenu={this.handleContextMenu}>\n                {getMedia(message, () => openMedia(chatId, messageId, true))}\n                <Popover\n                    open={contextMenu}\n                    onClose={this.handleCloseContextMenu}\n                    anchorReference='anchorPosition'\n                    anchorPosition={{ top, left }}\n                    anchorOrigin={{\n                        vertical: 'bottom',\n                        horizontal: 'right'\n                    }}\n                    transformOrigin={{\n                        vertical: 'top',\n                        horizontal: 'left'\n                    }}\n                    onMouseDown={e => e.stopPropagation()}>\n                    <MenuList classes={{ root: classes.menuListRoot }} onClick={e => e.stopPropagation()}>\n                        {showOpenMessage && <MenuItem onClick={this.handleOpenMessage}>{t('GoToMessage')}</MenuItem>}\n                        {can_be_forwarded && <MenuItem onClick={this.handleForward}>{t('Forward')}</MenuItem>}\n                        {(can_be_deleted_only_for_self || can_be_deleted_for_all_users) && (\n                            <MenuItem onClick={this.handleDelete}>{t('Delete')}</MenuItem>\n                        )}\n                    </MenuList>\n                </Popover>\n                <Dialog\n                    transitionDuration={0}\n                    open={openDeleteDialog}\n                    onClose={this.handleCloseDelete}\n                    aria-labelledby='delete-dialog-title'>\n                    <DialogTitle id='delete-dialog-title'>Confirm</DialogTitle>\n                    <DialogContent>\n                        <DialogContentText>\n                            {count === 1\n                                ? 'Are you sure you want to delete 1 message?'\n                                : `Are you sure you want to delete ${count} messages?`}\n                        </DialogContentText>\n                        {can_be_deleted_for_all_users && (\n                            <FormControlLabel\n                                control={\n                                    <Checkbox checked={revoke} onChange={this.handleRevokeChange} color='primary' />\n                                }\n                                label={\n                                    isPrivateChat(chatId) ? `Delete for ${getChatShortTitle(chatId)}` : 'Delete for all'\n                                }\n                            />\n                        )}\n                    </DialogContent>\n                    <DialogActions>\n                        <Button onClick={this.handleCloseDelete} color='primary'>\n                            Cancel\n                        </Button>\n                        <Button onClick={this.handleDeleteContinue} color='primary'>\n                            Ok\n                        </Button>\n                    </DialogActions>\n                </Dialog>\n            </div>\n        );\n    }\n}\n\nSharedDocument.propTypes = {\n    chatId: PropTypes.number.isRequired,\n    messageId: PropTypes.number.isRequired,\n    showOpenMessage: PropTypes.number.isRequired\n};\n\nconst enhance = compose(\n    withStyles(styles, { withTheme: true }),\n    withTranslation()\n);\n\nexport default enhance(SharedDocument);\n"]},"metadata":{},"sourceType":"module"}