{"ast":null,"code":"import _defineProperty from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/inherits\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */import React from'react';import classNames from'classnames';import Lottie from'../../Viewer/Lottie';import{isBlurredThumbnail,isValidAnimatedSticker}from'../../../Utils/Media';import{getFitSize}from'../../../Utils/Common';import{getBlob,getSrc}from'../../../Utils/File';import{inflateBlob}from'../../../Workers/BlobInflator';import{STICKER_DISPLAY_SIZE}from'../../../Constants';import ApplicationStore from'../../../Stores/ApplicationStore';import FileStore from'../../../Stores/FileStore';import MessageStore from'../../../Stores/MessageStore';import StickerStore from'../../../Stores/StickerStore';import'./Sticker.css';import InstantViewStore from'../../../Stores/InstantViewStore';export var StickerSourceEnum=Object.freeze({HINTS:'HINTS',MESSAGE:'MESSAGE',PICKER_HEADER:'PICKER_HEADER',PICKER:'PICKER',PREVIEW:'PREVIEW',STICKER_SET:'STICKER_SET',UNKNOWN:'UNKNOWN'});var Sticker=/*#__PURE__*/function(_React$Component){_inherits(Sticker,_React$Component);function Sticker(props){var _this;_classCallCheck(this,Sticker);_this=_possibleConstructorReturn(this,_getPrototypeOf(Sticker).call(this,props));_this.onClientUpdateInstantViewContent=function(update){_this.openIV=Boolean(InstantViewStore.getCurrent());_this.startStopAnimation();};_this.onClientUpdateDialogChatId=function(update){_this.dialogChatId=ApplicationStore.dialogChatId;_this.startStopAnimation();};_this.onClientUpdateMediaViewerContent=function(update){_this.openMediaViewer=Boolean(ApplicationStore.mediaViewerContent);_this.startStopAnimation();};_this.onClientUpdateProfileMediaViewerContent=function(update){_this.openProfileMediaViewer=Boolean(ApplicationStore.profileMediaViewerContent);_this.startStopAnimation();};_this.onClientUpdateStickerPreview=function(update){_this.stickerPreview=update.sticker;_this.startStopAnimation();};_this.onClientUpdateMessagesInView=function(update){var _this$props=_this.props,chatId=_this$props.chatId,messageId=_this$props.messageId;var key=\"\".concat(chatId,\"_\").concat(messageId);_this.inView=update.messages.has(key);_this.startStopAnimation();};_this.onClientUpdateStickerSet=function(update){var stickerSet=update.stickerSet;_this.openedStickerSet=stickerSet;_this.startStopAnimation();};_this.onClientUpdateFocusWindow=function(update){var focused=update.focused;var _this$props2=_this.props,chatId=_this$props2.chatId,messageId=_this$props2.messageId,sticker=_this$props2.sticker;var isAnimated=isValidAnimatedSticker(sticker,chatId,messageId);if(!isAnimated)return;_this.windowFocused=focused;_this.startStopAnimation();};_this.onClientUpdateStickerBlob=function(update){var _this$props$sticker=_this.props.sticker,sticker=_this$props$sticker.sticker,is_animated=_this$props$sticker.is_animated;var fileId=update.fileId;if(!sticker)return;if(sticker.id===fileId){if(is_animated){_this.loadContent();}else{_this.forceUpdate();}}};_this.onClientUpdateStickerThumbnailBlob=function(update){var thumbnail=_this.props.sticker.thumbnail;if(!thumbnail)return;var fileId=update.fileId;if(thumbnail.photo&&thumbnail.photo.id===fileId){_this.forceUpdate();}};_this.loadContent=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _this$props3,chatId,messageId,source,autoplay,is_animated,sticker,isAnimated,blob,animationData,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$props3=_this.props,chatId=_this$props3.chatId,messageId=_this$props3.messageId,source=_this$props3.sticker,autoplay=_this$props3.autoplay;is_animated=source.is_animated,sticker=source.sticker;isAnimated=isValidAnimatedSticker(source,chatId,messageId);if(is_animated){_context.next=5;break;}return _context.abrupt(\"return\");case 5:if(isAnimated){_context.next=7;break;}return _context.abrupt(\"return\");case 7:blob=getBlob(sticker);if(blob){_context.next=10;break;}return _context.abrupt(\"return\");case 10:animationData=null;_context.prev=11;_context.next=14;return inflateBlob(blob);case 14:result=_context.sent;if(result){_context.next=17;break;}return _context.abrupt(\"return\");case 17:animationData=JSON.parse(result);// StickerStore.setAnimationData(blob, animationData);\n_context.next=23;break;case 20:_context.prev=20;_context.t0=_context[\"catch\"](11);console.log('[Sticker] loadContent error',_context.t0);case 23:if(animationData){_context.next=25;break;}return _context.abrupt(\"return\");case 25:if(autoplay){_this.setState({animationData:animationData});}else{_this.animationData=animationData;}case 26:case\"end\":return _context.stop();}}},_callee,null,[[11,20]]);}));_this.handleMouseEnter=function(event){var _assertThisInitialize=_assertThisInitialized(_this),animationData=_assertThisInitialize.animationData;console.log('[Sticker] handleMouseEnter',animationData);if(animationData){_this.setState({animationData:animationData},function(){_this.handleAnimationMouseEnter();});}};_this.handleAnimationMouseEnter=function(){console.log('[Sticker] handleAnimationMouseEnter 1');if(_this.props.autoplay)return;_this.entered=true;var player=_this.lottieRef.current;if(!player)return;console.log('[Sticker] handleAnimationMouseEnter 2');_this.loopCount=0;_this.startStopAnimation();};_this.handleAnimationLoopComplete=function(){if(_this.props.autoplay)return;var player=_this.lottieRef.current;if(!player)return;if(!_this.entered)_this.loopCount+=1;if(_this.loopCount>2){var animationData=_this.state.animationData;if(animationData){_this.setState({animationData:null});}}};_this.handleAnimationMouseOut=function(){_this.entered=false;};_this.lottieRef=React.createRef();_this.windowFocused=window.hasFocus;_this.inView=false;_this.stickerPreview=StickerStore.stickerPreview;_this.openMediaViewer=Boolean(ApplicationStore.mediaViewerContent);_this.openProfileMediaViewer=Boolean(ApplicationStore.profileMediaViewerContent);_this.openIV=Boolean(InstantViewStore.getCurrent());_this.dialogChatId=ApplicationStore.dialogChatId;_this.state={animationDate:null,hasError:false};return _this;}_createClass(Sticker,[{key:\"componentDidCatch\",value:function componentDidCatch(error,errorInfo){console.log('[Sticker] render error',error,errorInfo);}},{key:\"shouldComponentUpdate\",value:function shouldComponentUpdate(nextProps,nextState,nextContext){var _this$props4=this.props,chatId=_this$props4.chatId,messageId=_this$props4.messageId,sticker=_this$props4.sticker,blur=_this$props4.blur,displaySize=_this$props4.displaySize;var animationData=this.state.animationData;if(animationData!==nextState.animationData){return true;}if(chatId!==nextProps.chatId){return true;}if(messageId!==nextProps.messageId){return true;}if(sticker!==nextProps.sticker){return true;}if(blur!==nextProps.blur){return true;}if(displaySize!==nextProps.displaySize){return true;}return false;}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps,prevState,snapshot){if(prevProps.sticker!==this.props.sticker){this.loadContent();}}},{key:\"componentDidMount\",value:function componentDidMount(){this.loadContent();ApplicationStore.on('clientUpdateDialogChatId',this.onClientUpdateDialogChatId);ApplicationStore.on('clientUpdateFocusWindow',this.onClientUpdateFocusWindow);ApplicationStore.on('clientUpdateMediaViewerContent',this.onClientUpdateMediaViewerContent);ApplicationStore.on('clientUpdateProfileMediaViewerContent',this.onClientUpdateProfileMediaViewerContent);InstantViewStore.on('clientUpdateInstantViewContent',this.onClientUpdateInstantViewContent);FileStore.on('clientUpdateStickerThumbnailBlob',this.onClientUpdateStickerThumbnailBlob);FileStore.on('clientUpdateStickerBlob',this.onClientUpdateStickerBlob);MessageStore.on('clientUpdateMessagesInView',this.onClientUpdateMessagesInView);StickerStore.on('clientUpdateStickerPreview',this.onClientUpdateStickerPreview);StickerStore.on('clientUpdateStickerSet',this.onClientUpdateStickerSet);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){ApplicationStore.removeListener('clientUpdateDialogChatId',this.onClientUpdateDialogChatId);ApplicationStore.removeListener('clientUpdateFocusWindow',this.onClientUpdateFocusWindow);ApplicationStore.removeListener('clientUpdateMediaViewerContent',this.onClientUpdateMediaViewerContent);ApplicationStore.removeListener('clientUpdateProfileMediaViewerContent',this.onClientUpdateProfileMediaViewerContent);InstantViewStore.removeListener('clientUpdateInstantViewContent',this.onClientUpdateInstantViewContent);FileStore.removeListener('clientUpdateStickerThumbnailBlob',this.onClientUpdateStickerThumbnailBlob);FileStore.removeListener('clientUpdateStickerBlob',this.onClientUpdateStickerBlob);MessageStore.removeListener('clientUpdateMessagesInView',this.onClientUpdateMessagesInView);StickerStore.removeListener('clientUpdateStickerPreview',this.onClientUpdateStickerPreview);StickerStore.removeListener('clientUpdateStickerSet',this.onClientUpdateStickerSet);}},{key:\"startStopAnimation\",value:function startStopAnimation(){var autoplay=this.props.autoplay;var player=this.lottieRef.current;if(!player)return;if(this.windowFocused&&!this.stickerPreview&&!this.openMediaViewer&&!this.openProfileMediaViewer&&!this.openIV&&!this.dialogChatId){if(this.entered){console.log('[Sticker] play 1');player.play();this.pause=false;return;}console.log('[Sticker] startStopAnimation',this.openedStickerSet);if(!this.openedStickerSet){if(this.paused){console.log('[Sticker] play 2');player.play();this.paused=false;return;}if(autoplay&&this.inView){console.log('[Sticker] play 3');player.play();this.paused=false;return;}}}console.log('[Sticker] pause');this.paused=player.pause();}},{key:\"render\",value:function render(){var _this$props5=this.props,chatId=_this$props5.chatId,messageId=_this$props5.messageId,autoplay=_this$props5.autoplay,className=_this$props5.className,displaySize=_this$props5.displaySize,blur=_this$props5.blur,source=_this$props5.sticker,style=_this$props5.style,openMedia=_this$props5.openMedia,preview=_this$props5.preview;var thumbnail=source.thumbnail,sticker=source.sticker,width=source.width,height=source.height;var _this$state=this.state,animationData=_this$state.animationData,hasError=_this$state.hasError;var isAnimated=isValidAnimatedSticker(source,chatId,messageId);var thumbnailSrc=getSrc(thumbnail?thumbnail.photo:null);var src=getSrc(sticker);var isBlurred=isBlurredThumbnail(thumbnail);if(hasError){var _style={width:displaySize,height:displaySize};if(process.env.NODE_ENV!=='production'){_style.background='#ff000066';}return React.createElement(\"div\",{className:classNames('sticker',className),style:_style,onClick:openMedia},React.createElement(\"img\",{className:classNames('sticker-image',{'media-blurred':isBlurred&&blur}),draggable:false,src:thumbnailSrc,alt:\"\"}));}var fitSize=getFitSize({width:width,height:height},displaySize);if(!fitSize)return null;var stickerStyle=_objectSpread({width:fitSize.width,height:fitSize.height},style);var content=isAnimated?React.createElement(React.Fragment,null,animationData?React.createElement(Lottie,{ref:this.lottieRef,options:{autoplay:autoplay,loop:true,animationData:animationData,renderer:'svg',rendererSettings:{preserveAspectRatio:'xMinYMin slice',// Supports the same options as the svg element's preserveAspectRatio property\nclearCanvas:false,progressiveLoad:true,// Boolean, only svg renderer, loads dom elements when needed. Might speed up initialization for large number of elements.\nhideOnTransparent:true,//Boolean, only svg renderer, hides elements when opacity reaches 0 (defaults to true)\nclassName:'lottie-svg'}},eventListeners:[{eventName:'loopComplete',callback:this.handleAnimationLoopComplete}],onMouseOut:this.handleAnimationMouseOut}):React.createElement(\"img\",{className:classNames('sticker-image',{'media-blurred':isBlurred&&blur}),draggable:false,src:thumbnailSrc,alt:\"\"})):React.createElement(React.Fragment,null,src&&!preview?React.createElement(\"img\",{className:\"sticker-image\",draggable:false,src:src,alt:\"\"}):React.createElement(\"img\",{className:classNames('sticker-image',{'media-blurred':isBlurred&&blur}),draggable:false,src:thumbnailSrc,alt:\"\"}));return React.createElement(\"div\",{className:classNames('sticker',className),style:stickerStyle,onClick:openMedia,onMouseEnter:this.handleMouseEnter},content);}}],[{key:\"getDerivedStateFromError\",value:function getDerivedStateFromError(error){return{hasError:true};}}]);return Sticker;}(React.Component);Sticker.defaultProps={chatId:0,messageId:0,openMedia:function openMedia(){},autoplay:true,blur:true,displaySize:STICKER_DISPLAY_SIZE,preview:false,source:StickerSourceEnum.UNKNOWN};export default Sticker;","map":{"version":3,"sources":["/home/me-admin/Downloads/my-app/src/Components/Message/Media/Sticker.js"],"names":["React","classNames","Lottie","isBlurredThumbnail","isValidAnimatedSticker","getFitSize","getBlob","getSrc","inflateBlob","STICKER_DISPLAY_SIZE","ApplicationStore","FileStore","MessageStore","StickerStore","InstantViewStore","StickerSourceEnum","Object","freeze","HINTS","MESSAGE","PICKER_HEADER","PICKER","PREVIEW","STICKER_SET","UNKNOWN","Sticker","props","onClientUpdateInstantViewContent","update","openIV","Boolean","getCurrent","startStopAnimation","onClientUpdateDialogChatId","dialogChatId","onClientUpdateMediaViewerContent","openMediaViewer","mediaViewerContent","onClientUpdateProfileMediaViewerContent","openProfileMediaViewer","profileMediaViewerContent","onClientUpdateStickerPreview","stickerPreview","sticker","onClientUpdateMessagesInView","chatId","messageId","key","inView","messages","has","onClientUpdateStickerSet","stickerSet","openedStickerSet","onClientUpdateFocusWindow","focused","isAnimated","windowFocused","onClientUpdateStickerBlob","is_animated","fileId","id","loadContent","forceUpdate","onClientUpdateStickerThumbnailBlob","thumbnail","photo","source","autoplay","blob","animationData","result","JSON","parse","console","log","setState","handleMouseEnter","event","handleAnimationMouseEnter","entered","player","lottieRef","current","loopCount","handleAnimationLoopComplete","state","handleAnimationMouseOut","createRef","window","hasFocus","animationDate","hasError","error","errorInfo","nextProps","nextState","nextContext","blur","displaySize","prevProps","prevState","snapshot","on","removeListener","play","pause","paused","className","style","openMedia","preview","width","height","thumbnailSrc","src","isBlurred","process","env","NODE_ENV","background","fitSize","stickerStyle","content","loop","renderer","rendererSettings","preserveAspectRatio","clearCanvas","progressiveLoad","hideOnTransparent","eventName","callback","Component","defaultProps"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport Lottie from '../../Viewer/Lottie';\nimport { isBlurredThumbnail, isValidAnimatedSticker } from '../../../Utils/Media';\nimport { getFitSize } from '../../../Utils/Common';\nimport { getBlob, getSrc } from '../../../Utils/File';\nimport { inflateBlob } from '../../../Workers/BlobInflator';\nimport { STICKER_DISPLAY_SIZE } from '../../../Constants';\nimport ApplicationStore from '../../../Stores/ApplicationStore';\nimport FileStore from '../../../Stores/FileStore';\nimport MessageStore from '../../../Stores/MessageStore';\nimport StickerStore from '../../../Stores/StickerStore';\nimport './Sticker.css';\nimport InstantViewStore from '../../../Stores/InstantViewStore';\n\nexport const StickerSourceEnum = Object.freeze({\n    HINTS: 'HINTS',\n    MESSAGE: 'MESSAGE',\n    PICKER_HEADER: 'PICKER_HEADER',\n    PICKER: 'PICKER',\n    PREVIEW: 'PREVIEW',\n    STICKER_SET: 'STICKER_SET',\n    UNKNOWN: 'UNKNOWN'\n});\n\nclass Sticker extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.lottieRef = React.createRef();\n        this.windowFocused = window.hasFocus;\n        this.inView = false;\n        this.stickerPreview = StickerStore.stickerPreview;\n        this.openMediaViewer = Boolean(ApplicationStore.mediaViewerContent);\n        this.openProfileMediaViewer = Boolean(ApplicationStore.profileMediaViewerContent);\n        this.openIV = Boolean(InstantViewStore.getCurrent());\n        this.dialogChatId = ApplicationStore.dialogChatId;\n\n        this.state = {\n            animationDate: null,\n            hasError: false\n        };\n    }\n\n    static getDerivedStateFromError(error) {\n        return { hasError: true };\n    }\n\n    componentDidCatch(error, errorInfo) {\n        console.log('[Sticker] render error', error, errorInfo);\n    }\n\n    shouldComponentUpdate(nextProps, nextState, nextContext) {\n        const { chatId, messageId, sticker, blur, displaySize } = this.props;\n        const { animationData } = this.state;\n\n        if (animationData !== nextState.animationData) {\n            return true;\n        }\n\n        if (chatId !== nextProps.chatId) {\n            return true;\n        }\n\n        if (messageId !== nextProps.messageId) {\n            return true;\n        }\n\n        if (sticker !== nextProps.sticker) {\n            return true;\n        }\n\n        if (blur !== nextProps.blur) {\n            return true;\n        }\n\n        if (displaySize !== nextProps.displaySize) {\n            return true;\n        }\n\n        return false;\n    }\n\n    componentDidUpdate(prevProps, prevState, snapshot) {\n        if (prevProps.sticker !== this.props.sticker) {\n            this.loadContent();\n        }\n    }\n\n    componentDidMount() {\n        this.loadContent();\n\n        ApplicationStore.on('clientUpdateDialogChatId', this.onClientUpdateDialogChatId);\n        ApplicationStore.on('clientUpdateFocusWindow', this.onClientUpdateFocusWindow);\n        ApplicationStore.on('clientUpdateMediaViewerContent', this.onClientUpdateMediaViewerContent);\n        ApplicationStore.on('clientUpdateProfileMediaViewerContent', this.onClientUpdateProfileMediaViewerContent);\n        InstantViewStore.on('clientUpdateInstantViewContent', this.onClientUpdateInstantViewContent);\n        FileStore.on('clientUpdateStickerThumbnailBlob', this.onClientUpdateStickerThumbnailBlob);\n        FileStore.on('clientUpdateStickerBlob', this.onClientUpdateStickerBlob);\n        MessageStore.on('clientUpdateMessagesInView', this.onClientUpdateMessagesInView);\n        StickerStore.on('clientUpdateStickerPreview', this.onClientUpdateStickerPreview);\n        StickerStore.on('clientUpdateStickerSet', this.onClientUpdateStickerSet);\n    }\n\n    componentWillUnmount() {\n        ApplicationStore.removeListener('clientUpdateDialogChatId', this.onClientUpdateDialogChatId);\n        ApplicationStore.removeListener('clientUpdateFocusWindow', this.onClientUpdateFocusWindow);\n        ApplicationStore.removeListener('clientUpdateMediaViewerContent', this.onClientUpdateMediaViewerContent);\n        ApplicationStore.removeListener(\n            'clientUpdateProfileMediaViewerContent',\n            this.onClientUpdateProfileMediaViewerContent\n        );\n        InstantViewStore.removeListener('clientUpdateInstantViewContent', this.onClientUpdateInstantViewContent);\n        FileStore.removeListener('clientUpdateStickerThumbnailBlob', this.onClientUpdateStickerThumbnailBlob);\n        FileStore.removeListener('clientUpdateStickerBlob', this.onClientUpdateStickerBlob);\n        MessageStore.removeListener('clientUpdateMessagesInView', this.onClientUpdateMessagesInView);\n        StickerStore.removeListener('clientUpdateStickerPreview', this.onClientUpdateStickerPreview);\n        StickerStore.removeListener('clientUpdateStickerSet', this.onClientUpdateStickerSet);\n    }\n\n    onClientUpdateInstantViewContent = update => {\n        this.openIV = Boolean(InstantViewStore.getCurrent());\n\n        this.startStopAnimation();\n    };\n\n    onClientUpdateDialogChatId = update => {\n        this.dialogChatId = ApplicationStore.dialogChatId;\n\n        this.startStopAnimation();\n    };\n\n    onClientUpdateMediaViewerContent = update => {\n        this.openMediaViewer = Boolean(ApplicationStore.mediaViewerContent);\n\n        this.startStopAnimation();\n    };\n\n    onClientUpdateProfileMediaViewerContent = update => {\n        this.openProfileMediaViewer = Boolean(ApplicationStore.profileMediaViewerContent);\n\n        this.startStopAnimation();\n    };\n\n    onClientUpdateStickerPreview = update => {\n        this.stickerPreview = update.sticker;\n\n        this.startStopAnimation();\n    };\n\n    onClientUpdateMessagesInView = update => {\n        const { chatId, messageId } = this.props;\n        const key = `${chatId}_${messageId}`;\n\n        this.inView = update.messages.has(key);\n\n        this.startStopAnimation();\n    };\n\n    onClientUpdateStickerSet = update => {\n        const { stickerSet } = update;\n\n        this.openedStickerSet = stickerSet;\n\n        this.startStopAnimation();\n    };\n\n    onClientUpdateFocusWindow = update => {\n        const { focused } = update;\n        const { chatId, messageId, sticker } = this.props;\n\n        const isAnimated = isValidAnimatedSticker(sticker, chatId, messageId);\n        if (!isAnimated) return;\n\n        this.windowFocused = focused;\n        this.startStopAnimation();\n    };\n\n    startStopAnimation() {\n        const { autoplay } = this.props;\n\n        const player = this.lottieRef.current;\n        if (!player) return;\n\n        if (\n            this.windowFocused &&\n            !this.stickerPreview &&\n            !this.openMediaViewer &&\n            !this.openProfileMediaViewer &&\n            !this.openIV &&\n            !this.dialogChatId\n        ) {\n            if (this.entered) {\n                console.log('[Sticker] play 1');\n                player.play();\n                this.pause = false;\n                return;\n            }\n\n            console.log('[Sticker] startStopAnimation', this.openedStickerSet);\n            if (!this.openedStickerSet) {\n                if (this.paused) {\n                    console.log('[Sticker] play 2');\n                    player.play();\n                    this.paused = false;\n                    return;\n                }\n\n                if (autoplay && this.inView) {\n                    console.log('[Sticker] play 3');\n                    player.play();\n                    this.paused = false;\n                    return;\n                }\n            }\n        }\n\n        console.log('[Sticker] pause');\n        this.paused = player.pause();\n    }\n\n    onClientUpdateStickerBlob = update => {\n        const { sticker, is_animated } = this.props.sticker;\n        const { fileId } = update;\n\n        if (!sticker) return;\n\n        if (sticker.id === fileId) {\n            if (is_animated) {\n                this.loadContent();\n            } else {\n                this.forceUpdate();\n            }\n        }\n    };\n\n    onClientUpdateStickerThumbnailBlob = update => {\n        const { thumbnail } = this.props.sticker;\n        if (!thumbnail) return;\n\n        const { fileId } = update;\n\n        if (thumbnail.photo && thumbnail.photo.id === fileId) {\n            this.forceUpdate();\n        }\n    };\n\n    loadContent = async () => {\n        const { chatId, messageId, sticker: source, autoplay } = this.props;\n        const { is_animated, sticker } = source;\n        const isAnimated = isValidAnimatedSticker(source, chatId, messageId);\n\n        if (!is_animated) return;\n        if (!isAnimated) return;\n\n        const blob = getBlob(sticker);\n        if (!blob) return;\n\n        let animationData = null;\n        try {\n            // animationData = StickerStore.getAnimationData(blob);\n            // if (animationData) {\n            //     this.setState({ animationData });\n            //     return;\n            // }\n            const result = await inflateBlob(blob);\n            if (!result) return;\n\n            animationData = JSON.parse(result);\n            // StickerStore.setAnimationData(blob, animationData);\n        } catch (err) {\n            console.log('[Sticker] loadContent error', err);\n        }\n        if (!animationData) return;\n\n        if (autoplay) {\n            this.setState({ animationData });\n        } else {\n            this.animationData = animationData;\n        }\n    };\n\n    handleMouseEnter = event => {\n        const { animationData } = this;\n        console.log('[Sticker] handleMouseEnter', animationData);\n        if (animationData) {\n            this.setState({ animationData }, () => {\n                this.handleAnimationMouseEnter();\n            });\n        }\n    };\n\n    handleAnimationMouseEnter = () => {\n        console.log('[Sticker] handleAnimationMouseEnter 1');\n        if (this.props.autoplay) return;\n\n        this.entered = true;\n\n        const player = this.lottieRef.current;\n        if (!player) return;\n\n        console.log('[Sticker] handleAnimationMouseEnter 2');\n        this.loopCount = 0;\n        this.startStopAnimation();\n    };\n\n    handleAnimationLoopComplete = () => {\n        if (this.props.autoplay) return;\n\n        const player = this.lottieRef.current;\n        if (!player) return;\n\n        if (!this.entered) this.loopCount += 1;\n        if (this.loopCount > 2) {\n            const { animationData } = this.state;\n            if (animationData) {\n                this.setState({ animationData: null });\n            }\n        }\n    };\n\n    handleAnimationMouseOut = () => {\n        this.entered = false;\n    };\n\n    render() {\n        const {\n            chatId,\n            messageId,\n            autoplay,\n            className,\n            displaySize,\n            blur,\n            sticker: source,\n            style,\n            openMedia,\n            preview\n        } = this.props;\n        const { thumbnail, sticker, width, height } = source;\n        const { animationData, hasError } = this.state;\n\n        const isAnimated = isValidAnimatedSticker(source, chatId, messageId);\n\n        const thumbnailSrc = getSrc(thumbnail ? thumbnail.photo : null);\n        const src = getSrc(sticker);\n        const isBlurred = isBlurredThumbnail(thumbnail);\n\n        if (hasError) {\n            const style = {\n                width: displaySize,\n                height: displaySize\n            };\n\n            if (process.env.NODE_ENV !== 'production') {\n                style.background = '#ff000066';\n            }\n\n            return (\n                <div className={classNames('sticker', className)} style={style} onClick={openMedia}>\n                    <img\n                        className={classNames('sticker-image', { 'media-blurred': isBlurred && blur })}\n                        draggable={false}\n                        src={thumbnailSrc}\n                        alt=''\n                    />\n                </div>\n            );\n        }\n\n        const fitSize = getFitSize({ width: width, height: height }, displaySize);\n        if (!fitSize) return null;\n\n        const stickerStyle = {\n            width: fitSize.width,\n            height: fitSize.height,\n            ...style\n        };\n\n        const content = isAnimated ? (\n            <>\n                {animationData ? (\n                    <Lottie\n                        ref={this.lottieRef}\n                        options={{\n                            autoplay: autoplay,\n                            loop: true,\n                            animationData,\n                            renderer: 'svg',\n                            rendererSettings: {\n                                preserveAspectRatio: 'xMinYMin slice', // Supports the same options as the svg element's preserveAspectRatio property\n                                clearCanvas: false,\n                                progressiveLoad: true, // Boolean, only svg renderer, loads dom elements when needed. Might speed up initialization for large number of elements.\n                                hideOnTransparent: true, //Boolean, only svg renderer, hides elements when opacity reaches 0 (defaults to true)\n                                className: 'lottie-svg'\n                            }\n                        }}\n                        eventListeners={[\n                            {\n                                eventName: 'loopComplete',\n                                callback: this.handleAnimationLoopComplete\n                            }\n                        ]}\n                        onMouseOut={this.handleAnimationMouseOut}\n                    />\n                ) : (\n                    <img\n                        className={classNames('sticker-image', { 'media-blurred': isBlurred && blur })}\n                        draggable={false}\n                        src={thumbnailSrc}\n                        alt=''\n                    />\n                )}\n            </>\n        ) : (\n            <>\n                {src && !preview ? (\n                    <img className='sticker-image' draggable={false} src={src} alt='' />\n                ) : (\n                    <img\n                        className={classNames('sticker-image', { 'media-blurred': isBlurred && blur })}\n                        draggable={false}\n                        src={thumbnailSrc}\n                        alt=''\n                    />\n                )}\n            </>\n        );\n\n        return (\n            <div\n                className={classNames('sticker', className)}\n                style={stickerStyle}\n                onClick={openMedia}\n                onMouseEnter={this.handleMouseEnter}>\n                {content}\n            </div>\n        );\n    }\n}\n\nSticker.propTypes = {\n    chatId: PropTypes.number,\n    messageId: PropTypes.number,\n    sticker: PropTypes.object.isRequired,\n    openMedia: PropTypes.func,\n\n    autoplay: PropTypes.bool,\n    blur: PropTypes.bool,\n    displaySize: PropTypes.number,\n    preview: PropTypes.bool,\n    source: PropTypes.string\n};\n\nSticker.defaultProps = {\n    chatId: 0,\n    messageId: 0,\n    openMedia: () => {},\n\n    autoplay: true,\n    blur: true,\n    displaySize: STICKER_DISPLAY_SIZE,\n    preview: false,\n    source: StickerSourceEnum.UNKNOWN\n};\n\nexport default Sticker;\n"]},"metadata":{},"sourceType":"module"}