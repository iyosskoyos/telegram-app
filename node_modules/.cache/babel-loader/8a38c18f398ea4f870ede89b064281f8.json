{"ast":null,"code":"import _regeneratorRuntime from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/regenerator\";import _slicedToArray from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _asyncToGenerator from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _defineProperty from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */import React from'react';import copy from'copy-to-clipboard';import classNames from'classnames';import{compose}from'recompose';import withStyles from'@material-ui/core/styles/withStyles';import{withTranslation}from'react-i18next';import{withSnackbar}from'notistack';import Button from'@material-ui/core/Button';import IconButton from'@material-ui/core/IconButton';import Dialog from'@material-ui/core/Dialog';import DialogActions from'@material-ui/core/DialogActions';import DialogTitle from'@material-ui/core/DialogTitle';import CloseIcon from'@material-ui/icons/Close';import ForwardTargetChat from'../Tile/ForwardTargetChat';import{canSendMessages,getChatTitle,getChatUsername,isSupergroup}from'../../Utils/Chat';import{loadChatsContent}from'../../Utils/File';import{getCyrillicInput,getLatinInput}from'../../Utils/Language';import{getInputMediaContent}from'../../Utils/Media';import{borderStyle}from'../Theme';import{NOTIFICATION_AUTO_HIDE_DURATION_MS}from'../../Constants';import ApplicationStore from'../../Stores/ApplicationStore';import FileStore from'../../Stores/FileStore';import MessageStore from'../../Stores/MessageStore';import UserStore from'../../Stores/UserStore';import TdLibController from'../../Controllers/TdLibController';import'./ForwardDialog.css';var styles=function styles(theme){return _objectSpread({close:{padding:theme.spacing.unit/2},dialog:{color:theme.palette.text.primary},dialogContent:{padding:0,display:'flex',position:'relative'},searchList:{background:theme.palette.background.paper}},borderStyle(theme));};var ForwardDialog=/*#__PURE__*/function(_React$Component){_inherits(ForwardDialog,_React$Component);function ForwardDialog(props){var _this;_classCallCheck(this,ForwardDialog);_this=_possibleConstructorReturn(this,_getPrototypeOf(ForwardDialog).call(this,props));_this.loadContent=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var promises,getChatsPromise,savedMessagesPromise,_ref2,_ref3,chats,savedMessages,store;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this.getPublicMessageLink();promises=[];getChatsPromise=TdLibController.send({'@type':'getChats',offset_order:'9223372036854775807',offset_chat_id:0,limit:100});promises.push(getChatsPromise);savedMessagesPromise=TdLibController.send({'@type':'createPrivateChat',user_id:UserStore.getMyId(),force:true});promises.push(savedMessagesPromise);_context.next=8;return Promise.all(promises.map(function(x){return x.catch(function(e){return null;});}));case 8:_ref2=_context.sent;_ref3=_slicedToArray(_ref2,2);chats=_ref3[0];savedMessages=_ref3[1];_this.setState({chatIds:chats.chat_ids,savedMessages:savedMessages});store=FileStore.getStore();loadChatsContent(store,chats.chat_ids);case 15:case\"end\":return _context.stop();}}},_callee);}));_this.getPublicMessageLink=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _this$props,chatId,messageIds,result;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this$props=_this.props,chatId=_this$props.chatId,messageIds=_this$props.messageIds;if(chatId){_context2.next=3;break;}return _context2.abrupt(\"return\");case 3:if(messageIds){_context2.next=5;break;}return _context2.abrupt(\"return\");case 5:if(!(messageIds.length>1)){_context2.next=7;break;}return _context2.abrupt(\"return\");case 7:if(isSupergroup(chatId)){_context2.next=9;break;}return _context2.abrupt(\"return\");case 9:if(getChatUsername(chatId)){_context2.next=11;break;}return _context2.abrupt(\"return\");case 11:_context2.next=13;return TdLibController.send({'@type':'getPublicMessageLink',chat_id:chatId,message_id:messageIds[0],for_album:false});case 13:result=_context2.sent;_this.setState({publicMessageLink:result});case 15:case\"end\":return _context2.stop();}}},_callee2);}));_this.handleClose=function(){TdLibController.clientUpdate({'@type':'clientUpdateForward',info:null});};_this.handleCopyLink=function(){var t=_this.props.t;var publicMessageLink=_this.state.publicMessageLink;if(!publicMessageLink)return;if(!publicMessageLink.link)return;var key=\"copy_link_\".concat(publicMessageLink.link);var message=t('LinkCopied');var action=null;copy(publicMessageLink.link);_this.handleScheduledAction(key,message,action);};_this.handleScheduledAction=function(key,message,action){if(!key)return;var _this$props2=_this.props,enqueueSnackbar=_this$props2.enqueueSnackbar,classes=_this$props2.classes;if(!enqueueSnackbar)return;var TRANSITION_DELAY=150;if(ApplicationStore.addScheduledAction(key,NOTIFICATION_AUTO_HIDE_DURATION_MS+2*TRANSITION_DELAY,action)){enqueueSnackbar(message,{autoHideDuration:NOTIFICATION_AUTO_HIDE_DURATION_MS,action:[React.createElement(IconButton,{key:\"close\",\"aria-label\":\"Close\",color:\"inherit\",className:classes.close,onClick:function onClick(){return ApplicationStore.removeScheduledAction(key);}},React.createElement(CloseIcon,null))]});}};_this.getForwardPhotoSize=function(chatId,messageIds){if(messageIds.length!==1)return null;var message=MessageStore.get(chatId,messageIds[0]);if(!message)return null;var can_be_forwarded=message.can_be_forwarded,content=message.content;if(!can_be_forwarded&&content['@type']==='messageChatChangePhoto'){var photo=content.photo;if(!photo)return null;var sizes=photo.sizes;if(sizes&&sizes.length){return sizes[sizes.length-1];}}return null;};_this.handleSend=function(){_this.handleClose();var _this$props3=_this.props,chatId=_this$props3.chatId,messageIds=_this$props3.messageIds,photoSize=_this$props3.photoSize,media=_this$props3.media,link=_this$props3.link;if(!chatId&&!messageIds&&!messageIds&&!photoSize&&!media&&!link)return;var text=_this.getInnerText(_this.messageRef.current);_this.targetChats.forEach(function(targetChatId){if(media){var content=getInputMediaContent(media,text);if(content){TdLibController.send({'@type':'sendMessage',chat_id:targetChatId,reply_to_message_id:0,disable_notifications:false,from_background:false,reply_markup:null,input_message_content:content});}return;}if(link){if(text){TdLibController.send({'@type':'sendMessage',chat_id:targetChatId,reply_to_message_id:0,disable_notifications:false,from_background:false,reply_markup:null,input_message_content:{'@type':'inputMessageText',text:{'@type':'formattedText',text:text,entities:null},disable_web_page_preview:true,clear_draft:false}});}TdLibController.send({'@type':'sendMessage',chat_id:targetChatId,reply_to_message_id:0,disable_notifications:false,from_background:false,reply_markup:null,input_message_content:{'@type':'inputMessageText',text:{'@type':'formattedText',text:link,entities:null},disable_web_page_preview:true,clear_draft:false}});return;}var size=photoSize||_this.getForwardPhotoSize(chatId,messageIds);if(size){var width=size.width,height=size.height,photo=size.photo;TdLibController.send({'@type':'sendMessage',chat_id:targetChatId,reply_to_message_id:0,disable_notifications:false,from_background:false,reply_markup:null,input_message_content:{'@type':'inputMessagePhoto',photo:{'@type':'inputFileId',id:photo.id},thumbnail:null,added_sticker_file_ids:[],width:width,height:height,caption:{'@type':'formattedText',text:text,entities:null},ttl:0}});return;}if(text){TdLibController.send({'@type':'sendMessage',chat_id:targetChatId,reply_to_message_id:0,disable_notifications:false,from_background:false,reply_markup:null,input_message_content:{'@type':'inputMessageText',text:{'@type':'formattedText',text:text,entities:null},disable_web_page_preview:true,clear_draft:false}});}TdLibController.send({'@type':'forwardMessages',chat_id:targetChatId,from_chat_id:chatId,message_ids:messageIds,disable_notifications:false,from_background:false,as_album:false});});};_this.handleChangeSelection=function(chatId){if(_this.targetChats.has(chatId)){_this.targetChats.delete(chatId);}else{_this.targetChats.set(chatId,chatId);}console.log(_this.targetChats);_this.forceUpdate();};_this.getInnerText=function(div){var innerText=div.innerText;var innerHTML=div.innerHTML;if(innerText&&innerText==='\\n'&&innerHTML&&(innerHTML==='<br>'||innerHTML==='<div><br></div>')){div.innerHTML='';}return innerText;};_this.handleSearchKeyDown=function(event){if(event.keyCode===13){event.preventDefault();}};_this.handleSearchKeyUp=function(){var _this$state=_this.state,chatIds=_this$state.chatIds,savedMessages=_this$state.savedMessages;var innerHTML=_this.searchRef.current.innerHTML;if(innerHTML&&(innerHTML==='<br>'||innerHTML==='<div><br></div>')){_this.searchRef.current.innerHTML='';}var innerText=_this.getInnerText(_this.searchRef.current).trim();if(!innerText){_this.setState({searchText:null,searchResults:[]});return;}var latinText=getLatinInput(innerText);var cyrillicText=getCyrillicInput(innerText);var chatsSource=savedMessages?[savedMessages.id].concat(chatIds.filter(function(x){return x!==savedMessages.id;})).filter(function(x){return canSendMessages(x);}):chatIds;var searchResults=chatsSource.filter(function(x){return _this.hasSearchText(x,innerText)||latinText&&_this.hasSearchText(x,latinText)||cyrillicText&&_this.hasSearchText(x,cyrillicText);});_this.setState({searchText:innerText,searchResults:searchResults});};_this.handleSearchPaste=function(event){var plainText=event.clipboardData.getData('text/plain');if(plainText){event.preventDefault();document.execCommand('insertHTML',false,plainText);}};_this.handleMessageKeyUp=function(){var innerHTML=_this.messageRef.current.innerHTML;if(innerHTML&&(innerHTML==='<br>'||innerHTML==='<div><br></div>')){_this.messageRef.current.innerHTML='';}};_this.handleMessagePaste=function(event){var plainText=event.clipboardData.getData('text/plain');if(plainText){event.preventDefault();document.execCommand('insertHTML',false,plainText);}};_this.hasSearchText=function(chatId,searchText){var t=_this.props.t;var savedMessages=_this.state.savedMessages;if(savedMessages&&chatId===savedMessages.id){var title=getChatTitle(chatId,true,t)||'';if(title.toLocaleLowerCase().indexOf(searchText.toLowerCase())!==-1){return true;}}var title1=getChatTitle(chatId,false,t)||'';if(title1.toLocaleLowerCase().indexOf(searchText.toLowerCase())!==-1){return true;}var username=getChatUsername(chatId)||'';if(username.toLocaleLowerCase().indexOf(searchText.toLowerCase())!==-1){return true;}return false;};_this.setSearchFocus=function(){setTimeout(function(){if(_this.searchRef.current){var element=_this.searchRef.current;element.focus();}},100);};_this.state={chatIds:[],savedMessages:null};_this.searchRef=React.createRef();_this.messageRef=React.createRef();_this.targetChats=new Map();return _this;}_createClass(ForwardDialog,[{key:\"componentDidMount\",value:function componentDidMount(){this.loadContent();this.setSearchFocus();}},{key:\"render\",value:function render(){var _this2=this;var _this$props4=this.props,classes=_this$props4.classes,t=_this$props4.t;var _this$state2=this.state,chatIds=_this$state2.chatIds,searchText=_this$state2.searchText,searchResults=_this$state2.searchResults,savedMessages=_this$state2.savedMessages,publicMessageLink=_this$state2.publicMessageLink;var chatsSource=savedMessages?[savedMessages.id].concat(chatIds.filter(function(x){return x!==savedMessages.id;})).filter(function(x){return canSendMessages(x);}):chatIds;var chats=chatsSource.map(function(x){return React.createElement(ForwardTargetChat,{key:x,chatId:x,selected:_this2.targetChats.has(x),onSelect:function onSelect(){return _this2.handleChangeSelection(x);}});});var foundChats=(searchResults||[]).map(function(x){return React.createElement(ForwardTargetChat,{key:x,chatId:x,selected:_this2.targetChats.has(x),onSelect:function onSelect(){return _this2.handleChangeSelection(x);}});});return React.createElement(Dialog,{open:true,onClose:this.handleClose,\"aria-labelledby\":\"forward-dialog-title\",\"aria-describedby\":\"forward-dialog-description\",className:classes.dialog},React.createElement(DialogTitle,{id:\"forward-dialog-title\"},t('ShareSendTo')),React.createElement(\"div\",{ref:this.searchRef,id:\"forward-dialog-search\",contentEditable:true,suppressContentEditableWarning:true,placeholder:t('Search'),onKeyDown:this.handleSearchKeyDown,onKeyUp:this.handleSearchKeyUp,onPaste:this.handleSearchPaste}),React.createElement(\"div\",{className:classNames(classes.borderColor,'forward-dialog-content')},React.createElement(\"div\",{className:\"forward-dialog-list\"},chats),searchText&&React.createElement(\"div\",{className:classNames(classes.searchList,'forward-dialog-search-list')},foundChats)),this.targetChats.size>0&&React.createElement(\"div\",{ref:this.messageRef,id:\"forward-dialog-message\",contentEditable:true,suppressContentEditableWarning:true,placeholder:t('ShareComment'),onKeyUp:this.handleMessageKeyUp,onPaste:this.handleMessagePaste}),React.createElement(DialogActions,null,React.createElement(Button,{onClick:this.handleClose,color:\"primary\"},t('Cancel')),this.targetChats.size>0&&React.createElement(Button,{onClick:this.handleSend,color:\"primary\",autoFocus:true},t('Send')),!this.targetChats.size&&publicMessageLink&&React.createElement(Button,{onClick:this.handleCopyLink,color:\"primary\"},t('CopyLink'))));}}]);return ForwardDialog;}(React.Component);var enhance=compose(withStyles(styles,{withTheme:true}),withTranslation(),withSnackbar);export default enhance(ForwardDialog);","map":{"version":3,"sources":["/home/me-admin/Downloads/my-app/src/Components/Popup/ForwardDialog.js"],"names":["React","copy","classNames","compose","withStyles","withTranslation","withSnackbar","Button","IconButton","Dialog","DialogActions","DialogTitle","CloseIcon","ForwardTargetChat","canSendMessages","getChatTitle","getChatUsername","isSupergroup","loadChatsContent","getCyrillicInput","getLatinInput","getInputMediaContent","borderStyle","NOTIFICATION_AUTO_HIDE_DURATION_MS","ApplicationStore","FileStore","MessageStore","UserStore","TdLibController","styles","theme","close","padding","spacing","unit","dialog","color","palette","text","primary","dialogContent","display","position","searchList","background","paper","ForwardDialog","props","loadContent","getPublicMessageLink","promises","getChatsPromise","send","offset_order","offset_chat_id","limit","push","savedMessagesPromise","user_id","getMyId","force","Promise","all","map","x","catch","e","chats","savedMessages","setState","chatIds","chat_ids","store","getStore","chatId","messageIds","length","chat_id","message_id","for_album","result","publicMessageLink","handleClose","clientUpdate","info","handleCopyLink","t","state","link","key","message","action","handleScheduledAction","enqueueSnackbar","classes","TRANSITION_DELAY","addScheduledAction","autoHideDuration","removeScheduledAction","getForwardPhotoSize","get","can_be_forwarded","content","photo","sizes","handleSend","photoSize","media","getInnerText","messageRef","current","targetChats","forEach","targetChatId","reply_to_message_id","disable_notifications","from_background","reply_markup","input_message_content","entities","disable_web_page_preview","clear_draft","size","width","height","id","thumbnail","added_sticker_file_ids","caption","ttl","from_chat_id","message_ids","as_album","handleChangeSelection","has","delete","set","console","log","forceUpdate","div","innerText","innerHTML","handleSearchKeyDown","event","keyCode","preventDefault","handleSearchKeyUp","searchRef","trim","searchText","searchResults","latinText","cyrillicText","chatsSource","concat","filter","hasSearchText","handleSearchPaste","plainText","clipboardData","getData","document","execCommand","handleMessageKeyUp","handleMessagePaste","title","toLocaleLowerCase","indexOf","toLowerCase","title1","username","setSearchFocus","setTimeout","element","focus","createRef","Map","foundChats","borderColor","Component","enhance","withTheme"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport copy from 'copy-to-clipboard';\nimport classNames from 'classnames';\nimport { compose } from 'recompose';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport { withTranslation } from 'react-i18next';\nimport { withSnackbar } from 'notistack';\nimport Button from '@material-ui/core/Button';\nimport IconButton from '@material-ui/core/IconButton';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport CloseIcon from '@material-ui/icons/Close';\nimport ForwardTargetChat from '../Tile/ForwardTargetChat';\nimport { canSendMessages, getChatTitle, getChatUsername, isSupergroup } from '../../Utils/Chat';\nimport { loadChatsContent } from '../../Utils/File';\nimport { getCyrillicInput, getLatinInput } from '../../Utils/Language';\nimport { getInputMediaContent } from '../../Utils/Media';\nimport { borderStyle } from '../Theme';\nimport { NOTIFICATION_AUTO_HIDE_DURATION_MS } from '../../Constants';\nimport ApplicationStore from '../../Stores/ApplicationStore';\nimport FileStore from '../../Stores/FileStore';\nimport MessageStore from '../../Stores/MessageStore';\nimport UserStore from '../../Stores/UserStore';\nimport TdLibController from '../../Controllers/TdLibController';\nimport './ForwardDialog.css';\n\nconst styles = theme => ({\n    close: {\n        padding: theme.spacing.unit / 2\n    },\n    dialog: {\n        color: theme.palette.text.primary\n    },\n    dialogContent: {\n        padding: 0,\n        display: 'flex',\n        position: 'relative'\n    },\n    searchList: {\n        background: theme.palette.background.paper\n    },\n    ...borderStyle(theme)\n});\n\nclass ForwardDialog extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            chatIds: [],\n            savedMessages: null\n        };\n\n        this.searchRef = React.createRef();\n        this.messageRef = React.createRef();\n\n        this.targetChats = new Map();\n    }\n\n    componentDidMount() {\n        this.loadContent();\n\n        this.setSearchFocus();\n    }\n\n    loadContent = async () => {\n        this.getPublicMessageLink();\n\n        const promises = [];\n        const getChatsPromise = TdLibController.send({\n            '@type': 'getChats',\n            offset_order: '9223372036854775807',\n            offset_chat_id: 0,\n            limit: 100\n        });\n        promises.push(getChatsPromise);\n\n        const savedMessagesPromise = TdLibController.send({\n            '@type': 'createPrivateChat',\n            user_id: UserStore.getMyId(),\n            force: true\n        });\n        promises.push(savedMessagesPromise);\n\n        const [chats, savedMessages] = await Promise.all(promises.map(x => x.catch(e => null)));\n\n        this.setState({\n            chatIds: chats.chat_ids,\n            savedMessages: savedMessages\n        });\n\n        const store = FileStore.getStore();\n        loadChatsContent(store, chats.chat_ids);\n    };\n\n    getPublicMessageLink = async () => {\n        const { chatId, messageIds } = this.props;\n        if (!chatId) return;\n        if (!messageIds) return;\n        if (messageIds.length > 1) return;\n        if (!isSupergroup(chatId)) return;\n        if (!getChatUsername(chatId)) return;\n\n        const result = await TdLibController.send({\n            '@type': 'getPublicMessageLink',\n            chat_id: chatId,\n            message_id: messageIds[0],\n            for_album: false\n        });\n\n        this.setState({\n            publicMessageLink: result\n        });\n    };\n\n    handleClose = () => {\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateForward',\n            info: null\n        });\n    };\n\n    handleCopyLink = () => {\n        const { t } = this.props;\n        const { publicMessageLink } = this.state;\n\n        if (!publicMessageLink) return;\n        if (!publicMessageLink.link) return;\n\n        const key = `copy_link_${publicMessageLink.link}`;\n        const message = t('LinkCopied');\n        const action = null;\n\n        copy(publicMessageLink.link);\n\n        this.handleScheduledAction(key, message, action);\n    };\n\n    handleScheduledAction = (key, message, action) => {\n        if (!key) return;\n\n        const { enqueueSnackbar, classes } = this.props;\n        if (!enqueueSnackbar) return;\n\n        const TRANSITION_DELAY = 150;\n        if (\n            ApplicationStore.addScheduledAction(key, NOTIFICATION_AUTO_HIDE_DURATION_MS + 2 * TRANSITION_DELAY, action)\n        ) {\n            enqueueSnackbar(message, {\n                autoHideDuration: NOTIFICATION_AUTO_HIDE_DURATION_MS,\n                action: [\n                    <IconButton\n                        key='close'\n                        aria-label='Close'\n                        color='inherit'\n                        className={classes.close}\n                        onClick={() => ApplicationStore.removeScheduledAction(key)}>\n                        <CloseIcon />\n                    </IconButton>\n                ]\n            });\n        }\n    };\n\n    getForwardPhotoSize = (chatId, messageIds) => {\n        if (messageIds.length !== 1) return null;\n\n        const message = MessageStore.get(chatId, messageIds[0]);\n        if (!message) return null;\n\n        const { can_be_forwarded, content } = message;\n        if (!can_be_forwarded && content['@type'] === 'messageChatChangePhoto') {\n            const { photo } = content;\n            if (!photo) return null;\n\n            const { sizes } = photo;\n            if (sizes && sizes.length) {\n                return sizes[sizes.length - 1];\n            }\n        }\n\n        return null;\n    };\n\n    handleSend = () => {\n        this.handleClose();\n\n        const { chatId, messageIds, photoSize, media, link } = this.props;\n        if (!chatId && !messageIds && !messageIds && !photoSize && !media && !link) return;\n\n        const text = this.getInnerText(this.messageRef.current);\n\n        this.targetChats.forEach(targetChatId => {\n            if (media) {\n                const content = getInputMediaContent(media, text);\n                if (content) {\n                    TdLibController.send({\n                        '@type': 'sendMessage',\n                        chat_id: targetChatId,\n                        reply_to_message_id: 0,\n                        disable_notifications: false,\n                        from_background: false,\n                        reply_markup: null,\n                        input_message_content: content\n                    });\n                }\n\n                return;\n            }\n\n            if (link) {\n                if (text) {\n                    TdLibController.send({\n                        '@type': 'sendMessage',\n                        chat_id: targetChatId,\n                        reply_to_message_id: 0,\n                        disable_notifications: false,\n                        from_background: false,\n                        reply_markup: null,\n                        input_message_content: {\n                            '@type': 'inputMessageText',\n                            text: {\n                                '@type': 'formattedText',\n                                text: text,\n                                entities: null\n                            },\n                            disable_web_page_preview: true,\n                            clear_draft: false\n                        }\n                    });\n                }\n\n                TdLibController.send({\n                    '@type': 'sendMessage',\n                    chat_id: targetChatId,\n                    reply_to_message_id: 0,\n                    disable_notifications: false,\n                    from_background: false,\n                    reply_markup: null,\n                    input_message_content: {\n                        '@type': 'inputMessageText',\n                        text: {\n                            '@type': 'formattedText',\n                            text: link,\n                            entities: null\n                        },\n                        disable_web_page_preview: true,\n                        clear_draft: false\n                    }\n                });\n\n                return;\n            }\n\n            const size = photoSize || this.getForwardPhotoSize(chatId, messageIds);\n            if (size) {\n                const { width, height, photo } = size;\n\n                TdLibController.send({\n                    '@type': 'sendMessage',\n                    chat_id: targetChatId,\n                    reply_to_message_id: 0,\n                    disable_notifications: false,\n                    from_background: false,\n                    reply_markup: null,\n                    input_message_content: {\n                        '@type': 'inputMessagePhoto',\n                        photo: {\n                            '@type': 'inputFileId',\n                            id: photo.id\n                        },\n                        thumbnail: null,\n                        added_sticker_file_ids: [],\n                        width: width,\n                        height: height,\n                        caption: {\n                            '@type': 'formattedText',\n                            text: text,\n                            entities: null\n                        },\n                        ttl: 0\n                    }\n                });\n\n                return;\n            }\n\n            if (text) {\n                TdLibController.send({\n                    '@type': 'sendMessage',\n                    chat_id: targetChatId,\n                    reply_to_message_id: 0,\n                    disable_notifications: false,\n                    from_background: false,\n                    reply_markup: null,\n                    input_message_content: {\n                        '@type': 'inputMessageText',\n                        text: {\n                            '@type': 'formattedText',\n                            text: text,\n                            entities: null\n                        },\n                        disable_web_page_preview: true,\n                        clear_draft: false\n                    }\n                });\n            }\n\n            TdLibController.send({\n                '@type': 'forwardMessages',\n                chat_id: targetChatId,\n                from_chat_id: chatId,\n                message_ids: messageIds,\n                disable_notifications: false,\n                from_background: false,\n                as_album: false\n            });\n        });\n    };\n\n    handleChangeSelection = chatId => {\n        if (this.targetChats.has(chatId)) {\n            this.targetChats.delete(chatId);\n        } else {\n            this.targetChats.set(chatId, chatId);\n        }\n\n        console.log(this.targetChats);\n\n        this.forceUpdate();\n    };\n\n    getInnerText = div => {\n        const innerText = div.innerText;\n        const innerHTML = div.innerHTML;\n\n        if (innerText && innerText === '\\n' && innerHTML && (innerHTML === '<br>' || innerHTML === '<div><br></div>')) {\n            div.innerHTML = '';\n        }\n\n        return innerText;\n    };\n\n    handleSearchKeyDown = event => {\n        if (event.keyCode === 13) {\n            event.preventDefault();\n        }\n    };\n\n    handleSearchKeyUp = () => {\n        const { chatIds, savedMessages } = this.state;\n\n        const innerHTML = this.searchRef.current.innerHTML;\n        if (innerHTML && (innerHTML === '<br>' || innerHTML === '<div><br></div>')) {\n            this.searchRef.current.innerHTML = '';\n        }\n\n        const innerText = this.getInnerText(this.searchRef.current).trim();\n        if (!innerText) {\n            this.setState({ searchText: null, searchResults: [] });\n            return;\n        }\n\n        const latinText = getLatinInput(innerText);\n        const cyrillicText = getCyrillicInput(innerText);\n\n        const chatsSource = savedMessages\n            ? [savedMessages.id].concat(chatIds.filter(x => x !== savedMessages.id)).filter(x => canSendMessages(x))\n            : chatIds;\n\n        const searchResults = chatsSource.filter(\n            x =>\n                this.hasSearchText(x, innerText) ||\n                (latinText && this.hasSearchText(x, latinText)) ||\n                (cyrillicText && this.hasSearchText(x, cyrillicText))\n        );\n\n        this.setState({ searchText: innerText, searchResults: searchResults });\n    };\n\n    handleSearchPaste = event => {\n        const plainText = event.clipboardData.getData('text/plain');\n        if (plainText) {\n            event.preventDefault();\n            document.execCommand('insertHTML', false, plainText);\n        }\n    };\n\n    handleMessageKeyUp = () => {\n        const innerHTML = this.messageRef.current.innerHTML;\n        if (innerHTML && (innerHTML === '<br>' || innerHTML === '<div><br></div>')) {\n            this.messageRef.current.innerHTML = '';\n        }\n    };\n\n    handleMessagePaste = event => {\n        const plainText = event.clipboardData.getData('text/plain');\n        if (plainText) {\n            event.preventDefault();\n            document.execCommand('insertHTML', false, plainText);\n        }\n    };\n\n    hasSearchText = (chatId, searchText) => {\n        const { t } = this.props;\n        const { savedMessages } = this.state;\n\n        if (savedMessages && chatId === savedMessages.id) {\n            const title = getChatTitle(chatId, true, t) || '';\n            if (title.toLocaleLowerCase().indexOf(searchText.toLowerCase()) !== -1) {\n                return true;\n            }\n        }\n\n        const title1 = getChatTitle(chatId, false, t) || '';\n        if (title1.toLocaleLowerCase().indexOf(searchText.toLowerCase()) !== -1) {\n            return true;\n        }\n\n        const username = getChatUsername(chatId) || '';\n        if (username.toLocaleLowerCase().indexOf(searchText.toLowerCase()) !== -1) {\n            return true;\n        }\n\n        return false;\n    };\n\n    setSearchFocus = () => {\n        setTimeout(() => {\n            if (this.searchRef.current) {\n                const element = this.searchRef.current;\n\n                element.focus();\n            }\n        }, 100);\n    };\n\n    render() {\n        const { classes, t } = this.props;\n        const { chatIds, searchText, searchResults, savedMessages, publicMessageLink } = this.state;\n\n        const chatsSource = savedMessages\n            ? [savedMessages.id].concat(chatIds.filter(x => x !== savedMessages.id)).filter(x => canSendMessages(x))\n            : chatIds;\n\n        const chats = chatsSource.map(x => (\n            <ForwardTargetChat\n                key={x}\n                chatId={x}\n                selected={this.targetChats.has(x)}\n                onSelect={() => this.handleChangeSelection(x)}\n            />\n        ));\n\n        const foundChats = (searchResults || []).map(x => (\n            <ForwardTargetChat\n                key={x}\n                chatId={x}\n                selected={this.targetChats.has(x)}\n                onSelect={() => this.handleChangeSelection(x)}\n            />\n        ));\n\n        return (\n            <Dialog\n                open\n                onClose={this.handleClose}\n                aria-labelledby='forward-dialog-title'\n                aria-describedby='forward-dialog-description'\n                className={classes.dialog}>\n                <DialogTitle id='forward-dialog-title'>{t('ShareSendTo')}</DialogTitle>\n                <div\n                    ref={this.searchRef}\n                    id='forward-dialog-search'\n                    contentEditable\n                    suppressContentEditableWarning\n                    placeholder={t('Search')}\n                    onKeyDown={this.handleSearchKeyDown}\n                    onKeyUp={this.handleSearchKeyUp}\n                    onPaste={this.handleSearchPaste}\n                />\n                <div className={classNames(classes.borderColor, 'forward-dialog-content')}>\n                    <div className='forward-dialog-list'>{chats}</div>\n                    {searchText && (\n                        <div className={classNames(classes.searchList, 'forward-dialog-search-list')}>{foundChats}</div>\n                    )}\n                </div>\n                {this.targetChats.size > 0 && (\n                    <div\n                        ref={this.messageRef}\n                        id='forward-dialog-message'\n                        contentEditable\n                        suppressContentEditableWarning\n                        placeholder={t('ShareComment')}\n                        onKeyUp={this.handleMessageKeyUp}\n                        onPaste={this.handleMessagePaste}\n                    />\n                )}\n                <DialogActions>\n                    <Button onClick={this.handleClose} color='primary'>\n                        {t('Cancel')}\n                    </Button>\n                    {this.targetChats.size > 0 && (\n                        <Button onClick={this.handleSend} color='primary' autoFocus>\n                            {t('Send')}\n                        </Button>\n                    )}\n                    {!this.targetChats.size && publicMessageLink && (\n                        <Button onClick={this.handleCopyLink} color='primary'>\n                            {t('CopyLink')}\n                        </Button>\n                    )}\n                </DialogActions>\n            </Dialog>\n        );\n    }\n}\n\nForwardDialog.propTypes = {\n    chatId: PropTypes.number,\n    messageIds: PropTypes.array,\n    photoSize: PropTypes.object,\n    media: PropTypes.object\n};\n\nconst enhance = compose(\n    withStyles(styles, { withTheme: true }),\n    withTranslation(),\n    withSnackbar\n);\n\nexport default enhance(ForwardDialog);\n"]},"metadata":{},"sourceType":"module"}