{"ast":null,"code":"import _slicedToArray from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */var ActionScheduler=function ActionScheduler(actionCallback,cancelCallback){var _this=this;_classCallCheck(this,ActionScheduler);this.add=function(key,timeout,action,cancel){if(_this.actions.has(key)){return false;}var expire=new Date();expire.setMilliseconds(expire.getMilliseconds()+timeout);_this.actions.set(key,{expire:expire,action:action,cancel:cancel});if(_this.timerId){clearTimeout(_this.timerId);}_this.setTimeout();return true;};this.invoke=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(key){var item;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:item=_this.actions.get(key);if(item){_context.next=3;break;}return _context.abrupt(\"return\");case 3:_this.actions.delete(key);_context.next=6;return _this.actionCallback({key:key,action:item.action,cancel:item.cancel});case 6:if(!item.action){_context.next=9;break;}_context.next=9;return item.action();case 9:if(_this.timerId){clearTimeout(_this.timerId);}_this.setTimeout();case 11:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();this.remove=function(key){var item=_this.actions.get(key);if(!item)return;_this.actions.delete(key);_this.cancelCallback({key:key,action:item.action,cancel:item.cancel});if(item.cancel)item.cancel();if(_this.timerId){clearTimeout(_this.timerId);}_this.setTimeout();};this.setTimeout=function(){var now=new Date();var timeout=1000000;var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=_this.actions[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _ref4=_step.value;var _ref3=_slicedToArray(_ref4,2);var key=_ref3[0];var value=_ref3[1];var actionTimeout=value.expire-now;if(actionTimeout<timeout)timeout=actionTimeout;if(timeout<0)timeout=0;}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}if(timeout<1000000){_this.timerId=setTimeout(_this.handleTimer,timeout);}};this.handleTimer=function(){var now=new Date();var expired=[];var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=_this.actions[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var _ref7=_step2.value;var _ref6=_slicedToArray(_ref7,2);var key=_ref6[0];var value=_ref6[1];var actionTimeout=value.expire-now;if(actionTimeout<=0)expired.push({key:key,value:value});}}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return!=null){_iterator2.return();}}finally{if(_didIteratorError2){throw _iteratorError2;}}}for(var _i=0,_expired=expired;_i<_expired.length;_i++){var item=_expired[_i];_this.actions.delete(item.key);_this.actionCallback({key:item.key,action:item.value.action,cancel:item.value.cancel});if(item.value.action)item.value.action();}_this.setTimeout();};this.actions=new Map();this.actionCallback=actionCallback;this.cancelCallback=cancelCallback;};export default ActionScheduler;","map":{"version":3,"sources":["/home/me-admin/Downloads/my-app/src/Utils/ActionScheduler.js"],"names":["ActionScheduler","actionCallback","cancelCallback","add","key","timeout","action","cancel","actions","has","expire","Date","setMilliseconds","getMilliseconds","set","timerId","clearTimeout","setTimeout","invoke","item","get","delete","remove","now","value","actionTimeout","handleTimer","expired","push","Map"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nclass ActionScheduler {\n    constructor(actionCallback, cancelCallback) {\n        this.actions = new Map();\n        this.actionCallback = actionCallback;\n        this.cancelCallback = cancelCallback;\n    }\n\n    add = (key, timeout, action, cancel) => {\n        if (this.actions.has(key)) {\n            return false;\n        }\n\n        let expire = new Date();\n        expire.setMilliseconds(expire.getMilliseconds() + timeout);\n\n        this.actions.set(key, { expire: expire, action: action, cancel: cancel });\n\n        if (this.timerId) {\n            clearTimeout(this.timerId);\n        }\n\n        this.setTimeout();\n\n        return true;\n    };\n\n    invoke = async key => {\n        const item = this.actions.get(key);\n        if (!item) return;\n\n        this.actions.delete(key);\n\n        await this.actionCallback({ key: key, action: item.action, cancel: item.cancel });\n        if (item.action) await item.action();\n\n        if (this.timerId) {\n            clearTimeout(this.timerId);\n        }\n\n        this.setTimeout();\n    };\n\n    remove = key => {\n        const item = this.actions.get(key);\n        if (!item) return;\n\n        this.actions.delete(key);\n\n        this.cancelCallback({ key: key, action: item.action, cancel: item.cancel });\n        if (item.cancel) item.cancel();\n\n        if (this.timerId) {\n            clearTimeout(this.timerId);\n        }\n\n        this.setTimeout();\n    };\n\n    setTimeout = () => {\n        let now = new Date();\n        let timeout = 1000000;\n        for (let [key, value] of this.actions) {\n            let actionTimeout = value.expire - now;\n            if (actionTimeout < timeout) timeout = actionTimeout;\n            if (timeout < 0) timeout = 0;\n        }\n\n        if (timeout < 1000000) {\n            this.timerId = setTimeout(this.handleTimer, timeout);\n        }\n    };\n\n    handleTimer = () => {\n        let now = new Date();\n        let expired = [];\n        for (let [key, value] of this.actions) {\n            let actionTimeout = value.expire - now;\n            if (actionTimeout <= 0) expired.push({ key: key, value: value });\n        }\n\n        for (let item of expired) {\n            this.actions.delete(item.key);\n            this.actionCallback({ key: item.key, action: item.value.action, cancel: item.value.cancel });\n            if (item.value.action) item.value.action();\n        }\n\n        this.setTimeout();\n    };\n}\n\nexport default ActionScheduler;\n"]},"metadata":{},"sourceType":"module"}