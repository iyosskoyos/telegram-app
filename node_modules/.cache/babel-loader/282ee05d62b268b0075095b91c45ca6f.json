{"ast":null,"code":"import _regeneratorRuntime from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/inherits\";/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */import React from'react';import*as ReactDOM from'react-dom';import StickerSet from'./StickerSet';import StickersPickerHeader from'./StickersPickerHeader';import{debounce,throttle}from'../../Utils/Common';import{loadStickerContent,loadStickerSetContent}from'../../Utils/File';import{getNeighborStickersFromSets,getStickers}from'../../Utils/Media';import FileStore from'../../Stores/FileStore';import TdLibController from'../../Controllers/TdLibController';import'./StickersPicker.css';var StickersPicker=/*#__PURE__*/function(_React$Component){_inherits(StickersPicker,_React$Component);function StickersPicker(props){var _this;_classCallCheck(this,StickersPicker);_this=_possibleConstructorReturn(this,_getPrototypeOf(StickersPicker).call(this,props));_this.scrollTop=function(){_this.scrollRef.current.scrollTop=0;};_this.loadContent=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(stickerSets,sets){var result,promises,slicedSets,headerStickers;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!_this.state.stickerSets){_context.next=2;break;}return _context.abrupt(\"return\");case 2:if(sets){_context.next=11;break;}_context.next=5;return TdLibController.send({'@type':'getInstalledStickerSets',is_masks:false});case 5:result=_context.sent;promises=[];result.sets.forEach(function(x){promises.push(TdLibController.send({'@type':'getStickerSet',set_id:x.id}));});_context.next=10;return Promise.all(promises);case 10:sets=_context.sent;case 11:slicedSets=sets.slice(0,5);headerStickers=sets.reduce(function(preview,set){if(set.stickers.length>0){preview.push(set.stickers[0]);}return preview;},[]);_this.setState({stickerSets:stickerSets,sets:slicedSets,headerStickers:headerStickers});_this.setsLength=slicedSets.length;case 15:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();_this.loadInViewContentOnScroll=function(){_this.loadInViewContent();};_this.loadInViewContentOnScrollEnd=function(){_this.loadInViewContent(400);};_this.loadInViewContent=function(){var padding=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var scroll=_this.scrollRef.current;var sets=_this.state.sets;var inViewItems=[];sets.forEach(function(x){var item=_this.itemsMap.get(x.id);var node=ReactDOM.findDOMNode(item);if(node){var topBorder=scroll.scrollTop-padding;var bottomBorder=scroll.scrollTop+scroll.offsetHeight+padding;var nodeTop=node.offsetTop;var nodeBottom=node.offsetTop+node.clientHeight;if(nodeTop>=topBorder&&node.offsetTop<=bottomBorder){inViewItems.push(x);}else if(nodeBottom>=topBorder&&nodeBottom<=bottomBorder){inViewItems.push(x);}else if(nodeTop<=topBorder&&nodeBottom>=bottomBorder){inViewItems.push(x);}}});inViewItems.forEach(function(x){var store=FileStore.getStore();if(!_this.loadedSets.has(x.id)){_this.loadedSets.set(x.id,x.id);loadStickerSetContent(store,x);}});};_this.updatePosition=function(){var scroll=_this.scrollRef.current;var sets=_this.state.sets;var minDiff=scroll.scrollHeight;var position=0;var firstOffsetTop=0;sets.forEach(function(x,pos){var element=_this.itemsMap.get(x.id);if(element){var node=ReactDOM.findDOMNode(element);if(node){firstOffsetTop=pos===0?node.offsetTop:firstOffsetTop;var offsetTop=node.offsetTop-firstOffsetTop;if(node&&offsetTop<=scroll.scrollTop){var diff=Math.abs(scroll.scrollTop-offsetTop);if(diff<=minDiff){minDiff=diff;position=pos;}}}}});TdLibController.clientUpdate({'@type':'clientUpdateStickerSetPosition',position:position});};_this.handleScroll=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var scroll,loadChunk,_this$state,sets,stickerSets,promises,result,concatSets;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0://this.loadInViewContentOnScroll();\n_this.loadInViewContentOnScrollEnd();_this.updatePosition();scroll=_this.scrollRef.current;if(!_this.loadingChunk){_context2.next=5;break;}return _context2.abrupt(\"return\");case 5:loadChunk=false;if(scroll.scrollTop+scroll.offsetHeight>=scroll.scrollHeight-400){loadChunk=true;}if(loadChunk){_context2.next=9;break;}return _context2.abrupt(\"return\",false);case 9:_this$state=_this.state,sets=_this$state.sets,stickerSets=_this$state.stickerSets;if(!(stickerSets.sets.length===sets.length)){_context2.next=12;break;}return _context2.abrupt(\"return\");case 12:_this.loadingChunk=true;promises=[];stickerSets.sets.slice(_this.setsLength,_this.setsLength+5).forEach(function(x){promises.push(TdLibController.send({'@type':'getStickerSet',set_id:x.id}));});_context2.next=17;return Promise.all(promises).finally(function(){return _this.loadingChunk=false;});case 17:result=_context2.sent;_this.setsLength+=result.length;concatSets=sets.concat(result);_this.setState({sets:concatSets});case 21:case\"end\":return _context2.stop();}}},_callee2);}));_this.loadPreviewContent=function(stickerId){var sets=_this.state.sets;var sticker=getStickers(sets).find(function(x){return x.sticker.id===stickerId;});if(!sticker)return;var store=FileStore.getStore();loadStickerContent(store,sticker,null);var stickersPerRow=5;var preloadStickers=getNeighborStickersFromSets(sticker,sets,stickersPerRow);preloadStickers.forEach(function(x){loadStickerContent(store,x,null);});};_this.handleMouseEnter=function(event){var stickerId=Number(event.currentTarget.dataset.stickerId);if(!stickerId)return;if(!_this.mouseDown)return;if(_this.mouseDownStickerId!==stickerId){_this.mouseDownStickerId=null;}_this.setState({previewStickerId:stickerId});_this.loadPreviewContent(stickerId);var onPreview=_this.props.onPreview;var sets=_this.state.sets;var sticker=getStickers(sets).find(function(x){return x.sticker.id===stickerId;});onPreview(sticker);};_this.handleMouseDown=function(event){var stickerId=Number(event.currentTarget.dataset.stickerId);if(!stickerId)return;_this.mouseDownStickerId=stickerId;var now=Date.now();_this.setState({previewStickerId:stickerId,timestamp:now,showPreview:false,cancelSend:false});setTimeout(function(){var timestamp=_this.state.timestamp;if(timestamp===now){_this.setState({showPreview:true,cancelSend:true},function(){var onPreview=_this.props.onPreview;var sets=_this.state.sets;var sticker=getStickers(sets).find(function(x){return x.sticker.id===stickerId;});onPreview(sticker);});}},500);_this.loadPreviewContent(stickerId);_this.mouseDown=true;document.addEventListener('mouseup',_this.handleMouseUp);event.preventDefault();event.stopPropagation();return false;};_this.handleMouseUp=function(){_this.setState({previewStickerId:0,timestamp:0,showPreview:false});var onPreview=_this.props.onPreview;onPreview(null);_this.mouseDown=false;document.removeEventListener('mouseup',_this.handleMouseUp);};_this.handleStickerSelect=function(sticker){var onSelect=_this.props.onSelect;var cancelSend=_this.state.cancelSend;if(cancelSend)return;onSelect(sticker);};_this.handleSelectSet=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(position){var _this$state2,sets,stickerSets,_assertThisInitialize,scrollRef,element,node,scroll,promises,result,concatSets;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_this$state2=_this.state,sets=_this$state2.sets,stickerSets=_this$state2.stickerSets;_assertThisInitialize=_assertThisInitialized(_this),scrollRef=_assertThisInitialize.scrollRef;if(!(position<sets.length)){_context3.next=7;break;}element=_this.itemsMap.get(sets[position].id);if(element){node=ReactDOM.findDOMNode(element);if(node){scroll=scrollRef.current;scroll.scrollTop=node.offsetTop;}}_context3.next=21;break;case 7:if(!(position<stickerSets.sets.length)){_context3.next=21;break;}if(!_this.loadingChunk){_context3.next=10;break;}return _context3.abrupt(\"return\");case 10:if(!(stickerSets.sets.length===sets.length)){_context3.next=12;break;}return _context3.abrupt(\"return\");case 12:_this.loadingChunk=true;promises=[];stickerSets.sets.slice(_this.setsLength,position+1).forEach(function(x){promises.push(TdLibController.send({'@type':'getStickerSet',set_id:x.id}));});_context3.next=17;return Promise.all(promises).finally(function(){return _this.loadingChunk=false;});case 17:result=_context3.sent;_this.setsLength+=result.length;concatSets=sets.concat(result);_this.setState({sets:concatSets},function(){if(position<concatSets.length){_this.handleSelectSet(position);}});case 21:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}();_this.scrollRef=React.createRef();_this.itemsMap=new Map();_this.loadedSets=new Map();_this.state={stickerSets:null,sets:[],headerStickers:[],position:0};_this.loadInViewContentOnScrollEnd=debounce(_this.loadInViewContentOnScrollEnd,100);_this.loadInViewContentOnScroll=throttle(_this.loadInViewContentOnScroll,2000);_this.updatePosition=throttle(_this.updatePosition,250);return _this;}_createClass(StickersPicker,[{key:\"shouldComponentUpdate\",value:function shouldComponentUpdate(nextProps,nextState,nextContext){var _this$state3=this.state,position=_this$state3.position,stickerSets=_this$state3.stickerSets,sets=_this$state3.sets,showPreview=_this$state3.showPreview;if(nextState.stickerSets!==stickerSets){return true;}if(nextState.sets!==sets){return true;}if(nextState.showPreview!==showPreview){return true;}if(nextState.position!==position){return true;}return false;}},{key:\"render\",value:function render(){var _this2=this;var _this$state4=this.state,stickerSets=_this$state4.stickerSets,sets=_this$state4.sets,headerStickers=_this$state4.headerStickers;if(!stickerSets)return null;if(!sets)return null;if(!sets.length)return null;this.itemsMap.clear();var items=sets.map(function(x){return React.createElement(StickerSet,{key:x.id,ref:function ref(el){return _this2.itemsMap.set(x.id,el);},info:x,onSelect:_this2.handleStickerSelect,onMouseDown:_this2.handleMouseDown,onMouseEnter:_this2.handleMouseEnter});});return React.createElement(\"div\",{className:\"stickers-picker\"},React.createElement(StickersPickerHeader,{onSelect:this.handleSelectSet,stickers:headerStickers}),React.createElement(\"div\",{ref:this.scrollRef,className:\"stickers-picker-scroll\",onScroll:this.handleScroll},items));}}]);return StickersPicker;}(React.Component);export default StickersPicker;","map":{"version":3,"sources":["/home/me-admin/Downloads/my-app/src/Components/ColumnMiddle/StickersPicker.js"],"names":["React","ReactDOM","StickerSet","StickersPickerHeader","debounce","throttle","loadStickerContent","loadStickerSetContent","getNeighborStickersFromSets","getStickers","FileStore","TdLibController","StickersPicker","props","scrollTop","scrollRef","current","loadContent","stickerSets","sets","state","send","is_masks","result","promises","forEach","x","push","set_id","id","Promise","all","slicedSets","slice","headerStickers","reduce","preview","set","stickers","length","setState","setsLength","loadInViewContentOnScroll","loadInViewContent","loadInViewContentOnScrollEnd","padding","scroll","inViewItems","item","itemsMap","get","node","findDOMNode","topBorder","bottomBorder","offsetHeight","nodeTop","offsetTop","nodeBottom","clientHeight","store","getStore","loadedSets","has","updatePosition","minDiff","scrollHeight","position","firstOffsetTop","pos","element","diff","Math","abs","clientUpdate","handleScroll","loadingChunk","loadChunk","finally","concatSets","concat","loadPreviewContent","stickerId","sticker","find","stickersPerRow","preloadStickers","handleMouseEnter","event","Number","currentTarget","dataset","mouseDown","mouseDownStickerId","previewStickerId","onPreview","handleMouseDown","now","Date","timestamp","showPreview","cancelSend","setTimeout","document","addEventListener","handleMouseUp","preventDefault","stopPropagation","removeEventListener","handleStickerSelect","onSelect","handleSelectSet","createRef","Map","nextProps","nextState","nextContext","clear","items","map","el","Component"],"mappings":"26BAAA;;;;;GAOA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAO,GAAKC,CAAAA,QAAZ,KAA0B,WAA1B,CAEA,MAAOC,CAAAA,UAAP,KAAuB,cAAvB,CACA,MAAOC,CAAAA,oBAAP,KAAiC,wBAAjC,CACA,OAASC,QAAT,CAAmBC,QAAnB,KAAmC,oBAAnC,CACA,OAASC,kBAAT,CAA6BC,qBAA7B,KAA0D,kBAA1D,CACA,OAASC,2BAAT,CAAsCC,WAAtC,KAAyD,mBAAzD,CACA,MAAOC,CAAAA,SAAP,KAAsB,wBAAtB,CACA,MAAOC,CAAAA,eAAP,KAA4B,mCAA5B,CACA,MAAO,sBAAP,C,GAEMC,CAAAA,c,oFACF,wBAAYC,KAAZ,CAAmB,gDACf,gFAAMA,KAAN,GADe,MAyCnBC,SAzCmB,CAyCP,UAAM,CACd,MAAKC,SAAL,CAAeC,OAAf,CAAuBF,SAAvB,CAAmC,CAAnC,CACH,CA3CkB,OA6CnBG,WA7CmB,0FA6CL,iBAAOC,WAAP,CAAoBC,IAApB,oKACN,MAAKC,KAAL,CAAWF,WADL,oEAGLC,IAHK,gDAIeR,CAAAA,eAAe,CAACU,IAAhB,CAAqB,CACtC,QAAS,yBAD6B,CAEtCC,QAAQ,CAAE,KAF4B,CAArB,CAJf,QAIAC,MAJA,eASAC,QATA,CASW,EATX,CAUND,MAAM,CAACJ,IAAP,CAAYM,OAAZ,CAAoB,SAAAC,CAAC,CAAI,CACrBF,QAAQ,CAACG,IAAT,CACIhB,eAAe,CAACU,IAAhB,CAAqB,CACjB,QAAS,eADQ,CAEjBO,MAAM,CAAEF,CAAC,CAACG,EAFO,CAArB,CADJ,EAMH,CAPD,EAVM,uBAmBOC,CAAAA,OAAO,CAACC,GAAR,CAAYP,QAAZ,CAnBP,SAmBNL,IAnBM,uBAsBJa,UAtBI,CAsBSb,IAAI,CAACc,KAAL,CAAW,CAAX,CAAc,CAAd,CAtBT,CAuBJC,cAvBI,CAuBaf,IAAI,CAACgB,MAAL,CAAY,SAACC,OAAD,CAAUC,GAAV,CAAkB,CACjD,GAAIA,GAAG,CAACC,QAAJ,CAAaC,MAAb,CAAsB,CAA1B,CAA6B,CACzBH,OAAO,CAACT,IAAR,CAAaU,GAAG,CAACC,QAAJ,CAAa,CAAb,CAAb,EACH,CACD,MAAOF,CAAAA,OAAP,CACH,CALsB,CAKpB,EALoB,CAvBb,CA6BV,MAAKI,QAAL,CAAc,CACVtB,WAAW,CAAXA,WADU,CAEVC,IAAI,CAAEa,UAFI,CAGVE,cAAc,CAAdA,cAHU,CAAd,EAKA,MAAKO,UAAL,CAAkBT,UAAU,CAACO,MAA7B,CAlCU,uDA7CK,yEAkFnBG,yBAlFmB,CAkFS,UAAM,CAC9B,MAAKC,iBAAL,GACH,CApFkB,OAsFnBC,4BAtFmB,CAsFY,UAAM,CACjC,MAAKD,iBAAL,CAAuB,GAAvB,EACH,CAxFkB,OA0FnBA,iBA1FmB,CA0FC,UAAiB,IAAhBE,CAAAA,OAAgB,2DAAN,CAAM,CACjC,GAAMC,CAAAA,MAAM,CAAG,MAAK/B,SAAL,CAAeC,OAA9B,CADiC,GAGzBG,CAAAA,IAHyB,CAGhB,MAAKC,KAHW,CAGzBD,IAHyB,CAKjC,GAAM4B,CAAAA,WAAW,CAAG,EAApB,CACA5B,IAAI,CAACM,OAAL,CAAa,SAAAC,CAAC,CAAI,CACd,GAAMsB,CAAAA,IAAI,CAAG,MAAKC,QAAL,CAAcC,GAAd,CAAkBxB,CAAC,CAACG,EAApB,CAAb,CACA,GAAMsB,CAAAA,IAAI,CAAGlD,QAAQ,CAACmD,WAAT,CAAqBJ,IAArB,CAAb,CACA,GAAIG,IAAJ,CAAU,CACN,GAAME,CAAAA,SAAS,CAAGP,MAAM,CAAChC,SAAP,CAAmB+B,OAArC,CACA,GAAMS,CAAAA,YAAY,CAAGR,MAAM,CAAChC,SAAP,CAAmBgC,MAAM,CAACS,YAA1B,CAAyCV,OAA9D,CAEA,GAAMW,CAAAA,OAAO,CAAGL,IAAI,CAACM,SAArB,CACA,GAAMC,CAAAA,UAAU,CAAGP,IAAI,CAACM,SAAL,CAAiBN,IAAI,CAACQ,YAAzC,CAEA,GAAIH,OAAO,EAAIH,SAAX,EAAwBF,IAAI,CAACM,SAAL,EAAkBH,YAA9C,CAA4D,CACxDP,WAAW,CAACpB,IAAZ,CAAiBD,CAAjB,EACH,CAFD,IAEO,IAAIgC,UAAU,EAAIL,SAAd,EAA2BK,UAAU,EAAIJ,YAA7C,CAA2D,CAC9DP,WAAW,CAACpB,IAAZ,CAAiBD,CAAjB,EACH,CAFM,IAEA,IAAI8B,OAAO,EAAIH,SAAX,EAAwBK,UAAU,EAAIJ,YAA1C,CAAwD,CAC3DP,WAAW,CAACpB,IAAZ,CAAiBD,CAAjB,EACH,CACJ,CACJ,CAlBD,EAoBAqB,WAAW,CAACtB,OAAZ,CAAoB,SAAAC,CAAC,CAAI,CACrB,GAAMkC,CAAAA,KAAK,CAAGlD,SAAS,CAACmD,QAAV,EAAd,CACA,GAAI,CAAC,MAAKC,UAAL,CAAgBC,GAAhB,CAAoBrC,CAAC,CAACG,EAAtB,CAAL,CAAgC,CAC5B,MAAKiC,UAAL,CAAgBzB,GAAhB,CAAoBX,CAAC,CAACG,EAAtB,CAA0BH,CAAC,CAACG,EAA5B,EACAtB,qBAAqB,CAACqD,KAAD,CAAQlC,CAAR,CAArB,CACH,CACJ,CAND,EAOH,CA3HkB,OA6HnBsC,cA7HmB,CA6HF,UAAM,CACnB,GAAMlB,CAAAA,MAAM,CAAG,MAAK/B,SAAL,CAAeC,OAA9B,CADmB,GAGXG,CAAAA,IAHW,CAGF,MAAKC,KAHH,CAGXD,IAHW,CAInB,GAAI8C,CAAAA,OAAO,CAAGnB,MAAM,CAACoB,YAArB,CACA,GAAIC,CAAAA,QAAQ,CAAG,CAAf,CACA,GAAIC,CAAAA,cAAc,CAAG,CAArB,CACAjD,IAAI,CAACM,OAAL,CAAa,SAACC,CAAD,CAAI2C,GAAJ,CAAY,CACrB,GAAMC,CAAAA,OAAO,CAAG,MAAKrB,QAAL,CAAcC,GAAd,CAAkBxB,CAAC,CAACG,EAApB,CAAhB,CACA,GAAIyC,OAAJ,CAAa,CACT,GAAMnB,CAAAA,IAAI,CAAGlD,QAAQ,CAACmD,WAAT,CAAqBkB,OAArB,CAAb,CACA,GAAInB,IAAJ,CAAU,CACNiB,cAAc,CAAGC,GAAG,GAAK,CAAR,CAAYlB,IAAI,CAACM,SAAjB,CAA6BW,cAA9C,CAEA,GAAMX,CAAAA,SAAS,CAAGN,IAAI,CAACM,SAAL,CAAiBW,cAAnC,CACA,GAAIjB,IAAI,EAAIM,SAAS,EAAIX,MAAM,CAAChC,SAAhC,CAA2C,CACvC,GAAMyD,CAAAA,IAAI,CAAGC,IAAI,CAACC,GAAL,CAAS3B,MAAM,CAAChC,SAAP,CAAmB2C,SAA5B,CAAb,CACA,GAAIc,IAAI,EAAIN,OAAZ,CAAqB,CACjBA,OAAO,CAAGM,IAAV,CACAJ,QAAQ,CAAGE,GAAX,CACH,CACJ,CACJ,CACJ,CACJ,CAjBD,EAmBA1D,eAAe,CAAC+D,YAAhB,CAA6B,CACzB,QAAS,gCADgB,CAEzBP,QAAQ,CAARA,QAFyB,CAA7B,EAIH,CA3JkB,OA6JnBQ,YA7JmB,sEA6JJ,qNACX;AACA,MAAK/B,4BAAL,GACA,MAAKoB,cAAL,GAEMlB,MALK,CAKI,MAAK/B,SAAL,CAAeC,OALnB,KAOP,MAAK4D,YAPE,mEASPC,SATO,CASK,KATL,CAUX,GAAI/B,MAAM,CAAChC,SAAP,CAAmBgC,MAAM,CAACS,YAA1B,EAA0CT,MAAM,CAACoB,YAAP,CAAsB,GAApE,CAAyE,CACrEW,SAAS,CAAG,IAAZ,CACH,CAZU,GAcNA,SAdM,2DAeA,KAfA,qBAkBmB,MAAKzD,KAlBxB,CAkBHD,IAlBG,aAkBHA,IAlBG,CAkBGD,WAlBH,aAkBGA,WAlBH,MAmBPA,WAAW,CAACC,IAAZ,CAAiBoB,MAAjB,GAA4BpB,IAAI,CAACoB,MAnB1B,sEAqBX,MAAKqC,YAAL,CAAoB,IAApB,CACMpD,QAtBK,CAsBM,EAtBN,CAuBXN,WAAW,CAACC,IAAZ,CAAiBc,KAAjB,CAAuB,MAAKQ,UAA5B,CAAwC,MAAKA,UAAL,CAAkB,CAA1D,EAA6DhB,OAA7D,CAAqE,SAAAC,CAAC,CAAI,CACtEF,QAAQ,CAACG,IAAT,CACIhB,eAAe,CAACU,IAAhB,CAAqB,CACjB,QAAS,eADQ,CAEjBO,MAAM,CAAEF,CAAC,CAACG,EAFO,CAArB,CADJ,EAMH,CAPD,EAvBW,wBAgCUC,CAAAA,OAAO,CAACC,GAAR,CAAYP,QAAZ,EAAsBsD,OAAtB,CAA8B,iBAAO,OAAKF,YAAL,CAAoB,KAA3B,EAA9B,CAhCV,SAgCLrD,MAhCK,gBAkCX,MAAKkB,UAAL,EAAmBlB,MAAM,CAACgB,MAA1B,CACIwC,UAnCO,CAmCM5D,IAAI,CAAC6D,MAAL,CAAYzD,MAAZ,CAnCN,CAoCX,MAAKiB,QAAL,CAAc,CAAErB,IAAI,CAAE4D,UAAR,CAAd,EApCW,yDA7JI,SAoMnBE,kBApMmB,CAoME,SAAAC,SAAS,CAAI,IACtB/D,CAAAA,IADsB,CACb,MAAKC,KADQ,CACtBD,IADsB,CAG9B,GAAMgE,CAAAA,OAAO,CAAG1E,WAAW,CAACU,IAAD,CAAX,CAAkBiE,IAAlB,CAAuB,SAAA1D,CAAC,QAAIA,CAAAA,CAAC,CAACyD,OAAF,CAAUtD,EAAV,GAAiBqD,SAArB,EAAxB,CAAhB,CACA,GAAI,CAACC,OAAL,CAAc,OAEd,GAAMvB,CAAAA,KAAK,CAAGlD,SAAS,CAACmD,QAAV,EAAd,CACAvD,kBAAkB,CAACsD,KAAD,CAAQuB,OAAR,CAAiB,IAAjB,CAAlB,CAEA,GAAME,CAAAA,cAAc,CAAG,CAAvB,CACA,GAAMC,CAAAA,eAAe,CAAG9E,2BAA2B,CAAC2E,OAAD,CAAUhE,IAAV,CAAgBkE,cAAhB,CAAnD,CACAC,eAAe,CAAC7D,OAAhB,CAAwB,SAAAC,CAAC,CAAI,CACzBpB,kBAAkB,CAACsD,KAAD,CAAQlC,CAAR,CAAW,IAAX,CAAlB,CACH,CAFD,EAGH,CAlNkB,OAoNnB6D,gBApNmB,CAoNA,SAAAC,KAAK,CAAI,CACxB,GAAMN,CAAAA,SAAS,CAAGO,MAAM,CAACD,KAAK,CAACE,aAAN,CAAoBC,OAApB,CAA4BT,SAA7B,CAAxB,CACA,GAAI,CAACA,SAAL,CAAgB,OAEhB,GAAI,CAAC,MAAKU,SAAV,CAAqB,OAErB,GAAI,MAAKC,kBAAL,GAA4BX,SAAhC,CAA2C,CACvC,MAAKW,kBAAL,CAA0B,IAA1B,CACH,CACD,MAAKrD,QAAL,CAAc,CAAEsD,gBAAgB,CAAEZ,SAApB,CAAd,EACA,MAAKD,kBAAL,CAAwBC,SAAxB,EAVwB,GAYhBa,CAAAA,SAZgB,CAYF,MAAKlF,KAZH,CAYhBkF,SAZgB,IAahB5E,CAAAA,IAbgB,CAaP,MAAKC,KAbE,CAahBD,IAbgB,CAexB,GAAMgE,CAAAA,OAAO,CAAG1E,WAAW,CAACU,IAAD,CAAX,CAAkBiE,IAAlB,CAAuB,SAAA1D,CAAC,QAAIA,CAAAA,CAAC,CAACyD,OAAF,CAAUtD,EAAV,GAAiBqD,SAArB,EAAxB,CAAhB,CACAa,SAAS,CAACZ,OAAD,CAAT,CACH,CArOkB,OAuOnBa,eAvOmB,CAuOD,SAAAR,KAAK,CAAI,CACvB,GAAMN,CAAAA,SAAS,CAAGO,MAAM,CAACD,KAAK,CAACE,aAAN,CAAoBC,OAApB,CAA4BT,SAA7B,CAAxB,CACA,GAAI,CAACA,SAAL,CAAgB,OAEhB,MAAKW,kBAAL,CAA0BX,SAA1B,CACA,GAAMe,CAAAA,GAAG,CAAGC,IAAI,CAACD,GAAL,EAAZ,CAEA,MAAKzD,QAAL,CAAc,CAAEsD,gBAAgB,CAAEZ,SAApB,CAA+BiB,SAAS,CAAEF,GAA1C,CAA+CG,WAAW,CAAE,KAA5D,CAAmEC,UAAU,CAAE,KAA/E,CAAd,EACAC,UAAU,CAAC,UAAM,IACLH,CAAAA,SADK,CACS,MAAK/E,KADd,CACL+E,SADK,CAEb,GAAIA,SAAS,GAAKF,GAAlB,CAAuB,CACnB,MAAKzD,QAAL,CAAc,CAAE4D,WAAW,CAAE,IAAf,CAAqBC,UAAU,CAAE,IAAjC,CAAd,CAAuD,UAAM,IACjDN,CAAAA,SADiD,CACnC,MAAKlF,KAD8B,CACjDkF,SADiD,IAEjD5E,CAAAA,IAFiD,CAExC,MAAKC,KAFmC,CAEjDD,IAFiD,CAIzD,GAAMgE,CAAAA,OAAO,CAAG1E,WAAW,CAACU,IAAD,CAAX,CAAkBiE,IAAlB,CAAuB,SAAA1D,CAAC,QAAIA,CAAAA,CAAC,CAACyD,OAAF,CAAUtD,EAAV,GAAiBqD,SAArB,EAAxB,CAAhB,CACAa,SAAS,CAACZ,OAAD,CAAT,CACH,CAND,EAOH,CACJ,CAXS,CAWP,GAXO,CAAV,CAaA,MAAKF,kBAAL,CAAwBC,SAAxB,EAEA,MAAKU,SAAL,CAAiB,IAAjB,CACAW,QAAQ,CAACC,gBAAT,CAA0B,SAA1B,CAAqC,MAAKC,aAA1C,EAEAjB,KAAK,CAACkB,cAAN,GACAlB,KAAK,CAACmB,eAAN,GACA,MAAO,MAAP,CACH,CApQkB,OAsQnBF,aAtQmB,CAsQH,UAAM,CAClB,MAAKjE,QAAL,CAAc,CAAEsD,gBAAgB,CAAE,CAApB,CAAuBK,SAAS,CAAE,CAAlC,CAAqCC,WAAW,CAAE,KAAlD,CAAd,EADkB,GAGVL,CAAAA,SAHU,CAGI,MAAKlF,KAHT,CAGVkF,SAHU,CAKlBA,SAAS,CAAC,IAAD,CAAT,CAEA,MAAKH,SAAL,CAAiB,KAAjB,CACAW,QAAQ,CAACK,mBAAT,CAA6B,SAA7B,CAAwC,MAAKH,aAA7C,EACH,CA/QkB,OAiRnBI,mBAjRmB,CAiRG,SAAA1B,OAAO,CAAI,IACrB2B,CAAAA,QADqB,CACR,MAAKjG,KADG,CACrBiG,QADqB,IAErBT,CAAAA,UAFqB,CAEN,MAAKjF,KAFC,CAErBiF,UAFqB,CAI7B,GAAIA,UAAJ,CAAgB,OAEhBS,QAAQ,CAAC3B,OAAD,CAAR,CACH,CAxRkB,OA0RnB4B,eA1RmB,2FA0RD,kBAAM5C,QAAN,oPACgB,MAAK/C,KADrB,CACND,IADM,cACNA,IADM,CACAD,WADA,cACAA,WADA,qDAENH,SAFM,uBAENA,SAFM,MAIVoD,QAAQ,CAAGhD,IAAI,CAACoB,MAJN,2BAKJ+B,OALI,CAKM,MAAKrB,QAAL,CAAcC,GAAd,CAAkB/B,IAAI,CAACgD,QAAD,CAAJ,CAAetC,EAAjC,CALN,CAMV,GAAIyC,OAAJ,CAAa,CACHnB,IADG,CACIlD,QAAQ,CAACmD,WAAT,CAAqBkB,OAArB,CADJ,CAET,GAAInB,IAAJ,CAAU,CACAL,MADA,CACS/B,SAAS,CAACC,OADnB,CAEN8B,MAAM,CAAChC,SAAP,CAAmBqC,IAAI,CAACM,SAAxB,CACH,CACJ,CAZS,oCAaHU,QAAQ,CAAGjD,WAAW,CAACC,IAAZ,CAAiBoB,MAbzB,gCAcN,MAAKqC,YAdC,0EAeN1D,WAAW,CAACC,IAAZ,CAAiBoB,MAAjB,GAA4BpB,IAAI,CAACoB,MAf3B,sEAiBV,MAAKqC,YAAL,CAAoB,IAApB,CACMpD,QAlBI,CAkBO,EAlBP,CAmBVN,WAAW,CAACC,IAAZ,CAAiBc,KAAjB,CAAuB,MAAKQ,UAA5B,CAAwC0B,QAAQ,CAAG,CAAnD,EAAsD1C,OAAtD,CAA8D,SAAAC,CAAC,CAAI,CAC/DF,QAAQ,CAACG,IAAT,CACIhB,eAAe,CAACU,IAAhB,CAAqB,CACjB,QAAS,eADQ,CAEjBO,MAAM,CAAEF,CAAC,CAACG,EAFO,CAArB,CADJ,EAMH,CAPD,EAnBU,wBA4BWC,CAAAA,OAAO,CAACC,GAAR,CAAYP,QAAZ,EAAsBsD,OAAtB,CAA8B,iBAAO,OAAKF,YAAL,CAAoB,KAA3B,EAA9B,CA5BX,SA4BJrD,MA5BI,gBA8BV,MAAKkB,UAAL,EAAmBlB,MAAM,CAACgB,MAA1B,CACIwC,UA/BM,CA+BO5D,IAAI,CAAC6D,MAAL,CAAYzD,MAAZ,CA/BP,CAgCV,MAAKiB,QAAL,CAAc,CAAErB,IAAI,CAAE4D,UAAR,CAAd,CAAoC,UAAM,CACtC,GAAIZ,QAAQ,CAAGY,UAAU,CAACxC,MAA1B,CAAkC,CAC9B,MAAKwE,eAAL,CAAqB5C,QAArB,EACH,CACJ,CAJD,EAhCU,yDA1RC,iEAGf,MAAKpD,SAAL,CAAiBf,KAAK,CAACgH,SAAN,EAAjB,CACA,MAAK/D,QAAL,CAAgB,GAAIgE,CAAAA,GAAJ,EAAhB,CACA,MAAKnD,UAAL,CAAkB,GAAImD,CAAAA,GAAJ,EAAlB,CAEA,MAAK7F,KAAL,CAAa,CACTF,WAAW,CAAE,IADJ,CAETC,IAAI,CAAE,EAFG,CAGTe,cAAc,CAAE,EAHP,CAITiC,QAAQ,CAAE,CAJD,CAAb,CAOA,MAAKvB,4BAAL,CAAoCxC,QAAQ,CAAC,MAAKwC,4BAAN,CAAoC,GAApC,CAA5C,CACA,MAAKF,yBAAL,CAAiCrC,QAAQ,CAAC,MAAKqC,yBAAN,CAAiC,IAAjC,CAAzC,CACA,MAAKsB,cAAL,CAAsB3D,QAAQ,CAAC,MAAK2D,cAAN,CAAsB,GAAtB,CAA9B,CAhBe,aAiBlB,C,+FAEqBkD,S,CAAWC,S,CAAWC,W,CAAa,kBACA,KAAKhG,KADL,CAC7C+C,QAD6C,cAC7CA,QAD6C,CACnCjD,WADmC,cACnCA,WADmC,CACtBC,IADsB,cACtBA,IADsB,CAChBiF,WADgB,cAChBA,WADgB,CAGrD,GAAIe,SAAS,CAACjG,WAAV,GAA0BA,WAA9B,CAA2C,CACvC,MAAO,KAAP,CACH,CAED,GAAIiG,SAAS,CAAChG,IAAV,GAAmBA,IAAvB,CAA6B,CACzB,MAAO,KAAP,CACH,CAED,GAAIgG,SAAS,CAACf,WAAV,GAA0BA,WAA9B,CAA2C,CACvC,MAAO,KAAP,CACH,CAED,GAAIe,SAAS,CAAChD,QAAV,GAAuBA,QAA3B,CAAqC,CACjC,MAAO,KAAP,CACH,CAED,MAAO,MAAP,CACH,C,uCA2RQ,kCACyC,KAAK/C,KAD9C,CACGF,WADH,cACGA,WADH,CACgBC,IADhB,cACgBA,IADhB,CACsBe,cADtB,cACsBA,cADtB,CAEL,GAAI,CAAChB,WAAL,CAAkB,MAAO,KAAP,CAElB,GAAI,CAACC,IAAL,CAAW,MAAO,KAAP,CACX,GAAI,CAACA,IAAI,CAACoB,MAAV,CAAkB,MAAO,KAAP,CAElB,KAAKU,QAAL,CAAcoE,KAAd,GACA,GAAMC,CAAAA,KAAK,CAAGnG,IAAI,CAACoG,GAAL,CAAS,SAAA7F,CAAC,QACpB,qBAAC,UAAD,EACI,GAAG,CAAEA,CAAC,CAACG,EADX,CAEI,GAAG,CAAE,aAAA2F,EAAE,QAAI,CAAA,MAAI,CAACvE,QAAL,CAAcZ,GAAd,CAAkBX,CAAC,CAACG,EAApB,CAAwB2F,EAAxB,CAAJ,EAFX,CAGI,IAAI,CAAE9F,CAHV,CAII,QAAQ,CAAE,MAAI,CAACmF,mBAJnB,CAKI,WAAW,CAAE,MAAI,CAACb,eALtB,CAMI,YAAY,CAAE,MAAI,CAACT,gBANvB,EADoB,EAAV,CAAd,CAWA,MACI,4BAAK,SAAS,CAAC,iBAAf,EACI,oBAAC,oBAAD,EAAsB,QAAQ,CAAE,KAAKwB,eAArC,CAAsD,QAAQ,CAAE7E,cAAhE,EADJ,CAEI,2BAAK,GAAG,CAAE,KAAKnB,SAAf,CAA0B,SAAS,CAAC,wBAApC,CAA6D,QAAQ,CAAE,KAAK4D,YAA5E,EACK2C,KADL,CAFJ,CADJ,CAQH,C,4BA9VwBtH,KAAK,CAACyH,S,EAsWnC,cAAe7G,CAAAA,cAAf","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport PropTypes from 'prop-types';\nimport StickerSet from './StickerSet';\nimport StickersPickerHeader from './StickersPickerHeader';\nimport { debounce, throttle } from '../../Utils/Common';\nimport { loadStickerContent, loadStickerSetContent } from '../../Utils/File';\nimport { getNeighborStickersFromSets, getStickers } from '../../Utils/Media';\nimport FileStore from '../../Stores/FileStore';\nimport TdLibController from '../../Controllers/TdLibController';\nimport './StickersPicker.css';\n\nclass StickersPicker extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.scrollRef = React.createRef();\n        this.itemsMap = new Map();\n        this.loadedSets = new Map();\n\n        this.state = {\n            stickerSets: null,\n            sets: [],\n            headerStickers: [],\n            position: 0\n        };\n\n        this.loadInViewContentOnScrollEnd = debounce(this.loadInViewContentOnScrollEnd, 100);\n        this.loadInViewContentOnScroll = throttle(this.loadInViewContentOnScroll, 2000);\n        this.updatePosition = throttle(this.updatePosition, 250);\n    }\n\n    shouldComponentUpdate(nextProps, nextState, nextContext) {\n        const { position, stickerSets, sets, showPreview } = this.state;\n\n        if (nextState.stickerSets !== stickerSets) {\n            return true;\n        }\n\n        if (nextState.sets !== sets) {\n            return true;\n        }\n\n        if (nextState.showPreview !== showPreview) {\n            return true;\n        }\n\n        if (nextState.position !== position) {\n            return true;\n        }\n\n        return false;\n    }\n\n    scrollTop = () => {\n        this.scrollRef.current.scrollTop = 0;\n    };\n\n    loadContent = async (stickerSets, sets) => {\n        if (this.state.stickerSets) return;\n\n        if (!sets) {\n            const result = await TdLibController.send({\n                '@type': 'getInstalledStickerSets',\n                is_masks: false\n            });\n\n            const promises = [];\n            result.sets.forEach(x => {\n                promises.push(\n                    TdLibController.send({\n                        '@type': 'getStickerSet',\n                        set_id: x.id\n                    })\n                );\n            });\n\n            sets = await Promise.all(promises);\n        }\n\n        const slicedSets = sets.slice(0, 5);\n        const headerStickers = sets.reduce((preview, set) => {\n            if (set.stickers.length > 0) {\n                preview.push(set.stickers[0]);\n            }\n            return preview;\n        }, []);\n        this.setState({\n            stickerSets,\n            sets: slicedSets,\n            headerStickers\n        });\n        this.setsLength = slicedSets.length;\n    };\n\n    loadInViewContentOnScroll = () => {\n        this.loadInViewContent();\n    };\n\n    loadInViewContentOnScrollEnd = () => {\n        this.loadInViewContent(400);\n    };\n\n    loadInViewContent = (padding = 0) => {\n        const scroll = this.scrollRef.current;\n\n        const { sets } = this.state;\n\n        const inViewItems = [];\n        sets.forEach(x => {\n            const item = this.itemsMap.get(x.id);\n            const node = ReactDOM.findDOMNode(item);\n            if (node) {\n                const topBorder = scroll.scrollTop - padding;\n                const bottomBorder = scroll.scrollTop + scroll.offsetHeight + padding;\n\n                const nodeTop = node.offsetTop;\n                const nodeBottom = node.offsetTop + node.clientHeight;\n\n                if (nodeTop >= topBorder && node.offsetTop <= bottomBorder) {\n                    inViewItems.push(x);\n                } else if (nodeBottom >= topBorder && nodeBottom <= bottomBorder) {\n                    inViewItems.push(x);\n                } else if (nodeTop <= topBorder && nodeBottom >= bottomBorder) {\n                    inViewItems.push(x);\n                }\n            }\n        });\n\n        inViewItems.forEach(x => {\n            const store = FileStore.getStore();\n            if (!this.loadedSets.has(x.id)) {\n                this.loadedSets.set(x.id, x.id);\n                loadStickerSetContent(store, x);\n            }\n        });\n    };\n\n    updatePosition = () => {\n        const scroll = this.scrollRef.current;\n\n        const { sets } = this.state;\n        let minDiff = scroll.scrollHeight;\n        let position = 0;\n        let firstOffsetTop = 0;\n        sets.forEach((x, pos) => {\n            const element = this.itemsMap.get(x.id);\n            if (element) {\n                const node = ReactDOM.findDOMNode(element);\n                if (node) {\n                    firstOffsetTop = pos === 0 ? node.offsetTop : firstOffsetTop;\n\n                    const offsetTop = node.offsetTop - firstOffsetTop;\n                    if (node && offsetTop <= scroll.scrollTop) {\n                        const diff = Math.abs(scroll.scrollTop - offsetTop);\n                        if (diff <= minDiff) {\n                            minDiff = diff;\n                            position = pos;\n                        }\n                    }\n                }\n            }\n        });\n\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateStickerSetPosition',\n            position\n        });\n    };\n\n    handleScroll = async () => {\n        //this.loadInViewContentOnScroll();\n        this.loadInViewContentOnScrollEnd();\n        this.updatePosition();\n\n        const scroll = this.scrollRef.current;\n\n        if (this.loadingChunk) return;\n\n        let loadChunk = false;\n        if (scroll.scrollTop + scroll.offsetHeight >= scroll.scrollHeight - 400) {\n            loadChunk = true;\n        }\n\n        if (!loadChunk) {\n            return false;\n        }\n\n        const { sets, stickerSets } = this.state;\n        if (stickerSets.sets.length === sets.length) return;\n\n        this.loadingChunk = true;\n        const promises = [];\n        stickerSets.sets.slice(this.setsLength, this.setsLength + 5).forEach(x => {\n            promises.push(\n                TdLibController.send({\n                    '@type': 'getStickerSet',\n                    set_id: x.id\n                })\n            );\n        });\n\n        const result = await Promise.all(promises).finally(() => (this.loadingChunk = false));\n\n        this.setsLength += result.length;\n        let concatSets = sets.concat(result);\n        this.setState({ sets: concatSets });\n    };\n\n    loadPreviewContent = stickerId => {\n        const { sets } = this.state;\n\n        const sticker = getStickers(sets).find(x => x.sticker.id === stickerId);\n        if (!sticker) return;\n\n        const store = FileStore.getStore();\n        loadStickerContent(store, sticker, null);\n\n        const stickersPerRow = 5;\n        const preloadStickers = getNeighborStickersFromSets(sticker, sets, stickersPerRow);\n        preloadStickers.forEach(x => {\n            loadStickerContent(store, x, null);\n        });\n    };\n\n    handleMouseEnter = event => {\n        const stickerId = Number(event.currentTarget.dataset.stickerId);\n        if (!stickerId) return;\n\n        if (!this.mouseDown) return;\n\n        if (this.mouseDownStickerId !== stickerId) {\n            this.mouseDownStickerId = null;\n        }\n        this.setState({ previewStickerId: stickerId });\n        this.loadPreviewContent(stickerId);\n\n        const { onPreview } = this.props;\n        const { sets } = this.state;\n\n        const sticker = getStickers(sets).find(x => x.sticker.id === stickerId);\n        onPreview(sticker);\n    };\n\n    handleMouseDown = event => {\n        const stickerId = Number(event.currentTarget.dataset.stickerId);\n        if (!stickerId) return;\n\n        this.mouseDownStickerId = stickerId;\n        const now = Date.now();\n\n        this.setState({ previewStickerId: stickerId, timestamp: now, showPreview: false, cancelSend: false });\n        setTimeout(() => {\n            const { timestamp } = this.state;\n            if (timestamp === now) {\n                this.setState({ showPreview: true, cancelSend: true }, () => {\n                    const { onPreview } = this.props;\n                    const { sets } = this.state;\n\n                    const sticker = getStickers(sets).find(x => x.sticker.id === stickerId);\n                    onPreview(sticker);\n                });\n            }\n        }, 500);\n\n        this.loadPreviewContent(stickerId);\n\n        this.mouseDown = true;\n        document.addEventListener('mouseup', this.handleMouseUp);\n\n        event.preventDefault();\n        event.stopPropagation();\n        return false;\n    };\n\n    handleMouseUp = () => {\n        this.setState({ previewStickerId: 0, timestamp: 0, showPreview: false });\n\n        const { onPreview } = this.props;\n\n        onPreview(null);\n\n        this.mouseDown = false;\n        document.removeEventListener('mouseup', this.handleMouseUp);\n    };\n\n    handleStickerSelect = sticker => {\n        const { onSelect } = this.props;\n        const { cancelSend } = this.state;\n\n        if (cancelSend) return;\n\n        onSelect(sticker);\n    };\n\n    handleSelectSet = async position => {\n        const { sets, stickerSets } = this.state;\n        const { scrollRef } = this;\n\n        if (position < sets.length) {\n            const element = this.itemsMap.get(sets[position].id);\n            if (element) {\n                const node = ReactDOM.findDOMNode(element);\n                if (node) {\n                    const scroll = scrollRef.current;\n                    scroll.scrollTop = node.offsetTop;\n                }\n            }\n        } else if (position < stickerSets.sets.length) {\n            if (this.loadingChunk) return;\n            if (stickerSets.sets.length === sets.length) return;\n\n            this.loadingChunk = true;\n            const promises = [];\n            stickerSets.sets.slice(this.setsLength, position + 1).forEach(x => {\n                promises.push(\n                    TdLibController.send({\n                        '@type': 'getStickerSet',\n                        set_id: x.id\n                    })\n                );\n            });\n\n            const result = await Promise.all(promises).finally(() => (this.loadingChunk = false));\n\n            this.setsLength += result.length;\n            let concatSets = sets.concat(result);\n            this.setState({ sets: concatSets }, () => {\n                if (position < concatSets.length) {\n                    this.handleSelectSet(position);\n                }\n            });\n        }\n    };\n\n    render() {\n        const { stickerSets, sets, headerStickers } = this.state;\n        if (!stickerSets) return null;\n\n        if (!sets) return null;\n        if (!sets.length) return null;\n\n        this.itemsMap.clear();\n        const items = sets.map(x => (\n            <StickerSet\n                key={x.id}\n                ref={el => this.itemsMap.set(x.id, el)}\n                info={x}\n                onSelect={this.handleStickerSelect}\n                onMouseDown={this.handleMouseDown}\n                onMouseEnter={this.handleMouseEnter}\n            />\n        ));\n\n        return (\n            <div className='stickers-picker'>\n                <StickersPickerHeader onSelect={this.handleSelectSet} stickers={headerStickers} />\n                <div ref={this.scrollRef} className='stickers-picker-scroll' onScroll={this.handleScroll}>\n                    {items}\n                </div>\n            </div>\n        );\n    }\n}\n\nStickersPicker.propTypes = {\n    onSelect: PropTypes.func.isRequired,\n    onPreview: PropTypes.func.isRequired\n};\n\nexport default StickersPicker;\n"]},"metadata":{},"sourceType":"module"}