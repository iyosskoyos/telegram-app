{"ast":null,"code":"import _regeneratorRuntime from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/inherits\";/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */import React from'react';import classNames from'classnames';import{compose}from'recompose';import withStyles from'@material-ui/core/styles/withStyles';import{withTranslation}from'react-i18next';import Button from'@material-ui/core/Button';import Dialog from'@material-ui/core/Dialog';import DialogActions from'@material-ui/core/DialogActions';import DialogContent from'@material-ui/core/DialogContent';import DialogContentText from'@material-ui/core/DialogContentText';import DialogTitle from'@material-ui/core/DialogTitle';import FormControlLabel from'@material-ui/core/FormControlLabel';import Checkbox from'@material-ui/core/Checkbox/';import MenuItem from'@material-ui/core/MenuItem';import MenuList from'@material-ui/core/MenuList';import Popover from'@material-ui/core/Popover';import{PHOTO_SIZE,PHOTO_THUMBNAIL_SIZE}from'../../../Constants';import{forwardMessages,openChat}from'../../../Actions/Client';import{getSrc}from'../../../Utils/File';import{getSize}from'../../../Utils/Common';import{getChatShortTitle,isPrivateChat}from'../../../Utils/Chat';import{isBlurredThumbnail}from'../../../Utils/Media';import FileStore from'../../../Stores/FileStore';import MessageStore from'../../../Stores/MessageStore';import TdLibController from'../../../Controllers/TdLibController';import'./SharedPhoto.css';var styles=function styles(theme){return{sharedPhotoContent:{backgroundColor:theme.palette.type==='dark'?theme.palette.background.paper:theme.palette.background.default}};};var SharedPhoto=/*#__PURE__*/function(_React$Component){_inherits(SharedPhoto,_React$Component);function SharedPhoto(props){var _this;_classCallCheck(this,SharedPhoto);_this=_possibleConstructorReturn(this,_getPrototypeOf(SharedPhoto).call(this,props));_this.onClientUpdatePhotoBlob=function(update){var _this$state=_this.state,photoSize=_this$state.photoSize,thumbSize=_this$state.thumbSize;var fileId=update.fileId;if(photoSize&&photoSize.photo&&photoSize.photo.id===fileId){_this.forceUpdate();}else if(thumbSize&&thumbSize.photo&&thumbSize.photo.id===fileId){_this.forceUpdate();}};_this.handleOpenMessage=function(event){_this.handleCloseContextMenu(event);var _this$props=_this.props,chatId=_this$props.chatId,messageId=_this$props.messageId;openChat(chatId,messageId);};_this.handleForward=function(event){_this.handleCloseContextMenu(event);var _this$props2=_this.props,chatId=_this$props2.chatId,messageId=_this$props2.messageId;forwardMessages(chatId,[messageId]);};_this.handleDelete=function(event){_this.handleCloseContextMenu(event);var _this$props3=_this.props,chatId=_this$props3.chatId,messageId=_this$props3.messageId;var message=MessageStore.get(chatId,messageId);if(!message)return null;var can_be_deleted_for_all_users=message.can_be_deleted_for_all_users;_this.setState({openDeleteDialog:true,canBeDeletedForAllUsers:can_be_deleted_for_all_users,revoke:can_be_deleted_for_all_users});};_this.handleContextMenu=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var contextMenu,left,top;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(event){event.preventDefault();event.stopPropagation();}contextMenu=_this.state.contextMenu;if(contextMenu){_this.setState({contextMenu:false});}else{left=event.clientX;top=event.clientY;_this.setState({contextMenu:true,left:left,top:top});}case 3:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.handleCloseContextMenu=function(event){if(event){event.stopPropagation();}_this.setState({contextMenu:false});};_this.handleRevokeChange=function(){_this.setState({revoke:!_this.state.revoke});};_this.handleCloseDelete=function(){_this.setState({openDeleteDialog:false});};_this.handleDeleteContinue=function(){var _this$props4=_this.props,chatId=_this$props4.chatId,messageId=_this$props4.messageId;var revoke=_this.state.revoke;_this.handleCloseDelete();TdLibController.send({'@type':'deleteMessages',chat_id:chatId,message_ids:[messageId],revoke:revoke});};var photo=props.photo,size=props.size,thumbnailSize=props.thumbnailSize;_this.state={contextMenu:false,left:0,top:0,openDeleteDialog:false,revoke:false,photoSize:getSize(photo.sizes,size),thumbSize:getSize(photo.sizes,thumbnailSize)};return _this;}_createClass(SharedPhoto,[{key:\"componentDidMount\",value:function componentDidMount(){FileStore.on('clientUpdatePhotoBlob',this.onClientUpdatePhotoBlob);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){FileStore.removeListener('clientUpdatePhotoBlob',this.onClientUpdatePhotoBlob);}},{key:\"render\",value:function render(){var _this$props5=this.props,chatId=_this$props5.chatId,messageId=_this$props5.messageId,classes=_this$props5.classes,openMedia=_this$props5.openMedia,style=_this$props5.style,showOpenMessage=_this$props5.showOpenMessage,t=_this$props5.t;var _this$state2=this.state,thumbSize=_this$state2.thumbSize,photoSize=_this$state2.photoSize,contextMenu=_this$state2.contextMenu,left=_this$state2.left,top=_this$state2.top,openDeleteDialog=_this$state2.openDeleteDialog,revoke=_this$state2.revoke;var message=MessageStore.get(chatId,messageId);if(!message)return null;var can_be_forwarded=message.can_be_forwarded,can_be_deleted_only_for_self=message.can_be_deleted_only_for_self,can_be_deleted_for_all_users=message.can_be_deleted_for_all_users;var count=1;if(!photoSize)return null;var src=getSrc(photoSize.photo);var thumbSrc=getSrc(thumbSize?thumbSize.photo:null);var isBlurred=isBlurredThumbnail(thumbSize);return React.createElement(\"div\",{className:\"shared-photo\",style:style,onClick:openMedia,onContextMenu:this.handleContextMenu},React.createElement(\"div\",{className:classNames('shared-photo-content',classes.sharedPhotoContent),style:{backgroundImage:\"url(\".concat(thumbSrc,\")\")}},src!==thumbSrc&&React.createElement(\"div\",{className:\"shared-photo-main-content\",style:{backgroundImage:\"url(\".concat(src,\")\")}})),React.createElement(Popover,{open:contextMenu,onClose:this.handleCloseContextMenu,anchorReference:\"anchorPosition\",anchorPosition:{top:top,left:left},anchorOrigin:{vertical:'bottom',horizontal:'right'},transformOrigin:{vertical:'top',horizontal:'left'},onMouseDown:function onMouseDown(e){return e.stopPropagation();},onClick:function onClick(e){return e.stopPropagation();}},React.createElement(MenuList,{classes:{root:classes.menuListRoot}},showOpenMessage&&React.createElement(MenuItem,{onClick:this.handleOpenMessage},t('GoToMessage')),can_be_forwarded&&React.createElement(MenuItem,{onClick:this.handleForward},t('Forward')),(can_be_deleted_only_for_self||can_be_deleted_for_all_users)&&React.createElement(MenuItem,{onClick:this.handleDelete},t('Delete')))),React.createElement(Dialog,{transitionDuration:0,open:openDeleteDialog,onClose:this.handleCloseDelete,\"aria-labelledby\":\"delete-dialog-title\",onClick:function onClick(e){return e.stopPropagation();}},React.createElement(DialogTitle,{id:\"delete-dialog-title\"},\"Confirm\"),React.createElement(DialogContent,null,React.createElement(DialogContentText,null,count===1?'Are you sure you want to delete 1 message?':\"Are you sure you want to delete \".concat(count,\" messages?\")),can_be_deleted_for_all_users&&React.createElement(FormControlLabel,{control:React.createElement(Checkbox,{checked:revoke,onChange:this.handleRevokeChange,color:\"primary\"}),label:isPrivateChat(chatId)?\"Delete for \".concat(getChatShortTitle(chatId)):'Delete for all'})),React.createElement(DialogActions,null,React.createElement(Button,{onClick:this.handleCloseDelete,color:\"primary\"},\"Cancel\"),React.createElement(Button,{onClick:this.handleDeleteContinue,color:\"primary\"},\"Ok\"))));}}]);return SharedPhoto;}(React.Component);SharedPhoto.defaultProps={size:PHOTO_SIZE,thumbnailSize:PHOTO_THUMBNAIL_SIZE};var enhance=compose(withStyles(styles,{withTheme:true}),withTranslation());export default enhance(SharedPhoto);","map":{"version":3,"sources":["/home/me-admin/Downloads/my-app/src/Components/Tile/SharedMedia/SharedPhoto.js"],"names":["React","classNames","compose","withStyles","withTranslation","Button","Dialog","DialogActions","DialogContent","DialogContentText","DialogTitle","FormControlLabel","Checkbox","MenuItem","MenuList","Popover","PHOTO_SIZE","PHOTO_THUMBNAIL_SIZE","forwardMessages","openChat","getSrc","getSize","getChatShortTitle","isPrivateChat","isBlurredThumbnail","FileStore","MessageStore","TdLibController","styles","theme","sharedPhotoContent","backgroundColor","palette","type","background","paper","default","SharedPhoto","props","onClientUpdatePhotoBlob","update","state","photoSize","thumbSize","fileId","photo","id","forceUpdate","handleOpenMessage","event","handleCloseContextMenu","chatId","messageId","handleForward","handleDelete","message","get","can_be_deleted_for_all_users","setState","openDeleteDialog","canBeDeletedForAllUsers","revoke","handleContextMenu","preventDefault","stopPropagation","contextMenu","left","clientX","top","clientY","handleRevokeChange","handleCloseDelete","handleDeleteContinue","send","chat_id","message_ids","size","thumbnailSize","sizes","on","removeListener","classes","openMedia","style","showOpenMessage","t","can_be_forwarded","can_be_deleted_only_for_self","count","src","thumbSrc","isBlurred","backgroundImage","vertical","horizontal","e","root","menuListRoot","Component","defaultProps","enhance","withTheme"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { compose } from 'recompose';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport { withTranslation } from 'react-i18next';\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport Checkbox from '@material-ui/core/Checkbox/';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport MenuList from '@material-ui/core/MenuList';\nimport Popover from '@material-ui/core/Popover';\nimport { PHOTO_SIZE, PHOTO_THUMBNAIL_SIZE } from '../../../Constants';\nimport { forwardMessages, openChat } from '../../../Actions/Client';\nimport { getSrc } from '../../../Utils/File';\nimport { getSize } from '../../../Utils/Common';\nimport { getChatShortTitle, isPrivateChat } from '../../../Utils/Chat';\nimport { isBlurredThumbnail } from '../../../Utils/Media';\nimport FileStore from '../../../Stores/FileStore';\nimport MessageStore from '../../../Stores/MessageStore';\nimport TdLibController from '../../../Controllers/TdLibController';\nimport './SharedPhoto.css';\n\nconst styles = theme => ({\n    sharedPhotoContent: {\n        backgroundColor:\n            theme.palette.type === 'dark' ? theme.palette.background.paper : theme.palette.background.default\n    }\n});\n\nclass SharedPhoto extends React.Component {\n    constructor(props) {\n        super(props);\n\n        const { photo, size, thumbnailSize } = props;\n\n        this.state = {\n            contextMenu: false,\n            left: 0,\n            top: 0,\n            openDeleteDialog: false,\n            revoke: false,\n\n            photoSize: getSize(photo.sizes, size),\n            thumbSize: getSize(photo.sizes, thumbnailSize)\n        };\n    }\n\n    componentDidMount() {\n        FileStore.on('clientUpdatePhotoBlob', this.onClientUpdatePhotoBlob);\n    }\n\n    componentWillUnmount() {\n        FileStore.removeListener('clientUpdatePhotoBlob', this.onClientUpdatePhotoBlob);\n    }\n\n    onClientUpdatePhotoBlob = update => {\n        const { photoSize, thumbSize } = this.state;\n        const { fileId } = update;\n\n        if (photoSize && photoSize.photo && photoSize.photo.id === fileId) {\n            this.forceUpdate();\n        } else if (thumbSize && thumbSize.photo && thumbSize.photo.id === fileId) {\n            this.forceUpdate();\n        }\n    };\n\n    handleOpenMessage = event => {\n        this.handleCloseContextMenu(event);\n\n        const { chatId, messageId } = this.props;\n\n        openChat(chatId, messageId);\n    };\n\n    handleForward = event => {\n        this.handleCloseContextMenu(event);\n\n        const { chatId, messageId } = this.props;\n\n        forwardMessages(chatId, [messageId]);\n    };\n\n    handleDelete = event => {\n        this.handleCloseContextMenu(event);\n\n        const { chatId, messageId } = this.props;\n\n        const message = MessageStore.get(chatId, messageId);\n        if (!message) return null;\n\n        const { can_be_deleted_for_all_users } = message;\n\n        this.setState({\n            openDeleteDialog: true,\n            canBeDeletedForAllUsers: can_be_deleted_for_all_users,\n            revoke: can_be_deleted_for_all_users\n        });\n    };\n\n    handleContextMenu = async event => {\n        if (event) {\n            event.preventDefault();\n            event.stopPropagation();\n        }\n        const { contextMenu } = this.state;\n\n        if (contextMenu) {\n            this.setState({ contextMenu: false });\n        } else {\n            const left = event.clientX;\n            const top = event.clientY;\n\n            this.setState({\n                contextMenu: true,\n                left,\n                top\n            });\n        }\n    };\n\n    handleCloseContextMenu = event => {\n        if (event) {\n            event.stopPropagation();\n        }\n\n        this.setState({ contextMenu: false });\n    };\n\n    handleRevokeChange = () => {\n        this.setState({ revoke: !this.state.revoke });\n    };\n\n    handleCloseDelete = () => {\n        this.setState({ openDeleteDialog: false });\n    };\n\n    handleDeleteContinue = () => {\n        const { chatId, messageId } = this.props;\n        const { revoke } = this.state;\n\n        this.handleCloseDelete();\n\n        TdLibController.send({\n            '@type': 'deleteMessages',\n            chat_id: chatId,\n            message_ids: [messageId],\n            revoke: revoke\n        });\n    };\n\n    render() {\n        const { chatId, messageId, classes, openMedia, style, showOpenMessage, t } = this.props;\n        const { thumbSize, photoSize, contextMenu, left, top, openDeleteDialog, revoke } = this.state;\n\n        const message = MessageStore.get(chatId, messageId);\n        if (!message) return null;\n\n        const { can_be_forwarded, can_be_deleted_only_for_self, can_be_deleted_for_all_users } = message;\n        const count = 1;\n\n        if (!photoSize) return null;\n\n        const src = getSrc(photoSize.photo);\n        const thumbSrc = getSrc(thumbSize ? thumbSize.photo : null);\n        const isBlurred = isBlurredThumbnail(thumbSize);\n\n        return (\n            <div className='shared-photo' style={style} onClick={openMedia} onContextMenu={this.handleContextMenu}>\n                <div\n                    className={classNames('shared-photo-content', classes.sharedPhotoContent)}\n                    style={{ backgroundImage: `url(${thumbSrc})` }}>\n                    {src !== thumbSrc && (\n                        <div className='shared-photo-main-content' style={{ backgroundImage: `url(${src})` }} />\n                    )}\n                </div>\n                <Popover\n                    open={contextMenu}\n                    onClose={this.handleCloseContextMenu}\n                    anchorReference='anchorPosition'\n                    anchorPosition={{ top, left }}\n                    anchorOrigin={{\n                        vertical: 'bottom',\n                        horizontal: 'right'\n                    }}\n                    transformOrigin={{\n                        vertical: 'top',\n                        horizontal: 'left'\n                    }}\n                    onMouseDown={e => e.stopPropagation()}\n                    onClick={e => e.stopPropagation()}>\n                    <MenuList classes={{ root: classes.menuListRoot }}>\n                        {showOpenMessage && <MenuItem onClick={this.handleOpenMessage}>{t('GoToMessage')}</MenuItem>}\n                        {can_be_forwarded && <MenuItem onClick={this.handleForward}>{t('Forward')}</MenuItem>}\n                        {(can_be_deleted_only_for_self || can_be_deleted_for_all_users) && (\n                            <MenuItem onClick={this.handleDelete}>{t('Delete')}</MenuItem>\n                        )}\n                    </MenuList>\n                </Popover>\n                <Dialog\n                    transitionDuration={0}\n                    open={openDeleteDialog}\n                    onClose={this.handleCloseDelete}\n                    aria-labelledby='delete-dialog-title'\n                    onClick={e => e.stopPropagation()}>\n                    <DialogTitle id='delete-dialog-title'>Confirm</DialogTitle>\n                    <DialogContent>\n                        <DialogContentText>\n                            {count === 1\n                                ? 'Are you sure you want to delete 1 message?'\n                                : `Are you sure you want to delete ${count} messages?`}\n                        </DialogContentText>\n                        {can_be_deleted_for_all_users && (\n                            <FormControlLabel\n                                control={\n                                    <Checkbox checked={revoke} onChange={this.handleRevokeChange} color='primary' />\n                                }\n                                label={\n                                    isPrivateChat(chatId) ? `Delete for ${getChatShortTitle(chatId)}` : 'Delete for all'\n                                }\n                            />\n                        )}\n                    </DialogContent>\n                    <DialogActions>\n                        <Button onClick={this.handleCloseDelete} color='primary'>\n                            Cancel\n                        </Button>\n                        <Button onClick={this.handleDeleteContinue} color='primary'>\n                            Ok\n                        </Button>\n                    </DialogActions>\n                </Dialog>\n            </div>\n        );\n    }\n}\n\nSharedPhoto.propTypes = {\n    chatId: PropTypes.number.isRequired,\n    messageId: PropTypes.number.isRequired,\n    photo: PropTypes.object.isRequired,\n    showOpenMessage: PropTypes.bool.isRequired,\n    openMedia: PropTypes.func,\n\n    size: PropTypes.number,\n    thumbnailSize: PropTypes.number,\n    style: PropTypes.object\n};\n\nSharedPhoto.defaultProps = {\n    size: PHOTO_SIZE,\n    thumbnailSize: PHOTO_THUMBNAIL_SIZE\n};\n\nconst enhance = compose(\n    withStyles(styles, { withTheme: true }),\n    withTranslation()\n);\n\nexport default enhance(SharedPhoto);\n"]},"metadata":{},"sourceType":"module"}