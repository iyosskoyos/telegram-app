{"ast":null,"code":"import _classCallCheck from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _defineProperty from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */import React from'react';import classNames from'classnames';import{compose}from'recompose';import withStyles from'@material-ui/core/styles/withStyles';import{withTranslation}from'react-i18next';import CloseIcon from'@material-ui/icons/Close';import IconButton from'@material-ui/core/IconButton';import Typography from'@material-ui/core/es/Typography/Typography';import{focusNode}from'../../Utils/Component';import{withRestoreRef,withSaveRef}from'../../Utils/HOC';import{utils}from'../../Utils/Key';import{borderStyle}from'../Theme';import{POLL_OPTION_HINT_LENGTH,POLL_OPTION_LENGTH,POLL_OPTION_MAX_LENGTH}from'../../Constants';import TdLibController from'../../Controllers/TdLibController';import'./CreatePollOption.css';var styles=function styles(theme){return _objectSpread({iconButton:{padding:4},counterRoot:{position:'absolute',right:24,bottom:6,minWidth:28,userSelect:'none'}},borderStyle(theme));};var CreatePollOption=/*#__PURE__*/function(_React$Component){_inherits(CreatePollOption,_React$Component);function CreatePollOption(props){var _this;_classCallCheck(this,CreatePollOption);_this=_possibleConstructorReturn(this,_getPrototypeOf(CreatePollOption).call(this,props));_this.getText=function(){return _this.optionTextRef.current.innerText;};_this.focus=function(){var toEnd=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var node=_this.optionTextRef.current;focusNode(node,toEnd);};_this.handleDelete=function(){var _this$props=_this.props,option=_this$props.option,onDelete=_this$props.onDelete;if(!option)return;if(!onDelete)return;onDelete(option.id);};_this.handleInput=function(event){var option=_this.props.option;event.preventDefault();var node=_this.optionTextRef.current;var length=node.dataset.length;var maxLength=node.dataset.maxLength;var text=_this.getText();_this.setState({remainLength:length-text.length});TdLibController.clientUpdate({'@type':'clientUpdatePollOption',id:option.id,text:text});};_this.handleKeyDown=function(event){var node=_this.optionTextRef.current;var maxLength=node.dataset.maxLength;var innerText=_this.getText();var length=innerText.length;var hasSelection=false;var selection=window.getSelection();var isSpecial=utils.isSpecial(event);var isNavigational=utils.isNavigational(event);if(selection){hasSelection=!!selection.toString();}switch(event.key){case'Backspace':{var text=_this.getText();if(!text){var _this$props2=_this.props,option=_this$props2.option,onDelete=_this$props2.onDelete;if(onDelete){onDelete(option.id,true);}event.preventDefault();return false;}break;}case'Enter':{var _this$props3=_this.props,_option=_this$props3.option,onFocusNext=_this$props3.onFocusNext;if(_option&&onFocusNext){onFocusNext(_option.id);}event.preventDefault();return false;}case'ArrowUp':{var _selection=window.getSelection();if(!_selection)break;if(!_selection.isCollapsed)break;var firstChild=node.childNodes&&node.childNodes.length>0?node.childNodes[0]:null;if(!firstChild||_selection.anchorNode===firstChild&&!_selection.anchorOffset){var _this$props4=_this.props,_option2=_this$props4.option,onFocusPrev=_this$props4.onFocusPrev;if(onFocusPrev){onFocusPrev(_option2.id);}event.preventDefault();return false;}break;}case'ArrowDown':{var _selection2=window.getSelection();if(!_selection2)break;if(!_selection2.isCollapsed)break;var lastChild=node.childNodes&&node.childNodes.length>0?node.childNodes[node.childNodes.length-1]:null;if(!lastChild||_selection2.anchorNode===lastChild&&_selection2.anchorOffset===lastChild.length){var _this$props5=_this.props,_option3=_this$props5.option,_onFocusNext=_this$props5.onFocusNext;if(_onFocusNext){_onFocusNext(_option3.id);}event.preventDefault();return false;}break;}}if(isSpecial||isNavigational){return true;}if(length>=maxLength&&!hasSelection){event.preventDefault();return false;}return true;};_this.handlePaste=function(event){event.preventDefault();var node=_this.optionTextRef.current;var maxLength=node.dataset.maxLength;var selection=window.getSelection();var selectionString=selection?selection.toString():'';var innerText=_this.getText();if(innerText.length-selection.length>=maxLength)return;var pasteText=event.clipboardData.getData('text/plain');if(!pasteText)return;pasteText=pasteText.replace('\\r\\n','\\n').replace('\\n',' ');if(innerText.length-selectionString.length+pasteText.length>maxLength){pasteText=pasteText.substr(0,maxLength-innerText.length+selectionString.length);}document.execCommand('insertHTML',false,pasteText);};_this.optionTextRef=React.createRef();_this.state={remainLength:POLL_OPTION_MAX_LENGTH};return _this;}_createClass(CreatePollOption,[{key:\"render\",value:function render(){var _this$props6=this.props,classes=_this$props6.classes,t=_this$props6.t;var remainLength=this.state.remainLength;return React.createElement(\"div\",{className:\"create-poll-option\"},React.createElement(\"div\",{ref:this.optionTextRef,id:\"create-poll-option-text\",contentEditable:true,suppressContentEditableWarning:true,placeholder:t('Option'),\"data-length\":POLL_OPTION_LENGTH,\"data-max-length\":POLL_OPTION_MAX_LENGTH,onInput:this.handleInput,onKeyDown:this.handleKeyDown,onPaste:this.handlePaste}),React.createElement(\"div\",{className:\"create-poll-option-delete-button\"},React.createElement(IconButton,{className:classes.iconButton,onClick:this.handleDelete},React.createElement(CloseIcon,{fontSize:\"small\"}))),React.createElement(\"div\",{className:classNames('create-poll-option-bottom-border',_defineProperty({},classes.borderColor,true))}),remainLength<=POLL_OPTION_LENGTH-POLL_OPTION_HINT_LENGTH&&React.createElement(Typography,{align:\"center\",className:classes.counterRoot,color:remainLength>=0?'textSecondary':'error',variant:\"subtitle1\"},remainLength));}}]);return CreatePollOption;}(React.Component);var enhance=compose(withSaveRef(),withStyles(styles),withTranslation(),withRestoreRef());export default enhance(CreatePollOption);","map":{"version":3,"sources":["/home/me-admin/Downloads/my-app/src/Components/Popup/CreatePollOption.js"],"names":["React","classNames","compose","withStyles","withTranslation","CloseIcon","IconButton","Typography","focusNode","withRestoreRef","withSaveRef","utils","borderStyle","POLL_OPTION_HINT_LENGTH","POLL_OPTION_LENGTH","POLL_OPTION_MAX_LENGTH","TdLibController","styles","theme","iconButton","padding","counterRoot","position","right","bottom","minWidth","userSelect","CreatePollOption","props","getText","optionTextRef","current","innerText","focus","toEnd","node","handleDelete","option","onDelete","id","handleInput","event","preventDefault","length","dataset","maxLength","text","setState","remainLength","clientUpdate","handleKeyDown","hasSelection","selection","window","getSelection","isSpecial","isNavigational","toString","key","onFocusNext","isCollapsed","firstChild","childNodes","anchorNode","anchorOffset","onFocusPrev","lastChild","handlePaste","selectionString","pasteText","clipboardData","getData","replace","substr","document","execCommand","createRef","state","classes","t","borderColor","Component","enhance"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { compose } from 'recompose';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport { withTranslation } from 'react-i18next';\nimport CloseIcon from '@material-ui/icons/Close';\nimport IconButton from '@material-ui/core/IconButton';\nimport Typography from '@material-ui/core/es/Typography/Typography';\nimport { focusNode } from '../../Utils/Component';\nimport { withRestoreRef, withSaveRef } from '../../Utils/HOC';\nimport { utils } from '../../Utils/Key';\nimport { borderStyle } from '../Theme';\nimport { POLL_OPTION_HINT_LENGTH, POLL_OPTION_LENGTH, POLL_OPTION_MAX_LENGTH } from '../../Constants';\nimport TdLibController from '../../Controllers/TdLibController';\nimport './CreatePollOption.css';\n\nconst styles = theme => ({\n    iconButton: {\n        padding: 4\n    },\n    counterRoot: {\n        position: 'absolute',\n        right: 24,\n        bottom: 6,\n        minWidth: 28,\n        userSelect: 'none'\n    },\n    ...borderStyle(theme)\n});\n\nclass CreatePollOption extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.optionTextRef = React.createRef();\n\n        this.state = {\n            remainLength: POLL_OPTION_MAX_LENGTH\n        };\n    }\n\n    getText = () => {\n        return this.optionTextRef.current.innerText;\n    };\n\n    focus = (toEnd = false) => {\n        const node = this.optionTextRef.current;\n\n        focusNode(node, toEnd);\n    };\n\n    handleDelete = () => {\n        const { option, onDelete } = this.props;\n        if (!option) return;\n        if (!onDelete) return;\n\n        onDelete(option.id);\n    };\n\n    handleInput = event => {\n        const { option } = this.props;\n\n        event.preventDefault();\n\n        const node = this.optionTextRef.current;\n        const length = node.dataset.length;\n        const maxLength = node.dataset.maxLength;\n        const text = this.getText();\n\n        this.setState({\n            remainLength: length - text.length\n        });\n\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdatePollOption',\n            id: option.id,\n            text\n        });\n    };\n\n    handleKeyDown = event => {\n        const node = this.optionTextRef.current;\n        const maxLength = node.dataset.maxLength;\n        const innerText = this.getText();\n        const length = innerText.length;\n\n        let hasSelection = false;\n        const selection = window.getSelection();\n        const isSpecial = utils.isSpecial(event);\n        const isNavigational = utils.isNavigational(event);\n\n        if (selection) {\n            hasSelection = !!selection.toString();\n        }\n\n        switch (event.key) {\n            case 'Backspace': {\n                const text = this.getText();\n                if (!text) {\n                    const { option, onDelete } = this.props;\n                    if (onDelete) {\n                        onDelete(option.id, true);\n                    }\n\n                    event.preventDefault();\n                    return false;\n                }\n\n                break;\n            }\n            case 'Enter': {\n                const { option, onFocusNext } = this.props;\n                if (option && onFocusNext) {\n                    onFocusNext(option.id);\n                }\n\n                event.preventDefault();\n                return false;\n            }\n            case 'ArrowUp': {\n                const selection = window.getSelection();\n                if (!selection) break;\n                if (!selection.isCollapsed) break;\n\n                const firstChild = node.childNodes && node.childNodes.length > 0 ? node.childNodes[0] : null;\n\n                if (!firstChild || (selection.anchorNode === firstChild && !selection.anchorOffset)) {\n                    const { option, onFocusPrev } = this.props;\n                    if (onFocusPrev) {\n                        onFocusPrev(option.id);\n                    }\n\n                    event.preventDefault();\n                    return false;\n                }\n\n                break;\n            }\n            case 'ArrowDown': {\n                const selection = window.getSelection();\n                if (!selection) break;\n                if (!selection.isCollapsed) break;\n\n                const lastChild =\n                    node.childNodes && node.childNodes.length > 0 ? node.childNodes[node.childNodes.length - 1] : null;\n\n                if (!lastChild || (selection.anchorNode === lastChild && selection.anchorOffset === lastChild.length)) {\n                    const { option, onFocusNext } = this.props;\n                    if (onFocusNext) {\n                        onFocusNext(option.id);\n                    }\n\n                    event.preventDefault();\n                    return false;\n                }\n\n                break;\n            }\n        }\n\n        if (isSpecial || isNavigational) {\n            return true;\n        }\n\n        if (length >= maxLength && !hasSelection) {\n            event.preventDefault();\n            return false;\n        }\n\n        return true;\n    };\n\n    handlePaste = event => {\n        event.preventDefault();\n\n        const node = this.optionTextRef.current;\n        const maxLength = node.dataset.maxLength;\n\n        const selection = window.getSelection();\n        const selectionString = selection ? selection.toString() : '';\n\n        const innerText = this.getText();\n        if (innerText.length - selection.length >= maxLength) return;\n\n        let pasteText = event.clipboardData.getData('text/plain');\n        if (!pasteText) return;\n\n        pasteText = pasteText.replace('\\r\\n', '\\n').replace('\\n', ' ');\n\n        if (innerText.length - selectionString.length + pasteText.length > maxLength) {\n            pasteText = pasteText.substr(0, maxLength - innerText.length + selectionString.length);\n        }\n        document.execCommand('insertHTML', false, pasteText);\n    };\n\n    render() {\n        const { classes, t } = this.props;\n        const { remainLength } = this.state;\n\n        return (\n            <div className='create-poll-option'>\n                <div\n                    ref={this.optionTextRef}\n                    id='create-poll-option-text'\n                    contentEditable\n                    suppressContentEditableWarning\n                    placeholder={t('Option')}\n                    data-length={POLL_OPTION_LENGTH}\n                    data-max-length={POLL_OPTION_MAX_LENGTH}\n                    onInput={this.handleInput}\n                    onKeyDown={this.handleKeyDown}\n                    onPaste={this.handlePaste}\n                />\n                <div className='create-poll-option-delete-button'>\n                    <IconButton className={classes.iconButton} onClick={this.handleDelete}>\n                        <CloseIcon fontSize='small' />\n                    </IconButton>\n                </div>\n                <div className={classNames('create-poll-option-bottom-border', { [classes.borderColor]: true })} />\n                {remainLength <= POLL_OPTION_LENGTH - POLL_OPTION_HINT_LENGTH && (\n                    <Typography\n                        align='center'\n                        className={classes.counterRoot}\n                        color={remainLength >= 0 ? 'textSecondary' : 'error'}\n                        variant='subtitle1'>\n                        {remainLength}\n                    </Typography>\n                )}\n            </div>\n        );\n    }\n}\n\nCreatePollOption.propTypes = {\n    option: PropTypes.object.isRequired,\n    onDelete: PropTypes.func.isRequired,\n    onFocusPrev: PropTypes.func.isRequired,\n    onFocusNext: PropTypes.func.isRequired\n};\n\nconst enhance = compose(\n    withSaveRef(),\n    withStyles(styles),\n    withTranslation(),\n    withRestoreRef()\n);\n\nexport default enhance(CreatePollOption);\n"]},"metadata":{},"sourceType":"module"}