{"ast":null,"code":"import _defineProperty from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/inherits\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */import React from'react';import classNames from'classnames';import FileProgress from'../../Viewer/FileProgress';import{getSize,getFitSize}from'../../../Utils/Common';import{getSrc}from'../../../Utils/File';import{isBlurredThumbnail}from'../../../Utils/Media';import{PHOTO_SIZE,PHOTO_DISPLAY_SIZE,PHOTO_THUMBNAIL_SIZE}from'../../../Constants';import FileStore from'../../../Stores/FileStore';import'./Photo.css';var Photo=/*#__PURE__*/function(_React$Component){_inherits(Photo,_React$Component);function Photo(props){var _this;_classCallCheck(this,Photo);_this=_possibleConstructorReturn(this,_getPrototypeOf(Photo).call(this,props));_this.onClientUpdatePhotoBlob=function(update){var _this$state=_this.state,photoSize=_this$state.photoSize,thumbSize=_this$state.thumbSize;var fileId=update.fileId;if(photoSize&&photoSize.photo&&photoSize.photo.id===fileId){_this.forceUpdate();}else if(thumbSize&&thumbSize.photo&&thumbSize.photo.id===fileId){_this.forceUpdate();}};_this.state={};return _this;}_createClass(Photo,[{key:\"componentDidMount\",value:function componentDidMount(){FileStore.on('clientUpdatePhotoBlob',this.onClientUpdatePhotoBlob);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){FileStore.removeListener('clientUpdatePhotoBlob',this.onClientUpdatePhotoBlob);}},{key:\"render\",value:function render(){var _this$props=this.props,displaySize=_this$props.displaySize,openMedia=_this$props.openMedia,showProgress=_this$props.showProgress,style=_this$props.style;var _this$state2=this.state,thumbSize=_this$state2.thumbSize,photoSize=_this$state2.photoSize;if(!photoSize)return null;var src=getSrc(photoSize.photo);var thumbSrc=getSrc(thumbSize?thumbSize.photo:null);var isBlurred=isBlurredThumbnail(thumbSize);var fitPhotoSize=getFitSize(photoSize,displaySize,false);if(!fitPhotoSize)return null;var photoStyle=_objectSpread({width:fitPhotoSize.width,height:fitPhotoSize.height},style);return React.createElement(\"div\",{className:\"photo\",style:photoStyle,onClick:openMedia},src?React.createElement(\"img\",{className:\"photo-image\",draggable:false,src:src,alt:\"\"}):React.createElement(\"img\",{className:classNames('photo-image',{'media-blurred':isBlurred}),draggable:false,src:thumbSrc,alt:\"\"}),showProgress&&React.createElement(FileProgress,{file:photoSize.photo,download:true,upload:true,cancelButton:true}));}}],[{key:\"getDerivedStateFromProps\",value:function getDerivedStateFromProps(props,state){var photo=props.photo,size=props.size,thumbnailSize=props.thumbnailSize;if(photo!==state.prevPhoto){return{prevPhoto:photo,photoSize:getSize(photo.sizes,size),thumbSize:getSize(photo.sizes,thumbnailSize)};}return null;}}]);return Photo;}(React.Component);Photo.defaultProps={size:PHOTO_SIZE,thumbnailSize:PHOTO_THUMBNAIL_SIZE,displaySize:PHOTO_DISPLAY_SIZE,showProgress:true};export default Photo;","map":{"version":3,"sources":["/home/me-admin/Downloads/my-app/src/Components/Message/Media/Photo.js"],"names":["React","classNames","FileProgress","getSize","getFitSize","getSrc","isBlurredThumbnail","PHOTO_SIZE","PHOTO_DISPLAY_SIZE","PHOTO_THUMBNAIL_SIZE","FileStore","Photo","props","onClientUpdatePhotoBlob","update","state","photoSize","thumbSize","fileId","photo","id","forceUpdate","on","removeListener","displaySize","openMedia","showProgress","style","src","thumbSrc","isBlurred","fitPhotoSize","photoStyle","width","height","size","thumbnailSize","prevPhoto","sizes","Component","defaultProps"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport FileProgress from '../../Viewer/FileProgress';\nimport { getSize, getFitSize } from '../../../Utils/Common';\nimport { getSrc } from '../../../Utils/File';\nimport { isBlurredThumbnail } from '../../../Utils/Media';\nimport { PHOTO_SIZE, PHOTO_DISPLAY_SIZE, PHOTO_THUMBNAIL_SIZE } from '../../../Constants';\nimport FileStore from '../../../Stores/FileStore';\nimport './Photo.css';\n\nclass Photo extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {};\n    }\n\n    static getDerivedStateFromProps(props, state) {\n        const { photo, size, thumbnailSize } = props;\n        if (photo !== state.prevPhoto) {\n            return {\n                prevPhoto: photo,\n                photoSize: getSize(photo.sizes, size),\n                thumbSize: getSize(photo.sizes, thumbnailSize)\n            };\n        }\n\n        return null;\n    }\n\n    componentDidMount() {\n        FileStore.on('clientUpdatePhotoBlob', this.onClientUpdatePhotoBlob);\n    }\n\n    componentWillUnmount() {\n        FileStore.removeListener('clientUpdatePhotoBlob', this.onClientUpdatePhotoBlob);\n    }\n\n    onClientUpdatePhotoBlob = update => {\n        const { photoSize, thumbSize } = this.state;\n        const { fileId } = update;\n\n        if (photoSize && photoSize.photo && photoSize.photo.id === fileId) {\n            this.forceUpdate();\n        } else if (thumbSize && thumbSize.photo && thumbSize.photo.id === fileId) {\n            this.forceUpdate();\n        }\n    };\n\n    render() {\n        const { displaySize, openMedia, showProgress, style } = this.props;\n        const { thumbSize, photoSize } = this.state;\n\n        if (!photoSize) return null;\n\n        const src = getSrc(photoSize.photo);\n        const thumbSrc = getSrc(thumbSize ? thumbSize.photo : null);\n        const isBlurred = isBlurredThumbnail(thumbSize);\n\n        const fitPhotoSize = getFitSize(photoSize, displaySize, false);\n        if (!fitPhotoSize) return null;\n\n        const photoStyle = {\n            width: fitPhotoSize.width,\n            height: fitPhotoSize.height,\n            ...style\n        };\n\n        return (\n            <div className='photo' style={photoStyle} onClick={openMedia}>\n                {src ? (\n                    <img className='photo-image' draggable={false} src={src} alt='' />\n                ) : (\n                    <img\n                        className={classNames('photo-image', { 'media-blurred': isBlurred })}\n                        draggable={false}\n                        src={thumbSrc}\n                        alt=''\n                    />\n                )}\n                {showProgress && <FileProgress file={photoSize.photo} download upload cancelButton />}\n            </div>\n        );\n    }\n}\n\nPhoto.propTypes = {\n    chatId: PropTypes.number,\n    messageId: PropTypes.number,\n    photo: PropTypes.object.isRequired,\n    openMedia: PropTypes.func,\n    showProgress: PropTypes.bool,\n\n    size: PropTypes.number,\n    thumbnailSize: PropTypes.number,\n    displaySize: PropTypes.number,\n    style: PropTypes.object\n};\n\nPhoto.defaultProps = {\n    size: PHOTO_SIZE,\n    thumbnailSize: PHOTO_THUMBNAIL_SIZE,\n    displaySize: PHOTO_DISPLAY_SIZE,\n    showProgress: true\n};\n\nexport default Photo;\n"]},"metadata":{},"sourceType":"module"}