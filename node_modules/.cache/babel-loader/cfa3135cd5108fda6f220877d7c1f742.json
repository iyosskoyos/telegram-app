{"ast":null,"code":"import _regeneratorRuntime from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/inherits\";/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */import React from'react';import classNames from'classnames';import withStyles from'@material-ui/core/styles/withStyles';import ChatDetails from'./ChatDetails';import GroupsInCommon from'./GroupsInCommon';import SharedAudios from'./SharedMedia/SharedAudios';import SharedDocuments from'./SharedMedia/SharedDocuments';import SharedLinks from'./SharedMedia/SharedLinks';import SharedMedia from'./SharedMedia';import SharedPhotos from'./SharedMedia/SharedPhotos';import SharedVideos from'./SharedMedia/SharedVideos';import SharedVoiceNotes from'./SharedMedia/SharedVoiceNotes';import{borderStyle}from'../Theme';import{getChatCounters}from'../../Actions/Chat';import{getSupergroupId,isSupergroup}from'../../Utils/Chat';import ApplicationStore from'../../Stores/ApplicationStore';import ChatStore from'../../Stores/ChatStore';import SupergroupStore from'../../Stores/SupergroupStore';import TdLibController from'../../Controllers/TdLibController';import'./ChatInfo.css';// const styles = (theme) => ({\n//     borderColor: {\n//         borderColor: theme.palette.divider\n//     }\n// });\nvar ChatInfo=/*#__PURE__*/function(_React$Component){_inherits(ChatInfo,_React$Component);function ChatInfo(props){var _this;_classCallCheck(this,ChatInfo);_this=_possibleConstructorReturn(this,_getPrototypeOf(ChatInfo).call(this,props));_this.onClientUpdateChatId=function(update){var popup=_this.props.popup;var chatId=_this.state.chatId;if(popup)return;if(chatId===update.nextChatId)return;_this.sharedAudios=null;_this.sharedDocuments=null;_this.sharedLinks=null;_this.sharedPhotos=null;_this.sharedVideos=null;_this.sharedVoiceNotes=null;_this.setState({chatId:update.nextChatId,migratedChatId:0,userChatId:null,openGroupInCommon:false,openSharedAudios:false,openSharedDocuments:false,openSharedLinks:false,openSharedMedia:false,openSharedPhotos:false,openSharedVideos:false,openSharedVoiceNotes:false,counters:ChatStore.getCounters(update.nextChatId),migratedCounters:null});};_this.loadContent=function(chatId){_this.loadChatCounters(chatId);_this.loadMigratedCounters(chatId);};_this.loadChatCounters=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(chatId){var counters;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getChatCounters(chatId);case 2:counters=_context.sent;ChatStore.setCounters(chatId,counters);if(!(chatId!==_this.state.chatId)){_context.next=6;break;}return _context.abrupt(\"return\");case 6:_this.setState({counters:counters});case 7:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.loadMigratedCounters=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(chatId){var fullInfo,basic_group_id,chat,counters;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log('ChatInfo.loadMigratedCounters');if(isSupergroup(chatId)){_context2.next=3;break;}return _context2.abrupt(\"return\");case 3:fullInfo=SupergroupStore.getFullInfo(getSupergroupId(chatId));if(fullInfo){_context2.next=6;break;}return _context2.abrupt(\"return\");case 6:basic_group_id=fullInfo.upgraded_from_basic_group_id;if(basic_group_id){_context2.next=9;break;}return _context2.abrupt(\"return\");case 9:_context2.next=11;return TdLibController.send({'@type':'createBasicGroupChat',basic_group_id:basic_group_id,force:true});case 11:chat=_context2.sent;if(chat){_context2.next=14;break;}return _context2.abrupt(\"return\");case 14:console.log('ChatInfo.loadMigratedCounters chat',chat);_context2.next=17;return getChatCounters(chat.id);case 17:counters=_context2.sent;ChatStore.setCounters(chat.id,counters);if(!(_this.state.chatId!==chatId)){_context2.next=21;break;}return _context2.abrupt(\"return\");case 21:_this.setState({migratedChatId:chat.id,migratedCounters:ChatStore.getCounters(chat.id)});case 22:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();_this.handleOpenSharedMedia=function(){_this.setState({openSharedMedia:true});};_this.handleCloseSharedMedia=function(){_this.setState({openSharedMedia:false});};_this.handleOpenGroupInCommon=function(){_this.setState({openGroupInCommon:true});};_this.handleCloseGroupsInCommon=function(){_this.setState({openGroupInCommon:false});};_this.handleCloseChatDetails=function(){var popup=_this.props.popup;var userChatId=_this.state.userChatId;if(userChatId){_this.setState({userChatId:null});}else if(popup){TdLibController.clientUpdate({'@type':'clientUpdateDialogChatId',chatId:0});}else{ApplicationStore.changeChatDetailsVisibility(false);}};_this.handleOpenSharedDocuments=function(){_this.setState({openSharedDocuments:true});};_this.handleCloseSharedDocuments=function(){_this.setState({openSharedDocuments:false});};_this.handleOpenSharedAudios=function(){_this.setState({openSharedAudios:true});};_this.handleCloseSharedAudios=function(){_this.setState({openSharedAudios:false});};_this.handleOpenSharedVoiceNotes=function(){_this.setState({openSharedVoiceNotes:true});};_this.handleCloseSharedVoiceNotes=function(){_this.setState({openSharedVoiceNotes:false});};_this.handleOpenSharedLinks=function(){_this.setState({openSharedLinks:true});};_this.handleCloseSharedLinks=function(){_this.setState({openSharedLinks:false});};_this.handleOpenSharedPhotos=function(){_this.setState({openSharedPhotos:true});};_this.handleCloseSharedPhotos=function(){_this.setState({openSharedPhotos:false});};_this.handleOpenSharedVideos=function(){_this.setState({openSharedVideos:true});};_this.handleCloseSharedVideos=function(){_this.setState({openSharedVideos:false});};console.log('ChatDetails.ChatInfo.ctor');_this.detailsRef=React.createRef();var _popup=props.popup;var _chatId=ApplicationStore.chatId,dialogChatId=ApplicationStore.dialogChatId;_this.state={chatId:_popup?dialogChatId:_chatId,migratedChatId:0,userChatId:null,openGroupInCommon:false,openSharedAudios:false,openSharedDocuments:false,openSharedLinks:false,openSharedMedia:false,openSharedPhotos:false,openSharedVideos:false,openSharedVoiceNotes:false,counters:null,migratedCounters:null};return _this;}_createClass(ChatInfo,[{key:\"componentDidMount\",value:function componentDidMount(){console.log('ChatDetails.ChatInfo.componentDidMount');this.loadContent(this.state.chatId);ApplicationStore.on('clientUpdateChatId',this.onClientUpdateChatId);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){ApplicationStore.removeListener('clientUpdateChatId',this.onClientUpdateChatId);}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps,prevState,snapshot){var chatId=this.state.chatId;if(chatId!==prevState.chatId){this.loadContent(chatId);}}},{key:\"render\",value:function render(){console.log('ChatDetails.ChatInfo.render',this.state);var _this$props=this.props,classes=_this$props.classes,className=_this$props.className,popup=_this$props.popup;var _this$state=this.state,chatId=_this$state.chatId,counters=_this$state.counters,migratedChatId=_this$state.migratedChatId,migratedCounters=_this$state.migratedCounters,userChatId=_this$state.userChatId,openSharedAudios=_this$state.openSharedAudios,openSharedDocuments=_this$state.openSharedDocuments,openSharedLinks=_this$state.openSharedLinks,openSharedMedia=_this$state.openSharedMedia,openSharedPhotos=_this$state.openSharedPhotos,openSharedVideos=_this$state.openSharedVideos,openSharedVoiceNotes=_this$state.openSharedVoiceNotes,openGroupInCommon=_this$state.openGroupInCommon;var currentChatId=chatId||userChatId;var minHeight=this.detailsRef&&this.detailsRef.current?this.detailsRef.current.getContentHeight():0;var content=null;if(openSharedMedia){content=React.createElement(SharedMedia,{chatId:currentChatId,popup:popup,minHeight:minHeight,onClose:this.handleCloseSharedMedia});}else if(openSharedAudios){this.sharedAudios=this.sharedAudios||React.createElement(SharedAudios,{chatId:currentChatId,migratedChatId:migratedChatId,popup:popup,minHeight:minHeight,onClose:this.handleCloseSharedAudios});content=this.sharedAudios;}else if(openSharedDocuments){this.sharedDocuments=this.sharedDocuments||React.createElement(SharedDocuments,{chatId:currentChatId,migratedChatId:migratedChatId,popup:popup,minHeight:minHeight,onClose:this.handleCloseSharedDocuments});content=this.sharedDocuments;}else if(openSharedLinks){this.sharedLinks=this.sharedLinks||React.createElement(SharedLinks,{chatId:currentChatId,migratedChatId:migratedChatId,popup:popup,minHeight:minHeight,onClose:this.handleCloseSharedLinks});content=this.sharedLinks;}else if(openSharedPhotos){this.sharedPhotos=this.sharedPhotos||React.createElement(SharedPhotos,{chatId:currentChatId,migratedChatId:migratedChatId,popup:popup,minHeight:minHeight,onClose:this.handleCloseSharedPhotos});content=this.sharedPhotos;}else if(openSharedVideos){this.sharedVideos=this.sharedVideos||React.createElement(SharedVideos,{chatId:currentChatId,migratedChatId:migratedChatId,popup:popup,minHeight:minHeight,onClose:this.handleCloseSharedVideos});content=this.sharedVideos;}else if(openSharedVoiceNotes){this.sharedVoiceNotes=this.sharedVoiceNotes||React.createElement(SharedVoiceNotes,{chatId:currentChatId,migratedChatId:migratedChatId,popup:popup,minHeight:minHeight,onClose:this.handleCloseSharedVoiceNotes});content=this.sharedVoiceNotes;}else if(openGroupInCommon){content=React.createElement(GroupsInCommon,{chatId:currentChatId,popup:popup,minHeight:minHeight,onClose:this.handleCloseGroupsInCommon});}else{content=React.createElement(ChatDetails,{ref:this.detailsRef,chatId:currentChatId,popup:popup,backButton:userChatId===chatId,counters:counters,migratedCounters:migratedCounters,onOpenGroupInCommon:this.handleOpenGroupInCommon,onOpenSharedAudios:this.handleOpenSharedAudios,onOpenSharedDocuments:this.handleOpenSharedDocuments,onOpenSharedMedia:this.handleOpenSharedMedia,onOpenSharedLinks:this.handleOpenSharedLinks,onOpenSharedPhotos:this.handleOpenSharedPhotos,onOpenSharedVideos:this.handleOpenSharedVideos,onOpenSharedVoiceNotes:this.handleOpenSharedVoiceNotes,onClose:this.handleCloseChatDetails});}return popup?React.createElement(React.Fragment,null,content):React.createElement(\"div\",{className:classNames(classes.borderColor,{'right-column':!popup},className)},content);}}]);return ChatInfo;}(React.Component);ChatInfo.defaultProps={className:null,classes:null,popup:false};export default withStyles(borderStyle)(ChatInfo);","map":{"version":3,"sources":["/Users/yosuahalim/Documents/Projects/telegram-app/src/Components/ColumnRight/ChatInfo.js"],"names":["React","classNames","withStyles","ChatDetails","GroupsInCommon","SharedAudios","SharedDocuments","SharedLinks","SharedMedia","SharedPhotos","SharedVideos","SharedVoiceNotes","borderStyle","getChatCounters","getSupergroupId","isSupergroup","ApplicationStore","ChatStore","SupergroupStore","TdLibController","ChatInfo","props","onClientUpdateChatId","update","popup","chatId","state","nextChatId","sharedAudios","sharedDocuments","sharedLinks","sharedPhotos","sharedVideos","sharedVoiceNotes","setState","migratedChatId","userChatId","openGroupInCommon","openSharedAudios","openSharedDocuments","openSharedLinks","openSharedMedia","openSharedPhotos","openSharedVideos","openSharedVoiceNotes","counters","getCounters","migratedCounters","loadContent","loadChatCounters","loadMigratedCounters","setCounters","console","log","fullInfo","getFullInfo","basic_group_id","upgraded_from_basic_group_id","send","force","chat","id","handleOpenSharedMedia","handleCloseSharedMedia","handleOpenGroupInCommon","handleCloseGroupsInCommon","handleCloseChatDetails","clientUpdate","changeChatDetailsVisibility","handleOpenSharedDocuments","handleCloseSharedDocuments","handleOpenSharedAudios","handleCloseSharedAudios","handleOpenSharedVoiceNotes","handleCloseSharedVoiceNotes","handleOpenSharedLinks","handleCloseSharedLinks","handleOpenSharedPhotos","handleCloseSharedPhotos","handleOpenSharedVideos","handleCloseSharedVideos","detailsRef","createRef","dialogChatId","on","removeListener","prevProps","prevState","snapshot","classes","className","currentChatId","minHeight","current","getContentHeight","content","borderColor","Component","defaultProps"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport ChatDetails from './ChatDetails';\nimport GroupsInCommon from './GroupsInCommon';\nimport SharedAudios from './SharedMedia/SharedAudios';\nimport SharedDocuments from './SharedMedia/SharedDocuments';\nimport SharedLinks from './SharedMedia/SharedLinks';\nimport SharedMedia from './SharedMedia';\nimport SharedPhotos from './SharedMedia/SharedPhotos';\nimport SharedVideos from './SharedMedia/SharedVideos';\nimport SharedVoiceNotes from './SharedMedia/SharedVoiceNotes';\nimport { borderStyle } from '../Theme';\nimport { getChatCounters } from '../../Actions/Chat';\nimport { getSupergroupId, isSupergroup } from '../../Utils/Chat';\nimport ApplicationStore from '../../Stores/ApplicationStore';\nimport ChatStore from '../../Stores/ChatStore';\nimport SupergroupStore from '../../Stores/SupergroupStore';\nimport TdLibController from '../../Controllers/TdLibController';\nimport './ChatInfo.css';\n\n// const styles = (theme) => ({\n//     borderColor: {\n//         borderColor: theme.palette.divider\n//     }\n// });\n\nclass ChatInfo extends React.Component {\n    constructor(props) {\n        super(props);\n\n        console.log('ChatDetails.ChatInfo.ctor');\n\n        this.detailsRef = React.createRef();\n\n        const { popup } = props;\n        const { chatId, dialogChatId } = ApplicationStore;\n\n        this.state = {\n            chatId: popup ? dialogChatId : chatId,\n            migratedChatId: 0,\n            userChatId: null,\n            openGroupInCommon: false,\n            openSharedAudios: false,\n            openSharedDocuments: false,\n            openSharedLinks: false,\n            openSharedMedia: false,\n            openSharedPhotos: false,\n            openSharedVideos: false,\n            openSharedVoiceNotes: false,\n            counters: null,\n            migratedCounters: null\n        };\n    }\n\n    componentDidMount() {\n        console.log('ChatDetails.ChatInfo.componentDidMount');\n        this.loadContent(this.state.chatId);\n\n        ApplicationStore.on('clientUpdateChatId', this.onClientUpdateChatId);\n    }\n\n    componentWillUnmount() {\n        ApplicationStore.removeListener('clientUpdateChatId', this.onClientUpdateChatId);\n    }\n\n    componentDidUpdate(prevProps, prevState, snapshot) {\n        const { chatId } = this.state;\n        if (chatId !== prevState.chatId) {\n            this.loadContent(chatId);\n        }\n    }\n\n    onClientUpdateChatId = update => {\n        const { popup } = this.props;\n        const { chatId } = this.state;\n\n        if (popup) return;\n        if (chatId === update.nextChatId) return;\n\n        this.sharedAudios = null;\n        this.sharedDocuments = null;\n        this.sharedLinks = null;\n        this.sharedPhotos = null;\n        this.sharedVideos = null;\n        this.sharedVoiceNotes = null;\n\n        this.setState({\n            chatId: update.nextChatId,\n            migratedChatId: 0,\n            userChatId: null,\n            openGroupInCommon: false,\n            openSharedAudios: false,\n            openSharedDocuments: false,\n            openSharedLinks: false,\n            openSharedMedia: false,\n            openSharedPhotos: false,\n            openSharedVideos: false,\n            openSharedVoiceNotes: false,\n            counters: ChatStore.getCounters(update.nextChatId),\n            migratedCounters: null\n        });\n    };\n\n    loadContent = chatId => {\n        this.loadChatCounters(chatId);\n        this.loadMigratedCounters(chatId);\n    };\n\n    loadChatCounters = async chatId => {\n        const counters = await getChatCounters(chatId);\n        ChatStore.setCounters(chatId, counters);\n\n        if (chatId !== this.state.chatId) return;\n\n        this.setState({ counters });\n    };\n\n    loadMigratedCounters = async chatId => {\n        console.log('ChatInfo.loadMigratedCounters');\n        if (!isSupergroup(chatId)) return;\n\n        const fullInfo = SupergroupStore.getFullInfo(getSupergroupId(chatId));\n        if (!fullInfo) return;\n\n        const { upgraded_from_basic_group_id: basic_group_id } = fullInfo;\n        if (!basic_group_id) return;\n\n        const chat = await TdLibController.send({\n            '@type': 'createBasicGroupChat',\n            basic_group_id,\n            force: true\n        });\n\n        if (!chat) return;\n\n        console.log('ChatInfo.loadMigratedCounters chat', chat);\n        const counters = await getChatCounters(chat.id);\n        ChatStore.setCounters(chat.id, counters);\n\n        if (this.state.chatId !== chatId) return;\n\n        this.setState({ migratedChatId: chat.id, migratedCounters: ChatStore.getCounters(chat.id) });\n    };\n\n    handleOpenSharedMedia = () => {\n        this.setState({ openSharedMedia: true });\n    };\n\n    handleCloseSharedMedia = () => {\n        this.setState({ openSharedMedia: false });\n    };\n\n    handleOpenGroupInCommon = () => {\n        this.setState({ openGroupInCommon: true });\n    };\n\n    handleCloseGroupsInCommon = () => {\n        this.setState({ openGroupInCommon: false });\n    };\n\n    handleCloseChatDetails = () => {\n        const { popup } = this.props;\n        const { userChatId } = this.state;\n\n        if (userChatId) {\n            this.setState({ userChatId: null });\n        } else if (popup) {\n            TdLibController.clientUpdate({\n                '@type': 'clientUpdateDialogChatId',\n                chatId: 0\n            });\n        } else {\n            ApplicationStore.changeChatDetailsVisibility(false);\n        }\n    };\n\n    handleOpenSharedDocuments = () => {\n        this.setState({ openSharedDocuments: true });\n    };\n\n    handleCloseSharedDocuments = () => {\n        this.setState({ openSharedDocuments: false });\n    };\n\n    handleOpenSharedAudios = () => {\n        this.setState({ openSharedAudios: true });\n    };\n\n    handleCloseSharedAudios = () => {\n        this.setState({ openSharedAudios: false });\n    };\n\n    handleOpenSharedVoiceNotes = () => {\n        this.setState({ openSharedVoiceNotes: true });\n    };\n\n    handleCloseSharedVoiceNotes = () => {\n        this.setState({ openSharedVoiceNotes: false });\n    };\n\n    handleOpenSharedLinks = () => {\n        this.setState({ openSharedLinks: true });\n    };\n\n    handleCloseSharedLinks = () => {\n        this.setState({ openSharedLinks: false });\n    };\n\n    handleOpenSharedPhotos = () => {\n        this.setState({ openSharedPhotos: true });\n    };\n\n    handleCloseSharedPhotos = () => {\n        this.setState({ openSharedPhotos: false });\n    };\n\n    handleOpenSharedVideos = () => {\n        this.setState({ openSharedVideos: true });\n    };\n\n    handleCloseSharedVideos = () => {\n        this.setState({ openSharedVideos: false });\n    };\n\n    render() {\n        console.log('ChatDetails.ChatInfo.render', this.state);\n        const { classes, className, popup } = this.props;\n        const {\n            chatId,\n            counters,\n            migratedChatId,\n            migratedCounters,\n            userChatId,\n            openSharedAudios,\n            openSharedDocuments,\n            openSharedLinks,\n            openSharedMedia,\n            openSharedPhotos,\n            openSharedVideos,\n            openSharedVoiceNotes,\n            openGroupInCommon\n        } = this.state;\n\n        const currentChatId = chatId || userChatId;\n        const minHeight = this.detailsRef && this.detailsRef.current ? this.detailsRef.current.getContentHeight() : 0;\n\n        let content = null;\n        if (openSharedMedia) {\n            content = (\n                <SharedMedia\n                    chatId={currentChatId}\n                    popup={popup}\n                    minHeight={minHeight}\n                    onClose={this.handleCloseSharedMedia}\n                />\n            );\n        } else if (openSharedAudios) {\n            this.sharedAudios = this.sharedAudios || (\n                <SharedAudios\n                    chatId={currentChatId}\n                    migratedChatId={migratedChatId}\n                    popup={popup}\n                    minHeight={minHeight}\n                    onClose={this.handleCloseSharedAudios}\n                />\n            );\n\n            content = this.sharedAudios;\n        } else if (openSharedDocuments) {\n            this.sharedDocuments = this.sharedDocuments || (\n                <SharedDocuments\n                    chatId={currentChatId}\n                    migratedChatId={migratedChatId}\n                    popup={popup}\n                    minHeight={minHeight}\n                    onClose={this.handleCloseSharedDocuments}\n                />\n            );\n\n            content = this.sharedDocuments;\n        } else if (openSharedLinks) {\n            this.sharedLinks = this.sharedLinks || (\n                <SharedLinks\n                    chatId={currentChatId}\n                    migratedChatId={migratedChatId}\n                    popup={popup}\n                    minHeight={minHeight}\n                    onClose={this.handleCloseSharedLinks}\n                />\n            );\n\n            content = this.sharedLinks;\n        } else if (openSharedPhotos) {\n            this.sharedPhotos = this.sharedPhotos || (\n                <SharedPhotos\n                    chatId={currentChatId}\n                    migratedChatId={migratedChatId}\n                    popup={popup}\n                    minHeight={minHeight}\n                    onClose={this.handleCloseSharedPhotos}\n                />\n            );\n\n            content = this.sharedPhotos;\n        } else if (openSharedVideos) {\n            this.sharedVideos = this.sharedVideos || (\n                <SharedVideos\n                    chatId={currentChatId}\n                    migratedChatId={migratedChatId}\n                    popup={popup}\n                    minHeight={minHeight}\n                    onClose={this.handleCloseSharedVideos}\n                />\n            );\n\n            content = this.sharedVideos;\n        } else if (openSharedVoiceNotes) {\n            this.sharedVoiceNotes = this.sharedVoiceNotes || (\n                <SharedVoiceNotes\n                    chatId={currentChatId}\n                    migratedChatId={migratedChatId}\n                    popup={popup}\n                    minHeight={minHeight}\n                    onClose={this.handleCloseSharedVoiceNotes}\n                />\n            );\n\n            content = this.sharedVoiceNotes;\n        } else if (openGroupInCommon) {\n            content = (\n                <GroupsInCommon\n                    chatId={currentChatId}\n                    popup={popup}\n                    minHeight={minHeight}\n                    onClose={this.handleCloseGroupsInCommon}\n                />\n            );\n        } else {\n            content = (\n                <ChatDetails\n                    ref={this.detailsRef}\n                    chatId={currentChatId}\n                    popup={popup}\n                    backButton={userChatId === chatId}\n                    counters={counters}\n                    migratedCounters={migratedCounters}\n                    onOpenGroupInCommon={this.handleOpenGroupInCommon}\n                    onOpenSharedAudios={this.handleOpenSharedAudios}\n                    onOpenSharedDocuments={this.handleOpenSharedDocuments}\n                    onOpenSharedMedia={this.handleOpenSharedMedia}\n                    onOpenSharedLinks={this.handleOpenSharedLinks}\n                    onOpenSharedPhotos={this.handleOpenSharedPhotos}\n                    onOpenSharedVideos={this.handleOpenSharedVideos}\n                    onOpenSharedVoiceNotes={this.handleOpenSharedVoiceNotes}\n                    onClose={this.handleCloseChatDetails}\n                />\n            );\n        }\n\n        return popup ? (\n            <>{content}</>\n        ) : (\n            <div className={classNames(classes.borderColor, { 'right-column': !popup }, className)}>{content}</div>\n        );\n    }\n}\n\nChatInfo.propTypes = {\n    className: PropTypes.string,\n    classes: PropTypes.object,\n    popup: PropTypes.bool\n};\n\nChatInfo.defaultProps = {\n    className: null,\n    classes: null,\n    popup: false\n};\n\nexport default withStyles(borderStyle)(ChatInfo);\n"]},"metadata":{},"sourceType":"module"}