{"ast":null,"code":"import _regeneratorRuntime from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/inherits\";/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */import React from'react';import classNames from'classnames';import{withTranslation}from'react-i18next';import CloseIcon from'@material-ui/icons/Close';import NavigateNextIcon from'@material-ui/icons/NavigateNext';import NavigateBeforeIcon from'@material-ui/icons/NavigateBefore';import ReplyIcon from'@material-ui/icons/Reply';import DeleteIcon from'@material-ui/icons/Delete';import MediaViewerDownloadButton from'./MediaViewerDownloadButton';import MediaViewerButton from'./MediaViewerButton';import MediaViewerFooterText from'./MediaViewerFooterText';import MediaViewerFooterButton from'./MediaViewerFooterButton';import ProfileMediaViewerContent from'./ProfileMediaViewerContent';import ProfileMediaViewerControl from'../Tile/ProfileMediaViewerControl';import{setProfileMediaViewerContent}from'../../Actions/Client';import{getPhotoFromChat,getChatUserId,isPrivateChat}from'../../Utils/Chat';import{getProfilePhotoDateHint,getProfilePhoto}from'../../Utils/User';import{loadProfileMediaViewerContent,preloadProfileMediaViewerContent,saveOrDownload}from'../../Utils/File';import ApplicationStore from'../../Stores/ApplicationStore';import FileStore from'../../Stores/FileStore';import ChatStore from'../../Stores/ChatStore';import TdLibController from'../../Controllers/TdLibController';import'./ProfileMediaViewer.css';var forwardIconStyle={padding:20,color:'white',transform:'scaleX(-1)'};var deleteIconStyle={padding:20,color:'white'};var ProfileMediaViewer=/*#__PURE__*/function(_React$Component){_inherits(ProfileMediaViewer,_React$Component);function ProfileMediaViewer(props){var _this;_classCallCheck(this,ProfileMediaViewer);_this=_possibleConstructorReturn(this,_getPrototypeOf(ProfileMediaViewer).call(this,props));_this.onKeyDown=function(event){if(event.keyCode===27){var deleteConfirmationOpened=_this.state.deleteConfirmationOpened;if(deleteConfirmationOpened)return;_this.handleClose();}else if(event.keyCode===39){_this.handlePrevious();}else if(event.keyCode===37){_this.handleNext();}};_this.loadHistory=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var chatId,result,index;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:chatId=_this.props.chatId;if(isPrivateChat(chatId)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:_context.next=5;return TdLibController.send({'@type':'getUserProfilePhotos',user_id:getChatUserId(chatId),offset:0,limit:100});case 5:result=_context.sent;_this.history=result.photos;_this.firstSliceLoaded=result.photos.length===0;index=0;_this.setState({currentIndex:index,hasNextMedia:_this.hasNextMedia(index),hasPreviousMedia:_this.hasPreviousMedia(index),totalCount:result.total_count});preloadProfileMediaViewerContent(chatId,index,_this.history);case 11:case\"end\":return _context.stop();}}},_callee);}));_this.handleClose=function(){setProfileMediaViewerContent(null);};_this.handleSave=function(){var chatId=_this.props.chatId;var _this$state=_this.state,currentIndex=_this$state.currentIndex,totalCount=_this$state.totalCount;var chat=ChatStore.get(chatId);if(!chat)return;var index=-1;if(totalCount){index=currentIndex;}var photo=index>0&&index<_this.history.length?getProfilePhoto(_this.history[index]):getPhotoFromChat(chatId);if(!photo)return;if(!photo.big)return;var file=FileStore.get(photo.big.id)||photo.big;if(!file)return;saveOrDownload(file,file.id+'.jpg',chat,function(){return FileStore.updateChatPhotoBlob(chatId,file.id);});};_this.handleForward=function(){var chatId=_this.props.chatId;if(!isPrivateChat(chatId))return;var _this$state2=_this.state,currentIndex=_this$state2.currentIndex,totalCount=_this$state2.totalCount;var index=-1;if(totalCount){index=currentIndex;}if(index<0||index>=_this.history.length)return;var photo=getProfilePhoto(_this.history[index]);if(!photo)return;var file=photo.big;file=FileStore.get(file.id)||file;if(!file)return;var photoSize={'@type':'photoSize',type:'c',photo:file,width:640,height:640};TdLibController.clientUpdate({'@type':'clientUpdateForward',info:{photoSize:photoSize}});};_this.handleDelete=function(){var _this$props=_this.props,chatId=_this$props.chatId,messageId=_this$props.messageId;var _this$state3=_this.state,currentIndex=_this$state3.currentIndex,totalCount=_this$state3.totalCount;var index=-1;if(totalCount){index=currentIndex;}var photo=index>0&&index<_this.history.length?getProfilePhoto(_this.history[index]):getPhotoFromChat(chatId);if(photo){var file=photo.big;file=FileStore.get(file.id)||file;if(file){var store=FileStore.getReadWriteStore();FileStore.deleteLocalFile(store,file);}}};_this.hasPreviousMedia=function(index){if(index===-1)return false;var nextIndex=index+1;return nextIndex<_this.history.length;};_this.handlePrevious=function(event){if(event){event.stopPropagation();}var currentIndex=_this.state.currentIndex;var nextIndex=currentIndex+1;return _this.loadMedia(nextIndex,function(){if(nextIndex===_this.history.length-1){_this.loadPrevious();}});};_this.loadPrevious=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt(\"return\");case 1:case\"end\":return _context2.stop();}}},_callee2);}));_this.hasNextMedia=function(index){if(index===-1)return false;var nextIndex=index-1;return nextIndex>=0;};_this.handleNext=function(event){if(event){event.stopPropagation();}var currentIndex=_this.state.currentIndex;var nextIndex=currentIndex-1;return _this.loadMedia(nextIndex,function(){if(nextIndex===0){_this.loadNext();}});};_this.loadNext=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt(\"return\");case 1:case\"end\":return _context3.stop();}}},_callee3);}));_this.loadMedia=function(index,callback){if(index<0)return false;if(index>=_this.history.length)return false;_this.setState({currentIndex:index,hasNextMedia:_this.hasNextMedia(index),hasPreviousMedia:_this.hasPreviousMedia(index)},callback);var chatId=_this.props.chatId;preloadProfileMediaViewerContent(chatId,index,_this.history);return true;};_this.history=[];var _this$props2=_this.props,_chatId=_this$props2.chatId,fileId=_this$props2.fileId;_this.state={prevChatId:_chatId,prevFileId:fileId,currentIndex:0,hasNextMedia:false,hasPreviousMedia:false,deleteConfirmationOpened:false};return _this;}_createClass(ProfileMediaViewer,[{key:\"shouldComponentUpdate\",value:function shouldComponentUpdate(nextProps,nextState){var _this$props3=this.props,chatId=_this$props3.chatId,messageId=_this$props3.messageId;var _this$state4=this.state,currentFileId=_this$state4.currentFileId,hasPreviousMedia=_this$state4.hasPreviousMedia,hasNextMedia=_this$state4.hasNextMedia,firstSliceLoaded=_this$state4.firstSliceLoaded,totalCount=_this$state4.totalCount,deleteConfirmationOpened=_this$state4.deleteConfirmationOpened;if(nextProps.chatId!==chatId){return true;}if(nextProps.messageId!==messageId){return true;}if(nextState.currentFileId!==currentFileId){return true;}if(nextState.hasPrevousMedia!==hasPreviousMedia){return true;}if(nextState.hasNextMedia!==hasNextMedia){return true;}if(nextState.firstSliceLoaded!==firstSliceLoaded){return true;}if(nextState.totalCount!==totalCount){return true;}if(nextState.deleteConfirmationOpened!==deleteConfirmationOpened){return true;}return false;}},{key:\"componentDidMount\",value:function componentDidMount(){var chatId=this.props.chatId;var photo=getPhotoFromChat(chatId);loadProfileMediaViewerContent(chatId,[photo]);this.loadHistory();document.addEventListener('keydown',this.onKeyDown,false);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){document.removeEventListener('keydown',this.onKeyDown,false);}},{key:\"render\",value:function render(){var _this$props4=this.props,chatId=_this$props4.chatId,t=_this$props4.t;var _this$state5=this.state,currentIndex=_this$state5.currentIndex,hasNextMedia=_this$state5.hasNextMedia,hasPreviousMedia=_this$state5.hasPreviousMedia,firstSliceLoaded=_this$state5.firstSliceLoaded,totalCount=_this$state5.totalCount,deleteConfirmationOpened=_this$state5.deleteConfirmationOpened,deleteForAll=_this$state5.deleteForAll;var index=-1;if(totalCount){index=currentIndex;}var deleteConfirmation=null;var inHistory=index>=0&&index<this.history.length;var photo=inHistory?getProfilePhoto(this.history[index]):getPhotoFromChat(chatId);var userProfilePhoto=inHistory?this.history[index]:null;var file=photo.big;return React.createElement(\"div\",{className:classNames('media-viewer','media-viewer-default')},deleteConfirmation,React.createElement(\"div\",{className:\"media-viewer-wrapper\",onClick:this.handlePrevious},React.createElement(\"div\",{className:\"media-viewer-left-column\"},React.createElement(\"div\",{className:\"media-viewer-button-placeholder\"}),React.createElement(MediaViewerButton,{disabled:!hasNextMedia,grow:true,onClick:this.handleNext},React.createElement(NavigateBeforeIcon,{fontSize:\"large\"}))),React.createElement(\"div\",{className:\"media-viewer-content-column\"},React.createElement(ProfileMediaViewerContent,{chatId:chatId,photo:photo,onClick:this.handlePrevious})),React.createElement(\"div\",{className:\"media-viewer-right-column\"},React.createElement(MediaViewerButton,{onClick:this.handleClose},React.createElement(CloseIcon,{fontSize:\"large\"})),React.createElement(MediaViewerButton,{disabled:!hasPreviousMedia,grow:true,onClick:this.handlePrevious},React.createElement(NavigateNextIcon,{fontSize:\"large\"})))),React.createElement(\"div\",{className:\"media-viewer-footer\"},React.createElement(ProfileMediaViewerControl,{chatId:chatId,date:getProfilePhotoDateHint(userProfilePhoto)}),React.createElement(MediaViewerFooterText,{title:t('AttachPhoto'),subtitle:totalCount&&index>=0?\"\".concat(index+1,\" of \").concat(totalCount):null}),React.createElement(MediaViewerDownloadButton,{title:t('Save'),fileId:file.id,onClick:this.handleSave}),isPrivateChat(chatId)&&React.createElement(MediaViewerFooterButton,{title:t('Forward'),disabled:!inHistory,onClick:this.handleForward},React.createElement(ReplyIcon,{style:forwardIconStyle})),React.createElement(MediaViewerFooterButton,{title:t('Delete'),disabled:true,onClick:this.handleDelete},React.createElement(DeleteIcon,{style:deleteIconStyle}))));}}]);return ProfileMediaViewer;}(React.Component);export default withTranslation()(ProfileMediaViewer);","map":{"version":3,"sources":["/home/me-admin/Downloads/my-app/src/Components/Viewer/ProfileMediaViewer.js"],"names":["React","classNames","withTranslation","CloseIcon","NavigateNextIcon","NavigateBeforeIcon","ReplyIcon","DeleteIcon","MediaViewerDownloadButton","MediaViewerButton","MediaViewerFooterText","MediaViewerFooterButton","ProfileMediaViewerContent","ProfileMediaViewerControl","setProfileMediaViewerContent","getPhotoFromChat","getChatUserId","isPrivateChat","getProfilePhotoDateHint","getProfilePhoto","loadProfileMediaViewerContent","preloadProfileMediaViewerContent","saveOrDownload","ApplicationStore","FileStore","ChatStore","TdLibController","forwardIconStyle","padding","color","transform","deleteIconStyle","ProfileMediaViewer","props","onKeyDown","event","keyCode","deleteConfirmationOpened","state","handleClose","handlePrevious","handleNext","loadHistory","chatId","send","user_id","offset","limit","result","history","photos","firstSliceLoaded","length","index","setState","currentIndex","hasNextMedia","hasPreviousMedia","totalCount","total_count","handleSave","chat","get","photo","big","file","id","updateChatPhotoBlob","handleForward","photoSize","type","width","height","clientUpdate","info","handleDelete","messageId","store","getReadWriteStore","deleteLocalFile","nextIndex","stopPropagation","loadMedia","loadPrevious","loadNext","callback","fileId","prevChatId","prevFileId","nextProps","nextState","currentFileId","hasPrevousMedia","document","addEventListener","removeEventListener","t","deleteForAll","deleteConfirmation","inHistory","userProfilePhoto","Component"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { withTranslation } from 'react-i18next';\nimport CloseIcon from '@material-ui/icons/Close';\nimport NavigateNextIcon from '@material-ui/icons/NavigateNext';\nimport NavigateBeforeIcon from '@material-ui/icons/NavigateBefore';\nimport ReplyIcon from '@material-ui/icons/Reply';\nimport DeleteIcon from '@material-ui/icons/Delete';\nimport MediaViewerDownloadButton from './MediaViewerDownloadButton';\nimport MediaViewerButton from './MediaViewerButton';\nimport MediaViewerFooterText from './MediaViewerFooterText';\nimport MediaViewerFooterButton from './MediaViewerFooterButton';\nimport ProfileMediaViewerContent from './ProfileMediaViewerContent';\nimport ProfileMediaViewerControl from '../Tile/ProfileMediaViewerControl';\nimport { setProfileMediaViewerContent } from '../../Actions/Client';\nimport { getPhotoFromChat, getChatUserId, isPrivateChat } from '../../Utils/Chat';\nimport { getProfilePhotoDateHint, getProfilePhoto } from '../../Utils/User';\nimport { loadProfileMediaViewerContent, preloadProfileMediaViewerContent, saveOrDownload } from '../../Utils/File';\nimport ApplicationStore from '../../Stores/ApplicationStore';\nimport FileStore from '../../Stores/FileStore';\nimport ChatStore from '../../Stores/ChatStore';\nimport TdLibController from '../../Controllers/TdLibController';\nimport './ProfileMediaViewer.css';\n\nconst forwardIconStyle = {\n    padding: 20,\n    color: 'white',\n    transform: 'scaleX(-1)'\n};\n\nconst deleteIconStyle = {\n    padding: 20,\n    color: 'white'\n};\n\nclass ProfileMediaViewer extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.history = [];\n\n        const { chatId, fileId } = this.props;\n\n        this.state = {\n            prevChatId: chatId,\n            prevFileId: fileId,\n            currentIndex: 0,\n            hasNextMedia: false,\n            hasPreviousMedia: false,\n            deleteConfirmationOpened: false\n        };\n    }\n\n    shouldComponentUpdate(nextProps, nextState) {\n        const { chatId, messageId } = this.props;\n        const {\n            currentFileId,\n            hasPreviousMedia,\n            hasNextMedia,\n            firstSliceLoaded,\n            totalCount,\n            deleteConfirmationOpened\n        } = this.state;\n\n        if (nextProps.chatId !== chatId) {\n            return true;\n        }\n\n        if (nextProps.messageId !== messageId) {\n            return true;\n        }\n\n        if (nextState.currentFileId !== currentFileId) {\n            return true;\n        }\n\n        if (nextState.hasPrevousMedia !== hasPreviousMedia) {\n            return true;\n        }\n\n        if (nextState.hasNextMedia !== hasNextMedia) {\n            return true;\n        }\n\n        if (nextState.firstSliceLoaded !== firstSliceLoaded) {\n            return true;\n        }\n\n        if (nextState.totalCount !== totalCount) {\n            return true;\n        }\n\n        if (nextState.deleteConfirmationOpened !== deleteConfirmationOpened) {\n            return true;\n        }\n\n        return false;\n    }\n\n    componentDidMount() {\n        const { chatId } = this.props;\n        const photo = getPhotoFromChat(chatId);\n        loadProfileMediaViewerContent(chatId, [photo]);\n\n        this.loadHistory();\n\n        document.addEventListener('keydown', this.onKeyDown, false);\n    }\n\n    componentWillUnmount() {\n        document.removeEventListener('keydown', this.onKeyDown, false);\n    }\n\n    onKeyDown = event => {\n        if (event.keyCode === 27) {\n            const { deleteConfirmationOpened } = this.state;\n            if (deleteConfirmationOpened) return;\n\n            this.handleClose();\n        } else if (event.keyCode === 39) {\n            this.handlePrevious();\n        } else if (event.keyCode === 37) {\n            this.handleNext();\n        }\n    };\n\n    loadHistory = async () => {\n        const { chatId } = this.props;\n\n        if (!isPrivateChat(chatId)) return;\n\n        const result = await TdLibController.send({\n            '@type': 'getUserProfilePhotos',\n            user_id: getChatUserId(chatId),\n            offset: 0,\n            limit: 100\n        });\n\n        this.history = result.photos;\n        this.firstSliceLoaded = result.photos.length === 0;\n\n        const index = 0;\n\n        this.setState({\n            currentIndex: index,\n            hasNextMedia: this.hasNextMedia(index),\n            hasPreviousMedia: this.hasPreviousMedia(index),\n            totalCount: result.total_count\n        });\n\n        preloadProfileMediaViewerContent(chatId, index, this.history);\n    };\n\n    handleClose = () => {\n        setProfileMediaViewerContent(null);\n    };\n\n    handleSave = () => {\n        const { chatId } = this.props;\n        const { currentIndex, totalCount } = this.state;\n\n        const chat = ChatStore.get(chatId);\n        if (!chat) return;\n\n        let index = -1;\n        if (totalCount) {\n            index = currentIndex;\n        }\n\n        const photo =\n            index > 0 && index < this.history.length ? getProfilePhoto(this.history[index]) : getPhotoFromChat(chatId);\n        if (!photo) return;\n        if (!photo.big) return;\n\n        const file = FileStore.get(photo.big.id) || photo.big;\n        if (!file) return;\n\n        saveOrDownload(file, file.id + '.jpg', chat, () => FileStore.updateChatPhotoBlob(chatId, file.id));\n    };\n\n    handleForward = () => {\n        const { chatId } = this.props;\n        if (!isPrivateChat(chatId)) return;\n\n        const { currentIndex, totalCount } = this.state;\n\n        let index = -1;\n        if (totalCount) {\n            index = currentIndex;\n        }\n\n        if (index < 0 || index >= this.history.length) return;\n        const photo = getProfilePhoto(this.history[index]);\n        if (!photo) return;\n\n        let { big: file } = photo;\n        file = FileStore.get(file.id) || file;\n        if (!file) return;\n\n        const photoSize = {\n            '@type': 'photoSize',\n            type: 'c',\n            photo: file,\n            width: 640,\n            height: 640\n        };\n\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateForward',\n            info: { photoSize }\n        });\n    };\n\n    handleDelete = () => {\n        const { chatId, messageId } = this.props;\n        const { currentIndex, totalCount } = this.state;\n\n        let index = -1;\n        if (totalCount) {\n            index = currentIndex;\n        }\n\n        const photo =\n            index > 0 && index < this.history.length ? getProfilePhoto(this.history[index]) : getPhotoFromChat(chatId);\n\n        if (photo) {\n            let file = photo.big;\n            file = FileStore.get(file.id) || file;\n            if (file) {\n                const store = FileStore.getReadWriteStore();\n\n                FileStore.deleteLocalFile(store, file);\n            }\n        }\n    };\n\n    hasPreviousMedia = index => {\n        if (index === -1) return false;\n\n        const nextIndex = index + 1;\n        return nextIndex < this.history.length;\n    };\n\n    handlePrevious = event => {\n        if (event) {\n            event.stopPropagation();\n        }\n\n        const { currentIndex } = this.state;\n        const nextIndex = currentIndex + 1;\n\n        return this.loadMedia(nextIndex, () => {\n            if (nextIndex === this.history.length - 1) {\n                this.loadPrevious();\n            }\n        });\n    };\n\n    loadPrevious = async () => {\n        return;\n    };\n\n    hasNextMedia = index => {\n        if (index === -1) return false;\n\n        const nextIndex = index - 1;\n        return nextIndex >= 0;\n    };\n\n    handleNext = event => {\n        if (event) {\n            event.stopPropagation();\n        }\n\n        const { currentIndex } = this.state;\n        const nextIndex = currentIndex - 1;\n\n        return this.loadMedia(nextIndex, () => {\n            if (nextIndex === 0) {\n                this.loadNext();\n            }\n        });\n    };\n\n    loadNext = async () => {\n        return;\n    };\n\n    loadMedia = (index, callback) => {\n        if (index < 0) return false;\n        if (index >= this.history.length) return false;\n\n        this.setState(\n            {\n                currentIndex: index,\n                hasNextMedia: this.hasNextMedia(index),\n                hasPreviousMedia: this.hasPreviousMedia(index)\n            },\n            callback\n        );\n\n        const { chatId } = this.props;\n\n        preloadProfileMediaViewerContent(chatId, index, this.history);\n        return true;\n    };\n\n    render() {\n        const { chatId, t } = this.props;\n        const {\n            currentIndex,\n            hasNextMedia,\n            hasPreviousMedia,\n            firstSliceLoaded,\n            totalCount,\n            deleteConfirmationOpened,\n            deleteForAll\n        } = this.state;\n\n        let index = -1;\n        if (totalCount) {\n            index = currentIndex;\n        }\n\n        const deleteConfirmation = null;\n        const inHistory = index >= 0 && index < this.history.length;\n        const photo = inHistory ? getProfilePhoto(this.history[index]) : getPhotoFromChat(chatId);\n        const userProfilePhoto = inHistory ? this.history[index] : null;\n        const { big: file } = photo;\n\n        return (\n            <div className={classNames('media-viewer', 'media-viewer-default')}>\n                {deleteConfirmation}\n                <div className='media-viewer-wrapper' onClick={this.handlePrevious}>\n                    <div className='media-viewer-left-column'>\n                        <div className='media-viewer-button-placeholder' />\n                        <MediaViewerButton disabled={!hasNextMedia} grow onClick={this.handleNext}>\n                            <NavigateBeforeIcon fontSize='large' />\n                        </MediaViewerButton>\n                    </div>\n\n                    <div className='media-viewer-content-column'>\n                        <ProfileMediaViewerContent chatId={chatId} photo={photo} onClick={this.handlePrevious} />\n                    </div>\n\n                    <div className='media-viewer-right-column'>\n                        <MediaViewerButton onClick={this.handleClose}>\n                            <CloseIcon fontSize='large' />\n                        </MediaViewerButton>\n                        <MediaViewerButton disabled={!hasPreviousMedia} grow onClick={this.handlePrevious}>\n                            <NavigateNextIcon fontSize='large' />\n                        </MediaViewerButton>\n                    </div>\n                </div>\n                <div className='media-viewer-footer'>\n                    <ProfileMediaViewerControl chatId={chatId} date={getProfilePhotoDateHint(userProfilePhoto)} />\n                    <MediaViewerFooterText\n                        title={t('AttachPhoto')}\n                        subtitle={totalCount && index >= 0 ? `${index + 1} of ${totalCount}` : null}\n                    />\n                    <MediaViewerDownloadButton title={t('Save')} fileId={file.id} onClick={this.handleSave} />\n                    {isPrivateChat(chatId) && (\n                        <MediaViewerFooterButton\n                            title={t('Forward')}\n                            disabled={!inHistory}\n                            onClick={this.handleForward}>\n                            <ReplyIcon style={forwardIconStyle} />\n                        </MediaViewerFooterButton>\n                    )}\n                    <MediaViewerFooterButton title={t('Delete')} disabled onClick={this.handleDelete}>\n                        <DeleteIcon style={deleteIconStyle} />\n                    </MediaViewerFooterButton>\n                </div>\n            </div>\n        );\n    }\n}\n\nProfileMediaViewer.propTypes = {\n    chatId: PropTypes.number.isRequired\n};\n\nexport default withTranslation()(ProfileMediaViewer);\n"]},"metadata":{},"sourceType":"module"}