{"ast":null,"code":"var _jsxFileName = \"/home/me-admin/Downloads/telegram-app/src/Components/Tile/SharedMedia/SharedPhoto.js\";\n\n/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { compose } from 'recompose';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport { withTranslation } from 'react-i18next';\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport Checkbox from '@material-ui/core/Checkbox/';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport MenuList from '@material-ui/core/MenuList';\nimport Popover from '@material-ui/core/Popover';\nimport { PHOTO_SIZE, PHOTO_THUMBNAIL_SIZE } from '../../../Constants';\nimport { forwardMessages, openChat } from '../../../Actions/Client';\nimport { getSrc } from '../../../Utils/File';\nimport { getSize } from '../../../Utils/Common';\nimport { getChatShortTitle, isPrivateChat } from '../../../Utils/Chat';\nimport { isBlurredThumbnail } from '../../../Utils/Media';\nimport FileStore from '../../../Stores/FileStore';\nimport MessageStore from '../../../Stores/MessageStore';\nimport TdLibController from '../../../Controllers/TdLibController';\nimport './SharedPhoto.css';\n\nconst styles = theme => ({\n  sharedPhotoContent: {\n    backgroundColor: theme.palette.type === 'dark' ? theme.palette.background.paper : theme.palette.background.default\n  }\n});\n\nclass SharedPhoto extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.onClientUpdatePhotoBlob = update => {\n      const _this$state = this.state,\n            photoSize = _this$state.photoSize,\n            thumbSize = _this$state.thumbSize;\n      const fileId = update.fileId;\n\n      if (photoSize && photoSize.photo && photoSize.photo.id === fileId) {\n        this.forceUpdate();\n      } else if (thumbSize && thumbSize.photo && thumbSize.photo.id === fileId) {\n        this.forceUpdate();\n      }\n    };\n\n    this.handleOpenMessage = event => {\n      this.handleCloseContextMenu(event);\n      const _this$props = this.props,\n            chatId = _this$props.chatId,\n            messageId = _this$props.messageId;\n      openChat(chatId, messageId);\n    };\n\n    this.handleForward = event => {\n      this.handleCloseContextMenu(event);\n      const _this$props2 = this.props,\n            chatId = _this$props2.chatId,\n            messageId = _this$props2.messageId;\n      forwardMessages(chatId, [messageId]);\n    };\n\n    this.handleDelete = event => {\n      this.handleCloseContextMenu(event);\n      const _this$props3 = this.props,\n            chatId = _this$props3.chatId,\n            messageId = _this$props3.messageId;\n      const message = MessageStore.get(chatId, messageId);\n      if (!message) return null;\n      const can_be_deleted_for_all_users = message.can_be_deleted_for_all_users;\n      this.setState({\n        openDeleteDialog: true,\n        canBeDeletedForAllUsers: can_be_deleted_for_all_users,\n        revoke: can_be_deleted_for_all_users\n      });\n    };\n\n    this.handleContextMenu = async event => {\n      if (event) {\n        event.preventDefault();\n        event.stopPropagation();\n      }\n\n      const contextMenu = this.state.contextMenu;\n\n      if (contextMenu) {\n        this.setState({\n          contextMenu: false\n        });\n      } else {\n        const left = event.clientX;\n        const top = event.clientY;\n        this.setState({\n          contextMenu: true,\n          left,\n          top\n        });\n      }\n    };\n\n    this.handleCloseContextMenu = event => {\n      if (event) {\n        event.stopPropagation();\n      }\n\n      this.setState({\n        contextMenu: false\n      });\n    };\n\n    this.handleRevokeChange = () => {\n      this.setState({\n        revoke: !this.state.revoke\n      });\n    };\n\n    this.handleCloseDelete = () => {\n      this.setState({\n        openDeleteDialog: false\n      });\n    };\n\n    this.handleDeleteContinue = () => {\n      const _this$props4 = this.props,\n            chatId = _this$props4.chatId,\n            messageId = _this$props4.messageId;\n      const revoke = this.state.revoke;\n      this.handleCloseDelete();\n      TdLibController.send({\n        '@type': 'deleteMessages',\n        chat_id: chatId,\n        message_ids: [messageId],\n        revoke: revoke\n      });\n    };\n\n    const photo = props.photo,\n          size = props.size,\n          thumbnailSize = props.thumbnailSize;\n    this.state = {\n      contextMenu: false,\n      left: 0,\n      top: 0,\n      openDeleteDialog: false,\n      revoke: false,\n      photoSize: getSize(photo.sizes, size),\n      thumbSize: getSize(photo.sizes, thumbnailSize)\n    };\n  }\n\n  componentDidMount() {\n    FileStore.on('clientUpdatePhotoBlob', this.onClientUpdatePhotoBlob);\n  }\n\n  componentWillUnmount() {\n    FileStore.removeListener('clientUpdatePhotoBlob', this.onClientUpdatePhotoBlob);\n  }\n\n  render() {\n    const _this$props5 = this.props,\n          chatId = _this$props5.chatId,\n          messageId = _this$props5.messageId,\n          classes = _this$props5.classes,\n          openMedia = _this$props5.openMedia,\n          style = _this$props5.style,\n          showOpenMessage = _this$props5.showOpenMessage,\n          t = _this$props5.t;\n    const _this$state2 = this.state,\n          thumbSize = _this$state2.thumbSize,\n          photoSize = _this$state2.photoSize,\n          contextMenu = _this$state2.contextMenu,\n          left = _this$state2.left,\n          top = _this$state2.top,\n          openDeleteDialog = _this$state2.openDeleteDialog,\n          revoke = _this$state2.revoke;\n    const message = MessageStore.get(chatId, messageId);\n    if (!message) return null;\n    const can_be_forwarded = message.can_be_forwarded,\n          can_be_deleted_only_for_self = message.can_be_deleted_only_for_self,\n          can_be_deleted_for_all_users = message.can_be_deleted_for_all_users;\n    const count = 1;\n    if (!photoSize) return null;\n    const src = getSrc(photoSize.photo);\n    const thumbSrc = getSrc(thumbSize ? thumbSize.photo : null);\n    const isBlurred = isBlurredThumbnail(thumbSize);\n    return React.createElement(\"div\", {\n      className: \"shared-photo\",\n      style: style,\n      onClick: openMedia,\n      onContextMenu: this.handleContextMenu,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: classNames('shared-photo-content', classes.sharedPhotoContent),\n      style: {\n        backgroundImage: \"url(\".concat(thumbSrc, \")\")\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182\n      },\n      __self: this\n    }, src !== thumbSrc && React.createElement(\"div\", {\n      className: \"shared-photo-main-content\",\n      style: {\n        backgroundImage: \"url(\".concat(src, \")\")\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186\n      },\n      __self: this\n    })), React.createElement(Popover, {\n      open: contextMenu,\n      onClose: this.handleCloseContextMenu,\n      anchorReference: \"anchorPosition\",\n      anchorPosition: {\n        top,\n        left\n      },\n      anchorOrigin: {\n        vertical: 'bottom',\n        horizontal: 'right'\n      },\n      transformOrigin: {\n        vertical: 'top',\n        horizontal: 'left'\n      },\n      onMouseDown: e => e.stopPropagation(),\n      onClick: e => e.stopPropagation(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189\n      },\n      __self: this\n    }, React.createElement(MenuList, {\n      classes: {\n        root: classes.menuListRoot\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 204\n      },\n      __self: this\n    }, showOpenMessage && React.createElement(MenuItem, {\n      onClick: this.handleOpenMessage,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205\n      },\n      __self: this\n    }, t('GoToMessage')), can_be_forwarded && React.createElement(MenuItem, {\n      onClick: this.handleForward,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206\n      },\n      __self: this\n    }, t('Forward')), (can_be_deleted_only_for_self || can_be_deleted_for_all_users) && React.createElement(MenuItem, {\n      onClick: this.handleDelete,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208\n      },\n      __self: this\n    }, t('Delete')))), React.createElement(Dialog, {\n      transitionDuration: 0,\n      open: openDeleteDialog,\n      onClose: this.handleCloseDelete,\n      \"aria-labelledby\": \"delete-dialog-title\",\n      onClick: e => e.stopPropagation(),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212\n      },\n      __self: this\n    }, React.createElement(DialogTitle, {\n      id: \"delete-dialog-title\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218\n      },\n      __self: this\n    }, \"Confirm\"), React.createElement(DialogContent, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219\n      },\n      __self: this\n    }, React.createElement(DialogContentText, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 220\n      },\n      __self: this\n    }, count === 1 ? 'Are you sure you want to delete 1 message?' : \"Are you sure you want to delete \".concat(count, \" messages?\")), can_be_deleted_for_all_users && React.createElement(FormControlLabel, {\n      control: React.createElement(Checkbox, {\n        checked: revoke,\n        onChange: this.handleRevokeChange,\n        color: \"primary\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228\n        },\n        __self: this\n      }),\n      label: isPrivateChat(chatId) ? \"Delete for \".concat(getChatShortTitle(chatId)) : 'Delete for all',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226\n      },\n      __self: this\n    })), React.createElement(DialogActions, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236\n      },\n      __self: this\n    }, React.createElement(Button, {\n      onClick: this.handleCloseDelete,\n      color: \"primary\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237\n      },\n      __self: this\n    }, \"Cancel\"), React.createElement(Button, {\n      onClick: this.handleDeleteContinue,\n      color: \"primary\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 240\n      },\n      __self: this\n    }, \"Ok\"))));\n  }\n\n}\n\nSharedPhoto.propTypes = {\n  chatId: PropTypes.number.isRequired,\n  messageId: PropTypes.number.isRequired,\n  photo: PropTypes.object.isRequired,\n  showOpenMessage: PropTypes.bool.isRequired,\n  openMedia: PropTypes.func,\n  size: PropTypes.number,\n  thumbnailSize: PropTypes.number,\n  style: PropTypes.object\n};\nSharedPhoto.defaultProps = {\n  size: PHOTO_SIZE,\n  thumbnailSize: PHOTO_THUMBNAIL_SIZE\n};\nconst enhance = compose(withStyles(styles, {\n  withTheme: true\n}), withTranslation());\nexport default enhance(SharedPhoto);","map":{"version":3,"sources":["/home/me-admin/Downloads/telegram-app/src/Components/Tile/SharedMedia/SharedPhoto.js"],"names":["React","PropTypes","classNames","compose","withStyles","withTranslation","Button","Dialog","DialogActions","DialogContent","DialogContentText","DialogTitle","FormControlLabel","Checkbox","MenuItem","MenuList","Popover","PHOTO_SIZE","PHOTO_THUMBNAIL_SIZE","forwardMessages","openChat","getSrc","getSize","getChatShortTitle","isPrivateChat","isBlurredThumbnail","FileStore","MessageStore","TdLibController","styles","theme","sharedPhotoContent","backgroundColor","palette","type","background","paper","default","SharedPhoto","Component","constructor","props","onClientUpdatePhotoBlob","update","state","photoSize","thumbSize","fileId","photo","id","forceUpdate","handleOpenMessage","event","handleCloseContextMenu","chatId","messageId","handleForward","handleDelete","message","get","can_be_deleted_for_all_users","setState","openDeleteDialog","canBeDeletedForAllUsers","revoke","handleContextMenu","preventDefault","stopPropagation","contextMenu","left","clientX","top","clientY","handleRevokeChange","handleCloseDelete","handleDeleteContinue","send","chat_id","message_ids","size","thumbnailSize","sizes","componentDidMount","on","componentWillUnmount","removeListener","render","classes","openMedia","style","showOpenMessage","t","can_be_forwarded","can_be_deleted_only_for_self","count","src","thumbSrc","isBlurred","backgroundImage","vertical","horizontal","e","root","menuListRoot","propTypes","number","isRequired","object","bool","func","defaultProps","enhance","withTheme"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { compose } from 'recompose';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport { withTranslation } from 'react-i18next';\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport Checkbox from '@material-ui/core/Checkbox/';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport MenuList from '@material-ui/core/MenuList';\nimport Popover from '@material-ui/core/Popover';\nimport { PHOTO_SIZE, PHOTO_THUMBNAIL_SIZE } from '../../../Constants';\nimport { forwardMessages, openChat } from '../../../Actions/Client';\nimport { getSrc } from '../../../Utils/File';\nimport { getSize } from '../../../Utils/Common';\nimport { getChatShortTitle, isPrivateChat } from '../../../Utils/Chat';\nimport { isBlurredThumbnail } from '../../../Utils/Media';\nimport FileStore from '../../../Stores/FileStore';\nimport MessageStore from '../../../Stores/MessageStore';\nimport TdLibController from '../../../Controllers/TdLibController';\nimport './SharedPhoto.css';\n\nconst styles = theme => ({\n    sharedPhotoContent: {\n        backgroundColor:\n            theme.palette.type === 'dark' ? theme.palette.background.paper : theme.palette.background.default\n    }\n});\n\nclass SharedPhoto extends React.Component {\n    constructor(props) {\n        super(props);\n\n        const { photo, size, thumbnailSize } = props;\n\n        this.state = {\n            contextMenu: false,\n            left: 0,\n            top: 0,\n            openDeleteDialog: false,\n            revoke: false,\n\n            photoSize: getSize(photo.sizes, size),\n            thumbSize: getSize(photo.sizes, thumbnailSize)\n        };\n    }\n\n    componentDidMount() {\n        FileStore.on('clientUpdatePhotoBlob', this.onClientUpdatePhotoBlob);\n    }\n\n    componentWillUnmount() {\n        FileStore.removeListener('clientUpdatePhotoBlob', this.onClientUpdatePhotoBlob);\n    }\n\n    onClientUpdatePhotoBlob = update => {\n        const { photoSize, thumbSize } = this.state;\n        const { fileId } = update;\n\n        if (photoSize && photoSize.photo && photoSize.photo.id === fileId) {\n            this.forceUpdate();\n        } else if (thumbSize && thumbSize.photo && thumbSize.photo.id === fileId) {\n            this.forceUpdate();\n        }\n    };\n\n    handleOpenMessage = event => {\n        this.handleCloseContextMenu(event);\n\n        const { chatId, messageId } = this.props;\n\n        openChat(chatId, messageId);\n    };\n\n    handleForward = event => {\n        this.handleCloseContextMenu(event);\n\n        const { chatId, messageId } = this.props;\n\n        forwardMessages(chatId, [messageId]);\n    };\n\n    handleDelete = event => {\n        this.handleCloseContextMenu(event);\n\n        const { chatId, messageId } = this.props;\n\n        const message = MessageStore.get(chatId, messageId);\n        if (!message) return null;\n\n        const { can_be_deleted_for_all_users } = message;\n\n        this.setState({\n            openDeleteDialog: true,\n            canBeDeletedForAllUsers: can_be_deleted_for_all_users,\n            revoke: can_be_deleted_for_all_users\n        });\n    };\n\n    handleContextMenu = async event => {\n        if (event) {\n            event.preventDefault();\n            event.stopPropagation();\n        }\n        const { contextMenu } = this.state;\n\n        if (contextMenu) {\n            this.setState({ contextMenu: false });\n        } else {\n            const left = event.clientX;\n            const top = event.clientY;\n\n            this.setState({\n                contextMenu: true,\n                left,\n                top\n            });\n        }\n    };\n\n    handleCloseContextMenu = event => {\n        if (event) {\n            event.stopPropagation();\n        }\n\n        this.setState({ contextMenu: false });\n    };\n\n    handleRevokeChange = () => {\n        this.setState({ revoke: !this.state.revoke });\n    };\n\n    handleCloseDelete = () => {\n        this.setState({ openDeleteDialog: false });\n    };\n\n    handleDeleteContinue = () => {\n        const { chatId, messageId } = this.props;\n        const { revoke } = this.state;\n\n        this.handleCloseDelete();\n\n        TdLibController.send({\n            '@type': 'deleteMessages',\n            chat_id: chatId,\n            message_ids: [messageId],\n            revoke: revoke\n        });\n    };\n\n    render() {\n        const { chatId, messageId, classes, openMedia, style, showOpenMessage, t } = this.props;\n        const { thumbSize, photoSize, contextMenu, left, top, openDeleteDialog, revoke } = this.state;\n\n        const message = MessageStore.get(chatId, messageId);\n        if (!message) return null;\n\n        const { can_be_forwarded, can_be_deleted_only_for_self, can_be_deleted_for_all_users } = message;\n        const count = 1;\n\n        if (!photoSize) return null;\n\n        const src = getSrc(photoSize.photo);\n        const thumbSrc = getSrc(thumbSize ? thumbSize.photo : null);\n        const isBlurred = isBlurredThumbnail(thumbSize);\n\n        return (\n            <div className='shared-photo' style={style} onClick={openMedia} onContextMenu={this.handleContextMenu}>\n                <div\n                    className={classNames('shared-photo-content', classes.sharedPhotoContent)}\n                    style={{ backgroundImage: `url(${thumbSrc})` }}>\n                    {src !== thumbSrc && (\n                        <div className='shared-photo-main-content' style={{ backgroundImage: `url(${src})` }} />\n                    )}\n                </div>\n                <Popover\n                    open={contextMenu}\n                    onClose={this.handleCloseContextMenu}\n                    anchorReference='anchorPosition'\n                    anchorPosition={{ top, left }}\n                    anchorOrigin={{\n                        vertical: 'bottom',\n                        horizontal: 'right'\n                    }}\n                    transformOrigin={{\n                        vertical: 'top',\n                        horizontal: 'left'\n                    }}\n                    onMouseDown={e => e.stopPropagation()}\n                    onClick={e => e.stopPropagation()}>\n                    <MenuList classes={{ root: classes.menuListRoot }}>\n                        {showOpenMessage && <MenuItem onClick={this.handleOpenMessage}>{t('GoToMessage')}</MenuItem>}\n                        {can_be_forwarded && <MenuItem onClick={this.handleForward}>{t('Forward')}</MenuItem>}\n                        {(can_be_deleted_only_for_self || can_be_deleted_for_all_users) && (\n                            <MenuItem onClick={this.handleDelete}>{t('Delete')}</MenuItem>\n                        )}\n                    </MenuList>\n                </Popover>\n                <Dialog\n                    transitionDuration={0}\n                    open={openDeleteDialog}\n                    onClose={this.handleCloseDelete}\n                    aria-labelledby='delete-dialog-title'\n                    onClick={e => e.stopPropagation()}>\n                    <DialogTitle id='delete-dialog-title'>Confirm</DialogTitle>\n                    <DialogContent>\n                        <DialogContentText>\n                            {count === 1\n                                ? 'Are you sure you want to delete 1 message?'\n                                : `Are you sure you want to delete ${count} messages?`}\n                        </DialogContentText>\n                        {can_be_deleted_for_all_users && (\n                            <FormControlLabel\n                                control={\n                                    <Checkbox checked={revoke} onChange={this.handleRevokeChange} color='primary' />\n                                }\n                                label={\n                                    isPrivateChat(chatId) ? `Delete for ${getChatShortTitle(chatId)}` : 'Delete for all'\n                                }\n                            />\n                        )}\n                    </DialogContent>\n                    <DialogActions>\n                        <Button onClick={this.handleCloseDelete} color='primary'>\n                            Cancel\n                        </Button>\n                        <Button onClick={this.handleDeleteContinue} color='primary'>\n                            Ok\n                        </Button>\n                    </DialogActions>\n                </Dialog>\n            </div>\n        );\n    }\n}\n\nSharedPhoto.propTypes = {\n    chatId: PropTypes.number.isRequired,\n    messageId: PropTypes.number.isRequired,\n    photo: PropTypes.object.isRequired,\n    showOpenMessage: PropTypes.bool.isRequired,\n    openMedia: PropTypes.func,\n\n    size: PropTypes.number,\n    thumbnailSize: PropTypes.number,\n    style: PropTypes.object\n};\n\nSharedPhoto.defaultProps = {\n    size: PHOTO_SIZE,\n    thumbnailSize: PHOTO_THUMBNAIL_SIZE\n};\n\nconst enhance = compose(\n    withStyles(styles, { withTheme: true }),\n    withTranslation()\n);\n\nexport default enhance(SharedPhoto);\n"]},"metadata":{},"sourceType":"module"}