{"ast":null,"code":"import _classCallCheck from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _defineProperty from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */import React from'react';import classNames from'classnames';import withStyles from'@material-ui/core/styles/withStyles';import Sticker,{StickerSourceEnum}from'../Message/Media/Sticker';import StickerPreview from'./StickerPreview';import{borderStyle}from'../Theme';import{loadStickerContent,loadStickersContent}from'../../Utils/File';import{STICKER_HINT_DISPLAY_SIZE,STICKER_SMALL_DISPLAY_SIZE}from'../../Constants';import FileStore from'../../Stores/FileStore';import StickerStore from'../../Stores/StickerStore';import TdLibController from'../../Controllers/TdLibController';import'./StickersHint.css';var styles=function styles(theme){return _objectSpread({root:{background:theme.palette.type==='dark'?theme.palette.background.default:'#FFFFFF'}},borderStyle(theme));};var StickersHint=/*#__PURE__*/function(_React$Component){_inherits(StickersHint,_React$Component);function StickersHint(props){var _this;_classCallCheck(this,StickersHint);_this=_possibleConstructorReturn(this,_getPrototypeOf(StickersHint).call(this,props));_this.onClientUpdateRemoteStickersHint=function(update){var hint=update.hint;var currentHint=_this.state.hint;if(currentHint&&hint.timestamp!==currentHint.timestamp)return;_this.setState({hint:StickerStore.hint,items:_this.getItems(StickerStore.hint)});var store=FileStore.getStore();var stickers=hint.stickers;loadStickersContent(store,stickers.stickers);};_this.onClientUpdateLocalStickersHint=function(update){var hint=update.hint;_this.setState({hint:hint,items:_this.getItems(hint),previewStickerId:0,showPreview:false,cancelSend:false});if(!hint)return;var store=FileStore.getStore();var stickers=hint.stickers;loadStickersContent(store,stickers.stickers);};_this.handleSend=function(sticker){var cancelSend=_this.state.cancelSend;if(cancelSend)return;if(!sticker)return;TdLibController.clientUpdate({'@type':'clientUpdateStickerSend',sticker:sticker});};_this.loadPreviewContent=function(stickerId){var items=_this.state.items;var sticker=items.find(function(x){return x.sticker.id===stickerId;});if(!sticker)return;var store=FileStore.getStore();loadStickerContent(store,sticker,null);var stickersPerRow=8;if(_this.hintsRef&&_this.hintsRef.current){stickersPerRow=Math.floor(_this.hintsRef.current.clientWidth/STICKER_HINT_DISPLAY_SIZE);}var preloadStickers=_this.getNeighborStickers(stickerId,items,stickersPerRow);preloadStickers.forEach(function(x){loadStickerContent(store,x,null);});};_this.getNeighborStickers=function(stickerId,stickers,stickersPerRow){if(!stickers)return[];var indexes=[];var index=stickers.findIndex(function(x){return x.sticker.id===stickerId;});if(index===-1)return[];var row=Math.floor(index/stickersPerRow);var column=index%stickersPerRow;var prevRow=row-1;var nextRow=row+1;var prevColumn=column-1;var nextColumn=column+1;if(prevRow>=0){if(prevColumn>=0){indexes.push(stickersPerRow*prevRow+prevColumn);}indexes.push(stickersPerRow*prevRow+column);if(nextColumn<stickersPerRow){indexes.push(stickersPerRow*prevRow+nextColumn);}}if(prevColumn>=0){indexes.push(stickersPerRow*row+prevColumn);}if(nextColumn<stickersPerRow){indexes.push(stickersPerRow*row+nextColumn);}if(nextRow<Math.ceil(stickers.length/stickersPerRow)){if(prevColumn>=0){indexes.push(stickersPerRow*nextRow+prevColumn);}indexes.push(stickersPerRow*nextRow+column);if(nextColumn<stickersPerRow){indexes.push(stickersPerRow*nextRow+nextColumn);}}return indexes.map(function(i){return stickers[i];});};_this.handleMouseEnter=function(event){var stickerId=Number(event.currentTarget.dataset.stickerId);var sticker=_this.getSticker(stickerId);if(!sticker)return;if(!_this.mouseDown)return;if(_this.mouseDownStickerId!==stickerId){_this.mouseDownStickerId=null;}_this.setState({sticker:sticker});TdLibController.clientUpdate({'@type':'clientUpdateStickerPreview',sticker:sticker});_this.loadPreviewContent(stickerId);};_this.handleMouseDown=function(event){var stickerId=Number(event.currentTarget.dataset.stickerId);var sticker=_this.getSticker(stickerId);if(!sticker)return;_this.mouseDownStickerId=stickerId;var now=Date.now();_this.setState({sticker:sticker,timestamp:now,showPreview:false,cancelSend:false});setTimeout(function(){var timestamp=_this.state.timestamp;if(timestamp===now){_this.setState({showPreview:true,cancelSend:true});TdLibController.clientUpdate({'@type':'clientUpdateStickerPreview',sticker:sticker});}},500);_this.loadPreviewContent(stickerId);_this.mouseDown=true;document.addEventListener('mouseup',_this.handleMouseUp);event.preventDefault();event.stopPropagation();return false;};_this.handleMouseUp=function(){var sticker=null;_this.setState({sticker:sticker,timestamp:0,showPreview:false});TdLibController.clientUpdate({'@type':'clientUpdateStickerPreview',sticker:sticker});_this.mouseDown=false;document.removeEventListener('mouseup',_this.handleMouseUp);};_this.getItems=function(hint){var items=[];if(!hint)return items;var dict=new Map();var stickers=hint.stickers,foundStickers=hint.foundStickers;if(stickers){stickers.stickers.forEach(function(x){items.push(x);dict.set(x.sticker.id,x.sticker.id);});}if(foundStickers){foundStickers.stickers.forEach(function(x){if(!dict.has(x.sticker.id)){items.push(x);dict.set(x.sticker.id,x.sticker.id);}});}return items;};_this.hintsRef=React.createRef();_this.state={hint:null,items:[],previewStickerId:0,showPreview:false,cancelSend:false};return _this;}_createClass(StickersHint,[{key:\"componentDidMount\",value:function componentDidMount(){StickerStore.on('clientUpdateLocalStickersHint',this.onClientUpdateLocalStickersHint);StickerStore.on('clientUpdateRemoteStickersHint',this.onClientUpdateRemoteStickersHint);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){StickerStore.removeListener('clientUpdateLocalStickersHint',this.onClientUpdateLocalStickersHint);StickerStore.removeListener('clientUpdateRemoteStickersHint',this.onClientUpdateRemoteStickersHint);}},{key:\"getSticker\",value:function getSticker(stickerId){var items=this.state.items;var stickerIndex=items.findIndex(function(x){return x.sticker.id===stickerId;});return stickerIndex!==-1?items[stickerIndex]:null;}},{key:\"render\",value:function render(){var _this2=this;var classes=this.props.classes;var _this$state=this.state,hint=_this$state.hint,items=_this$state.items,sticker=_this$state.sticker,showPreview=_this$state.showPreview;if(!hint)return null;if(!items)return null;if(!items.length)return null;var controls=items.map(function(x){return React.createElement(\"div\",{className:\"sticker-set-dialog-item\",key:x.sticker.id,\"data-sticker-id\":x.sticker.id,style:{width:STICKER_HINT_DISPLAY_SIZE,height:STICKER_HINT_DISPLAY_SIZE},onClick:function onClick(){return _this2.handleSend(x);},onMouseEnter:_this2.handleMouseEnter,onMouseDown:_this2.handleMouseDown},React.createElement(Sticker,{key:x.sticker.id,className:\"sticker-set-dialog-item-sticker\",sticker:x,autoplay:false,blur:false,displaySize:STICKER_SMALL_DISPLAY_SIZE,preview:true,source:StickerSourceEnum.HINTS}));});return React.createElement(\"div\",{ref:this.hintsRef,className:classNames('stickers-hint',classes.borderColor,classes.root)},controls,Boolean(sticker)&&showPreview&&React.createElement(StickerPreview,{sticker:sticker}));}}]);return StickersHint;}(React.Component);export default withStyles(styles)(StickersHint);","map":{"version":3,"sources":["/Users/yosuahalim/Documents/Projects/telegram-app/src/Components/ColumnMiddle/StickersHint.js"],"names":["React","classNames","withStyles","Sticker","StickerSourceEnum","StickerPreview","borderStyle","loadStickerContent","loadStickersContent","STICKER_HINT_DISPLAY_SIZE","STICKER_SMALL_DISPLAY_SIZE","FileStore","StickerStore","TdLibController","styles","theme","root","background","palette","type","default","StickersHint","props","onClientUpdateRemoteStickersHint","update","hint","currentHint","state","timestamp","setState","items","getItems","store","getStore","stickers","onClientUpdateLocalStickersHint","previewStickerId","showPreview","cancelSend","handleSend","sticker","clientUpdate","loadPreviewContent","stickerId","find","x","id","stickersPerRow","hintsRef","current","Math","floor","clientWidth","preloadStickers","getNeighborStickers","forEach","indexes","index","findIndex","row","column","prevRow","nextRow","prevColumn","nextColumn","push","ceil","length","map","i","handleMouseEnter","event","Number","currentTarget","dataset","getSticker","mouseDown","mouseDownStickerId","handleMouseDown","now","Date","setTimeout","document","addEventListener","handleMouseUp","preventDefault","stopPropagation","removeEventListener","dict","Map","foundStickers","set","has","createRef","on","removeListener","stickerIndex","classes","controls","width","height","HINTS","borderColor","Boolean","Component"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport Sticker, { StickerSourceEnum } from '../Message/Media/Sticker';\nimport StickerPreview from './StickerPreview';\nimport { borderStyle } from '../Theme';\nimport { loadStickerContent, loadStickersContent } from '../../Utils/File';\nimport { STICKER_HINT_DISPLAY_SIZE, STICKER_SMALL_DISPLAY_SIZE } from '../../Constants';\nimport FileStore from '../../Stores/FileStore';\nimport StickerStore from '../../Stores/StickerStore';\nimport TdLibController from '../../Controllers/TdLibController';\nimport './StickersHint.css';\n\nconst styles = theme => ({\n    root: {\n        background: theme.palette.type === 'dark' ? theme.palette.background.default : '#FFFFFF'\n    },\n    ...borderStyle(theme)\n});\n\nclass StickersHint extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.hintsRef = React.createRef();\n\n        this.state = {\n            hint: null,\n            items: [],\n            previewStickerId: 0,\n            showPreview: false,\n            cancelSend: false\n        };\n    }\n\n    componentDidMount() {\n        StickerStore.on('clientUpdateLocalStickersHint', this.onClientUpdateLocalStickersHint);\n        StickerStore.on('clientUpdateRemoteStickersHint', this.onClientUpdateRemoteStickersHint);\n    }\n\n    componentWillUnmount() {\n        StickerStore.removeListener('clientUpdateLocalStickersHint', this.onClientUpdateLocalStickersHint);\n        StickerStore.removeListener('clientUpdateRemoteStickersHint', this.onClientUpdateRemoteStickersHint);\n    }\n\n    onClientUpdateRemoteStickersHint = update => {\n        const { hint } = update;\n        const { hint: currentHint } = this.state;\n\n        if (currentHint && hint.timestamp !== currentHint.timestamp) return;\n\n        this.setState({\n            hint: StickerStore.hint,\n            items: this.getItems(StickerStore.hint)\n        });\n\n        const store = FileStore.getStore();\n        const { stickers } = hint;\n        loadStickersContent(store, stickers.stickers);\n    };\n\n    onClientUpdateLocalStickersHint = update => {\n        const { hint } = update;\n\n        this.setState({\n            hint,\n            items: this.getItems(hint),\n            previewStickerId: 0,\n            showPreview: false,\n            cancelSend: false\n        });\n\n        if (!hint) return;\n\n        const store = FileStore.getStore();\n        const { stickers } = hint;\n        loadStickersContent(store, stickers.stickers);\n    };\n\n    handleSend = sticker => {\n        const { cancelSend } = this.state;\n        if (cancelSend) return;\n        if (!sticker) return;\n\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateStickerSend',\n            sticker\n        });\n    };\n\n    loadPreviewContent = stickerId => {\n        const { items } = this.state;\n\n        const sticker = items.find(x => x.sticker.id === stickerId);\n        if (!sticker) return;\n\n        const store = FileStore.getStore();\n        loadStickerContent(store, sticker, null);\n\n        let stickersPerRow = 8;\n        if (this.hintsRef && this.hintsRef.current) {\n            stickersPerRow = Math.floor(this.hintsRef.current.clientWidth / STICKER_HINT_DISPLAY_SIZE);\n        }\n\n        const preloadStickers = this.getNeighborStickers(stickerId, items, stickersPerRow);\n        preloadStickers.forEach(x => {\n            loadStickerContent(store, x, null);\n        });\n    };\n\n    getNeighborStickers = (stickerId, stickers, stickersPerRow) => {\n        if (!stickers) return [];\n\n        const indexes = [];\n        const index = stickers.findIndex(x => x.sticker.id === stickerId);\n        if (index === -1) return [];\n\n        const row = Math.floor(index / stickersPerRow);\n        const column = index % stickersPerRow;\n\n        const prevRow = row - 1;\n        const nextRow = row + 1;\n        const prevColumn = column - 1;\n        const nextColumn = column + 1;\n\n        if (prevRow >= 0) {\n            if (prevColumn >= 0) {\n                indexes.push(stickersPerRow * prevRow + prevColumn);\n            }\n            indexes.push(stickersPerRow * prevRow + column);\n            if (nextColumn < stickersPerRow) {\n                indexes.push(stickersPerRow * prevRow + nextColumn);\n            }\n        }\n\n        if (prevColumn >= 0) {\n            indexes.push(stickersPerRow * row + prevColumn);\n        }\n        if (nextColumn < stickersPerRow) {\n            indexes.push(stickersPerRow * row + nextColumn);\n        }\n\n        if (nextRow < Math.ceil(stickers.length / stickersPerRow)) {\n            if (prevColumn >= 0) {\n                indexes.push(stickersPerRow * nextRow + prevColumn);\n            }\n            indexes.push(stickersPerRow * nextRow + column);\n            if (nextColumn < stickersPerRow) {\n                indexes.push(stickersPerRow * nextRow + nextColumn);\n            }\n        }\n\n        return indexes.map(i => stickers[i]);\n    };\n\n    handleMouseEnter = event => {\n        const stickerId = Number(event.currentTarget.dataset.stickerId);\n        const sticker = this.getSticker(stickerId);\n        if (!sticker) return;\n\n        if (!this.mouseDown) return;\n\n        if (this.mouseDownStickerId !== stickerId) {\n            this.mouseDownStickerId = null;\n        }\n        this.setState({ sticker });\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateStickerPreview',\n            sticker\n        });\n        this.loadPreviewContent(stickerId);\n    };\n\n    handleMouseDown = event => {\n        const stickerId = Number(event.currentTarget.dataset.stickerId);\n        const sticker = this.getSticker(stickerId);\n        if (!sticker) return;\n\n        this.mouseDownStickerId = stickerId;\n        const now = Date.now();\n\n        this.setState({ sticker, timestamp: now, showPreview: false, cancelSend: false });\n        setTimeout(() => {\n            const { timestamp } = this.state;\n            if (timestamp === now) {\n                this.setState({ showPreview: true, cancelSend: true });\n                TdLibController.clientUpdate({\n                    '@type': 'clientUpdateStickerPreview',\n                    sticker\n                });\n            }\n        }, 500);\n\n        this.loadPreviewContent(stickerId);\n\n        this.mouseDown = true;\n        document.addEventListener('mouseup', this.handleMouseUp);\n\n        event.preventDefault();\n        event.stopPropagation();\n        return false;\n    };\n\n    handleMouseUp = () => {\n        const sticker = null;\n        this.setState({ sticker, timestamp: 0, showPreview: false });\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateStickerPreview',\n            sticker\n        });\n        this.mouseDown = false;\n        document.removeEventListener('mouseup', this.handleMouseUp);\n    };\n\n    getItems = hint => {\n        const items = [];\n        if (!hint) return items;\n\n        const dict = new Map();\n        const { stickers, foundStickers } = hint;\n        if (stickers) {\n            stickers.stickers.forEach(x => {\n                items.push(x);\n                dict.set(x.sticker.id, x.sticker.id);\n            });\n        }\n        if (foundStickers) {\n            foundStickers.stickers.forEach(x => {\n                if (!dict.has(x.sticker.id)) {\n                    items.push(x);\n                    dict.set(x.sticker.id, x.sticker.id);\n                }\n            });\n        }\n\n        return items;\n    };\n\n    getSticker(stickerId) {\n        const { items } = this.state;\n\n        const stickerIndex = items.findIndex(x => x.sticker.id === stickerId);\n        return stickerIndex !== -1 ? items[stickerIndex] : null;\n    }\n\n    render() {\n        const { classes } = this.props;\n        const { hint, items, sticker, showPreview } = this.state;\n        if (!hint) return null;\n        if (!items) return null;\n        if (!items.length) return null;\n\n        const controls = items.map(x => (\n            <div\n                className='sticker-set-dialog-item'\n                key={x.sticker.id}\n                data-sticker-id={x.sticker.id}\n                style={{ width: STICKER_HINT_DISPLAY_SIZE, height: STICKER_HINT_DISPLAY_SIZE }}\n                onClick={() => this.handleSend(x)}\n                onMouseEnter={this.handleMouseEnter}\n                onMouseDown={this.handleMouseDown}>\n                <Sticker\n                    key={x.sticker.id}\n                    className='sticker-set-dialog-item-sticker'\n                    sticker={x}\n                    autoplay={false}\n                    blur={false}\n                    displaySize={STICKER_SMALL_DISPLAY_SIZE}\n                    preview\n                    source={StickerSourceEnum.HINTS}\n                />\n            </div>\n        ));\n\n        return (\n            <div ref={this.hintsRef} className={classNames('stickers-hint', classes.borderColor, classes.root)}>\n                {controls}\n                {Boolean(sticker) && showPreview && <StickerPreview sticker={sticker} />}\n            </div>\n        );\n    }\n}\n\nexport default withStyles(styles)(StickersHint);\n"]},"metadata":{},"sourceType":"module"}