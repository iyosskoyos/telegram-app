{"ast":null,"code":"import _regeneratorRuntime from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/inherits\";/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */import React from'react';import classNames from'classnames';import{compose}from'recompose';import withStyles from'@material-ui/core/styles/withStyles';import{withTranslation}from'react-i18next';import Button from'@material-ui/core/Button';import Dialog from'@material-ui/core/Dialog';import DialogActions from'@material-ui/core/DialogActions';import DialogContent from'@material-ui/core/DialogContent';import DialogContentText from'@material-ui/core/DialogContentText';import DialogTitle from'@material-ui/core/DialogTitle';import FormControlLabel from'@material-ui/core/FormControlLabel';import Checkbox from'@material-ui/core/Checkbox/';import MenuItem from'@material-ui/core/MenuItem';import MenuList from'@material-ui/core/MenuList';import Popover from'@material-ui/core/Popover';import{PHOTO_SIZE,PHOTO_THUMBNAIL_SIZE,THUMBNAIL_BLURRED_SIZE_90}from'../../../Constants';import{forwardMessages,openChat}from'../../../Actions/Client';import{getFileSize,getSrc}from'../../../Utils/File';import{getDurationString,getSize}from'../../../Utils/Common';import{getChatShortTitle,isPrivateChat}from'../../../Utils/Chat';import{isBlurredThumbnail}from'../../../Utils/Media';import FileStore from'../../../Stores/FileStore';import MessageStore from'../../../Stores/MessageStore';import TdLibController from'../../../Controllers/TdLibController';import'./SharedVideo.css';var styles=function styles(theme){return{sharedPhotoContent:{// backgroundColor: theme.palette.type === 'dark' ? theme.palette.background.paper : theme.palette.background.default\n}};};var SharedVideo=/*#__PURE__*/function(_React$Component){_inherits(SharedVideo,_React$Component);function SharedVideo(props){var _this;_classCallCheck(this,SharedVideo);_this=_possibleConstructorReturn(this,_getPrototypeOf(SharedVideo).call(this,props));_this.onClientUpdateVideoThumbnailBlob=function(update){var thumbnail=_this.props.video.thumbnail;var fileId=update.fileId;if(!thumbnail)return;if(thumbnail.photo&&thumbnail.photo.id===fileId){_this.forceUpdate();}};_this.handleOpenMessage=function(event){_this.handleCloseContextMenu(event);var _this$props=_this.props,chatId=_this$props.chatId,messageId=_this$props.messageId;openChat(chatId,messageId);};_this.handleForward=function(event){_this.handleCloseContextMenu(event);var _this$props2=_this.props,chatId=_this$props2.chatId,messageId=_this$props2.messageId;forwardMessages(chatId,[messageId]);};_this.handleDelete=function(event){_this.handleCloseContextMenu(event);var _this$props3=_this.props,chatId=_this$props3.chatId,messageId=_this$props3.messageId;var message=MessageStore.get(chatId,messageId);if(!message)return null;var can_be_deleted_for_all_users=message.can_be_deleted_for_all_users;_this.setState({openDeleteDialog:true,canBeDeletedForAllUsers:can_be_deleted_for_all_users,revoke:can_be_deleted_for_all_users});};_this.handleContextMenu=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var contextMenu,left,top;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(event){event.preventDefault();event.stopPropagation();}contextMenu=_this.state.contextMenu;if(contextMenu){_this.setState({contextMenu:false});}else{left=event.clientX;top=event.clientY;_this.setState({contextMenu:true,left:left,top:top});}case 3:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.handleCloseContextMenu=function(event){if(event){event.stopPropagation();}_this.setState({contextMenu:false});};_this.handleRevokeChange=function(){_this.setState({revoke:!_this.state.revoke});};_this.handleCloseDelete=function(){_this.setState({openDeleteDialog:false});};_this.handleDeleteContinue=function(){var _this$props4=_this.props,chatId=_this$props4.chatId,messageId=_this$props4.messageId;var revoke=_this.state.revoke;_this.handleCloseDelete();TdLibController.send({'@type':'deleteMessages',chat_id:chatId,message_ids:[messageId],revoke:revoke});};_this.state={contextMenu:false,left:0,top:0,openDeleteDialog:false,revoke:false};return _this;}_createClass(SharedVideo,[{key:\"componentDidMount\",value:function componentDidMount(){FileStore.on('clientUpdateVideoThumbnailBlob',this.onClientUpdateVideoThumbnailBlob);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){FileStore.removeListener('clientUpdateVideoThumbnailBlob',this.onClientUpdateVideoThumbnailBlob);}},{key:\"render\",value:function render(){var _this$props5=this.props,chatId=_this$props5.chatId,messageId=_this$props5.messageId,classes=_this$props5.classes,openMedia=_this$props5.openMedia,style=_this$props5.style,showOpenMessage=_this$props5.showOpenMessage,t=_this$props5.t;var _this$props$video=this.props.video,thumbnail=_this$props$video.thumbnail,video=_this$props$video.video,width=_this$props$video.width,height=_this$props$video.height,duration=_this$props$video.duration;var _this$state=this.state,contextMenu=_this$state.contextMenu,left=_this$state.left,top=_this$state.top,openDeleteDialog=_this$state.openDeleteDialog,revoke=_this$state.revoke;var message=MessageStore.get(chatId,messageId);if(!message)return null;var can_be_forwarded=message.can_be_forwarded,can_be_deleted_only_for_self=message.can_be_deleted_only_for_self,can_be_deleted_for_all_users=message.can_be_deleted_for_all_users;var count=1;var thumbSrc=getSrc(thumbnail?thumbnail.photo:null);var isBlurred=isBlurredThumbnail(thumbnail,THUMBNAIL_BLURRED_SIZE_90);return React.createElement(\"div\",{className:\"shared-photo\",style:style,onClick:openMedia,onContextMenu:this.handleContextMenu},React.createElement(\"div\",{className:\"shared-video-wrapper\"},React.createElement(\"div\",{className:classNames('shared-video-content',{'media-blurred':isBlurred}),style:{backgroundImage:\"url(\".concat(thumbSrc,\")\")}}),React.createElement(\"div\",{className:\"shared-video-meta\"},getDurationString(duration))),React.createElement(Popover,{open:contextMenu,onClose:this.handleCloseContextMenu,anchorReference:\"anchorPosition\",anchorPosition:{top:top,left:left},anchorOrigin:{vertical:'bottom',horizontal:'right'},transformOrigin:{vertical:'top',horizontal:'left'},onMouseDown:function onMouseDown(e){return e.stopPropagation();},onClick:function onClick(e){return e.stopPropagation();}},React.createElement(MenuList,{classes:{root:classes.menuListRoot}},showOpenMessage&&React.createElement(MenuItem,{onClick:this.handleOpenMessage},t('GoToMessage')),can_be_forwarded&&React.createElement(MenuItem,{onClick:this.handleForward},t('Forward')),(can_be_deleted_only_for_self||can_be_deleted_for_all_users)&&React.createElement(MenuItem,{onClick:this.handleDelete},t('Delete')))),React.createElement(Dialog,{transitionDuration:0,open:openDeleteDialog,onClose:this.handleCloseDelete,\"aria-labelledby\":\"delete-dialog-title\",onClick:function onClick(e){return e.stopPropagation();}},React.createElement(DialogTitle,{id:\"delete-dialog-title\"},\"Confirm\"),React.createElement(DialogContent,null,React.createElement(DialogContentText,null,count===1?'Are you sure you want to delete 1 message?':\"Are you sure you want to delete \".concat(count,\" messages?\")),can_be_deleted_for_all_users&&React.createElement(FormControlLabel,{control:React.createElement(Checkbox,{checked:revoke,onChange:this.handleRevokeChange,color:\"primary\"}),label:isPrivateChat(chatId)?\"Delete for \".concat(getChatShortTitle(chatId)):'Delete for all'})),React.createElement(DialogActions,null,React.createElement(Button,{onClick:this.handleCloseDelete,color:\"primary\"},\"Cancel\"),React.createElement(Button,{onClick:this.handleDeleteContinue,color:\"primary\"},\"Ok\"))));}}]);return SharedVideo;}(React.Component);SharedVideo.defaultProps={size:PHOTO_SIZE,thumbnailSize:PHOTO_THUMBNAIL_SIZE};var enhance=compose(withStyles(styles,{withTheme:true}),withTranslation());export default enhance(SharedVideo);","map":{"version":3,"sources":["/home/me-admin/Downloads/my-app/src/Components/Tile/SharedMedia/SharedVideo.js"],"names":["React","classNames","compose","withStyles","withTranslation","Button","Dialog","DialogActions","DialogContent","DialogContentText","DialogTitle","FormControlLabel","Checkbox","MenuItem","MenuList","Popover","PHOTO_SIZE","PHOTO_THUMBNAIL_SIZE","THUMBNAIL_BLURRED_SIZE_90","forwardMessages","openChat","getFileSize","getSrc","getDurationString","getSize","getChatShortTitle","isPrivateChat","isBlurredThumbnail","FileStore","MessageStore","TdLibController","styles","theme","sharedPhotoContent","SharedVideo","props","onClientUpdateVideoThumbnailBlob","update","thumbnail","video","fileId","photo","id","forceUpdate","handleOpenMessage","event","handleCloseContextMenu","chatId","messageId","handleForward","handleDelete","message","get","can_be_deleted_for_all_users","setState","openDeleteDialog","canBeDeletedForAllUsers","revoke","handleContextMenu","preventDefault","stopPropagation","contextMenu","state","left","clientX","top","clientY","handleRevokeChange","handleCloseDelete","handleDeleteContinue","send","chat_id","message_ids","on","removeListener","classes","openMedia","style","showOpenMessage","t","width","height","duration","can_be_forwarded","can_be_deleted_only_for_self","count","thumbSrc","isBlurred","backgroundImage","vertical","horizontal","e","root","menuListRoot","Component","defaultProps","size","thumbnailSize","enhance","withTheme"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { compose } from 'recompose';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport { withTranslation } from 'react-i18next';\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport Checkbox from '@material-ui/core/Checkbox/';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport MenuList from '@material-ui/core/MenuList';\nimport Popover from '@material-ui/core/Popover';\nimport { PHOTO_SIZE, PHOTO_THUMBNAIL_SIZE, THUMBNAIL_BLURRED_SIZE_90 } from '../../../Constants';\nimport { forwardMessages, openChat } from '../../../Actions/Client';\nimport { getFileSize, getSrc } from '../../../Utils/File';\nimport { getDurationString, getSize } from '../../../Utils/Common';\nimport { getChatShortTitle, isPrivateChat } from '../../../Utils/Chat';\nimport { isBlurredThumbnail } from '../../../Utils/Media';\nimport FileStore from '../../../Stores/FileStore';\nimport MessageStore from '../../../Stores/MessageStore';\nimport TdLibController from '../../../Controllers/TdLibController';\nimport './SharedVideo.css';\n\nconst styles = theme => ({\n    sharedPhotoContent: {\n        // backgroundColor: theme.palette.type === 'dark' ? theme.palette.background.paper : theme.palette.background.default\n    }\n});\n\nclass SharedVideo extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            contextMenu: false,\n            left: 0,\n            top: 0,\n            openDeleteDialog: false,\n            revoke: false\n        };\n    }\n\n    componentDidMount() {\n        FileStore.on('clientUpdateVideoThumbnailBlob', this.onClientUpdateVideoThumbnailBlob);\n    }\n\n    componentWillUnmount() {\n        FileStore.removeListener('clientUpdateVideoThumbnailBlob', this.onClientUpdateVideoThumbnailBlob);\n    }\n\n    onClientUpdateVideoThumbnailBlob = update => {\n        const { thumbnail } = this.props.video;\n        const { fileId } = update;\n\n        if (!thumbnail) return;\n\n        if (thumbnail.photo && thumbnail.photo.id === fileId) {\n            this.forceUpdate();\n        }\n    };\n\n    handleOpenMessage = event => {\n        this.handleCloseContextMenu(event);\n\n        const { chatId, messageId } = this.props;\n\n        openChat(chatId, messageId);\n    };\n\n    handleForward = event => {\n        this.handleCloseContextMenu(event);\n\n        const { chatId, messageId } = this.props;\n\n        forwardMessages(chatId, [messageId]);\n    };\n\n    handleDelete = event => {\n        this.handleCloseContextMenu(event);\n\n        const { chatId, messageId } = this.props;\n\n        const message = MessageStore.get(chatId, messageId);\n        if (!message) return null;\n\n        const { can_be_deleted_for_all_users } = message;\n\n        this.setState({\n            openDeleteDialog: true,\n            canBeDeletedForAllUsers: can_be_deleted_for_all_users,\n            revoke: can_be_deleted_for_all_users\n        });\n    };\n\n    handleContextMenu = async event => {\n        if (event) {\n            event.preventDefault();\n            event.stopPropagation();\n        }\n        const { contextMenu } = this.state;\n\n        if (contextMenu) {\n            this.setState({ contextMenu: false });\n        } else {\n            const left = event.clientX;\n            const top = event.clientY;\n\n            this.setState({\n                contextMenu: true,\n                left,\n                top\n            });\n        }\n    };\n\n    handleCloseContextMenu = event => {\n        if (event) {\n            event.stopPropagation();\n        }\n\n        this.setState({ contextMenu: false });\n    };\n\n    handleRevokeChange = () => {\n        this.setState({ revoke: !this.state.revoke });\n    };\n\n    handleCloseDelete = () => {\n        this.setState({ openDeleteDialog: false });\n    };\n\n    handleDeleteContinue = () => {\n        const { chatId, messageId } = this.props;\n        const { revoke } = this.state;\n\n        this.handleCloseDelete();\n\n        TdLibController.send({\n            '@type': 'deleteMessages',\n            chat_id: chatId,\n            message_ids: [messageId],\n            revoke: revoke\n        });\n    };\n\n    render() {\n        const { chatId, messageId, classes, openMedia, style, showOpenMessage, t } = this.props;\n        const { thumbnail, video, width, height, duration } = this.props.video;\n        const { contextMenu, left, top, openDeleteDialog, revoke } = this.state;\n\n        const message = MessageStore.get(chatId, messageId);\n        if (!message) return null;\n\n        const { can_be_forwarded, can_be_deleted_only_for_self, can_be_deleted_for_all_users } = message;\n        const count = 1;\n\n        const thumbSrc = getSrc(thumbnail ? thumbnail.photo : null);\n        const isBlurred = isBlurredThumbnail(thumbnail, THUMBNAIL_BLURRED_SIZE_90);\n\n        return (\n            <div className='shared-photo' style={style} onClick={openMedia} onContextMenu={this.handleContextMenu}>\n                <div className='shared-video-wrapper'>\n                    <div\n                        className={classNames('shared-video-content', { 'media-blurred': isBlurred })}\n                        style={{ backgroundImage: `url(${thumbSrc})` }}\n                    />\n                    <div className='shared-video-meta'>{getDurationString(duration)}</div>\n                </div>\n                <Popover\n                    open={contextMenu}\n                    onClose={this.handleCloseContextMenu}\n                    anchorReference='anchorPosition'\n                    anchorPosition={{ top, left }}\n                    anchorOrigin={{\n                        vertical: 'bottom',\n                        horizontal: 'right'\n                    }}\n                    transformOrigin={{\n                        vertical: 'top',\n                        horizontal: 'left'\n                    }}\n                    onMouseDown={e => e.stopPropagation()}\n                    onClick={e => e.stopPropagation()}>\n                    <MenuList classes={{ root: classes.menuListRoot }}>\n                        {showOpenMessage && <MenuItem onClick={this.handleOpenMessage}>{t('GoToMessage')}</MenuItem>}\n                        {can_be_forwarded && <MenuItem onClick={this.handleForward}>{t('Forward')}</MenuItem>}\n                        {(can_be_deleted_only_for_self || can_be_deleted_for_all_users) && (\n                            <MenuItem onClick={this.handleDelete}>{t('Delete')}</MenuItem>\n                        )}\n                    </MenuList>\n                </Popover>\n                <Dialog\n                    transitionDuration={0}\n                    open={openDeleteDialog}\n                    onClose={this.handleCloseDelete}\n                    aria-labelledby='delete-dialog-title'\n                    onClick={e => e.stopPropagation()}>\n                    <DialogTitle id='delete-dialog-title'>Confirm</DialogTitle>\n                    <DialogContent>\n                        <DialogContentText>\n                            {count === 1\n                                ? 'Are you sure you want to delete 1 message?'\n                                : `Are you sure you want to delete ${count} messages?`}\n                        </DialogContentText>\n                        {can_be_deleted_for_all_users && (\n                            <FormControlLabel\n                                control={\n                                    <Checkbox checked={revoke} onChange={this.handleRevokeChange} color='primary' />\n                                }\n                                label={\n                                    isPrivateChat(chatId) ? `Delete for ${getChatShortTitle(chatId)}` : 'Delete for all'\n                                }\n                            />\n                        )}\n                    </DialogContent>\n                    <DialogActions>\n                        <Button onClick={this.handleCloseDelete} color='primary'>\n                            Cancel\n                        </Button>\n                        <Button onClick={this.handleDeleteContinue} color='primary'>\n                            Ok\n                        </Button>\n                    </DialogActions>\n                </Dialog>\n            </div>\n        );\n    }\n}\n\nSharedVideo.propTypes = {\n    chatId: PropTypes.number.isRequired,\n    messageId: PropTypes.number.isRequired,\n    video: PropTypes.object.isRequired,\n    showOpenMessage: PropTypes.bool.isRequired,\n    openMedia: PropTypes.func,\n\n    size: PropTypes.number,\n    thumbnailSize: PropTypes.number,\n    style: PropTypes.object\n};\n\nSharedVideo.defaultProps = {\n    size: PHOTO_SIZE,\n    thumbnailSize: PHOTO_THUMBNAIL_SIZE\n};\n\nconst enhance = compose(\n    withStyles(styles, { withTheme: true }),\n    withTranslation()\n);\n\nexport default enhance(SharedVideo);\n"]},"metadata":{},"sourceType":"module"}