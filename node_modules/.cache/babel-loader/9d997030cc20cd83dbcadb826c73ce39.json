{"ast":null,"code":"import _classCallCheck from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _defineProperty from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */import React from'react';import classNames from'classnames';import{compose}from'recompose';import{withTranslation}from'react-i18next';import withStyles from'@material-ui/core/styles/withStyles';import PlayArrowIcon from'@material-ui/icons/PlayArrow';import PauseIcon from'@material-ui/icons/Pause';import SkipNextIcon from'@material-ui/icons/SkipNext';import SkipPreviousIcon from'@material-ui/icons/SkipPrevious';import CloseIcon from'@material-ui/icons/Close';import IconButton from'@material-ui/core/IconButton';import VolumeButton from'../Player/VolumeButton';import RepeatButton from'../Player/RepeatButton';import ShuffleButton from'../Player/ShuffleButton';import PlaybackRateButton from'./PlaybackRateButton';import Time from'../Player/Time';import Playlist from'../Player/Playlist';import{borderStyle}from'../Theme';import{getSrc}from'../../Utils/File';import{openChat}from'../../Actions/Client';import{getDurationString}from'../../Utils/Common';import{getDate,getDateHint,getMediaTitle,hasAudio}from'../../Utils/Message';import{PLAYER_PLAYBACKRATE_FAST,PLAYER_PLAYBACKRATE_NORMAL,PLAYER_STARTTIME}from'../../Constants';import PlayerStore from'../../Stores/PlayerStore';import FileStore from'../../Stores/FileStore';import ApplicationStore from'../../Stores/ApplicationStore';import TdLibController from'../../Controllers/TdLibController';import'./HeaderPlayer.css';var styles=function styles(theme){return _objectSpread({iconButton:{padding:4}},borderStyle(theme));};var HeaderPlayer=/*#__PURE__*/function(_React$Component){_inherits(HeaderPlayer,_React$Component);function HeaderPlayer(props){var _this;_classCallCheck(this,HeaderPlayer);_this=_possibleConstructorReturn(this,_getPrototypeOf(HeaderPlayer).call(this,props));_this.onClientUpdateMediaPlaybackRate=function(update){var playbackRate=update.playbackRate;var player=_this.videoRef.current;if(!player)return;player.playbackRate=playbackRate;};_this.onClientUpdateMediaVolume=function(update){var volume=update.volume;var player=_this.videoRef.current;if(!player)return;player.volume=volume;};_this.onClientUpdateMediaViewerContent=function(update){_this.playingMediaViewer=Boolean(ApplicationStore.mediaViewerContent);};_this.onClientUpdateMediaViewerEnded=function(update){_this.playingMediaViewer=false;};_this.onClientUpdateMediaViewerPause=function(update){_this.playingMediaViewer=false;};_this.onClientUpdateMediaViewerPlay=function(update){_this.playingMediaViewer=true;var player=_this.videoRef.current;if(!player)return;player.pause();};_this.startPlayingFile=function(file,message){var chat_id=message.chat_id,id=message.id;_this.setState({src:_this.getMediaSrc(message)},function(){var player=_this.videoRef.current;if(player){if(_this.playingMediaViewer){player.pause();TdLibController.clientUpdate({'@type':'clientUpdateMediaPause',chatId:chat_id,messageId:id});}}});};_this.onClientUpdateMediaBlob=function(update){var chatId=update.chatId,messageId=update.messageId;var message=_this.state.message;if(!message)return;var chat_id=message.chat_id,id=message.id,content=message.content;if(!content)return;if(chatId!==chat_id||messageId!==id)return;switch(content['@type']){case'messageText':{var web_page=content.web_page;if(web_page){var audio=web_page.audio,voice_note=web_page.voice_note,video_note=web_page.video_note;if(audio){var file=audio.audio;if(file){_this.startPlayingFile(file,message);}}if(voice_note){var voice=voice_note.voice;if(voice){_this.startPlayingFile(voice,message);}}if(video_note){var video=video_note.video;if(video){_this.startPlayingFile(video,message);}}}break;}case'messageAudio':{var _audio=content.audio;if(_audio){var _file=_audio.audio;if(_file){_this.startPlayingFile(_file,message);}}break;}case'messageVoiceNote':{var _voice_note=content.voice_note;if(_voice_note){var _voice=_voice_note.voice;if(_voice){_this.startPlayingFile(_voice,message);}}break;}case'messageVideoNote':{var _video_note=content.video_note;if(_video_note){var _video=_video_note.video;if(_video){_this.startPlayingFile(_video,message);}}break;}}};_this.onClientUpdateMediaPlaylist=function(update){var playlist=update.playlist;var chatId=playlist.chatId,messageId=playlist.messageId;var message=_this.state.message;if(message&&message.chat_id===chatId&&message.id===messageId){_this.setState({playlist:playlist});}};_this.onClientUpdateMediaClose=function(update){_this.setState({message:null,playlist:null,playing:false,src:null});};_this.onClientUpdateMediaActive=function(update){var chatId=update.chatId,messageId=update.messageId;var _this$state=_this.state,message=_this$state.message,src=_this$state.src;if(message&&message.chat_id===chatId&&message.id===messageId){if(src){var player=_this.videoRef.current;if(player){if(player.paused){player.play();}else{player.pause();}}}}else{var _src=_this.getMediaSrc(PlayerStore.message);var playing=Boolean(_src);var playlist=PlayerStore.playlist;_this.setState({message:PlayerStore.message,playlist:PlayerStore.playlist,playing:playing,src:_src},function(){var player=_this.videoRef.current;if(player){player.currentTime=_this.startTime;if(_this.playingMediaViewer){player.pause();//this.handleVideoPause();\n}else if(player.paused){player.play();}}});}};_this.handlePrev=function(){TdLibController.clientUpdate({'@type':'clientUpdateMediaPrev'});};_this.handlePlay=function(){var message=_this.state.message;if(!message)return;TdLibController.clientUpdate({'@type':'clientUpdateMediaActive',chatId:message.chat_id,messageId:message.id});};_this.handleNext=function(){TdLibController.clientUpdate({'@type':'clientUpdateMediaNext'});};_this.getMediaSrc=function(message){if(message){var content=message.content;if(content){var audio=content.audio,voice_note=content.voice_note,video_note=content.video_note,web_page=content.web_page;if(audio){var file=audio.audio;if(file){return getSrc(file);}}if(voice_note){var voice=voice_note.voice;if(voice){return getSrc(voice);}}if(video_note){var video=video_note.video;if(video){return getSrc(video);}}if(web_page){if(web_page.audio){var _file2=web_page.audio.audio;if(_file2){return getSrc(_file2);}}if(web_page.voice_note){var _voice2=web_page.voice_note.voice;if(_voice2){return getSrc(_voice2);}}if(web_page.video_note){var _video2=web_page.video_note.video;if(_video2){return getSrc(_video2);}}}}}return'';};_this.handleEnded=function(){var moveNext=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var message=_this.state.message;if(!message)return;TdLibController.clientUpdate({'@type':'clientUpdateMediaEnding',chatId:message.chat_id,messageId:message.id,moveNext:moveNext});_this.setState({//playing: false,\n//message: null,\n//src: null\n},function(){TdLibController.clientUpdate({'@type':'clientUpdateMediaEnd',chatId:message.chat_id,messageId:message.id,moveNext:moveNext});});};_this.handleVideoEnded=function(){_this.handleEnded(true);};_this.handleClose=function(){var player=_this.videoRef.current;if(player){player.pause();}_this.handleEnded(false);};_this.handleTimeUpdate=function(){var message=_this.state.message;if(!message)return;var player=_this.videoRef.current;if(!player)return;_this.setState({currentTime:player.currentTime,currentTimeString:getDurationString(Math.floor(player.currentTime||0))});TdLibController.clientUpdate({'@type':'clientUpdateMediaTime',chatId:message.chat_id,messageId:message.id,duration:player.duration,currentTime:player.currentTime,timestamp:Date.now()});};_this.handleCanPlay=function(){var message=_this.state.message;if(!message)return;var player=_this.videoRef.current;if(!player)return;var playbackRate=PlayerStore.playbackRate,volume=PlayerStore.volume;var chat_id=message.chat_id,id=message.id;var audio=hasAudio(chat_id,id);player.playbackRate=audio?PLAYER_PLAYBACKRATE_NORMAL:playbackRate;player.volume=volume;player.muted=false;if(audio){return;}var stream=null;if('captureStream'in player){stream=player.captureStream();}else if('mozCaptureStream'in player){stream=player.mozCaptureStream();}if(!stream){return;}TdLibController.clientUpdate({'@type':'clientUpdateMediaCaptureStream',chatId:message.chat_id,messageId:message.id,stream:stream});};_this.handleVideoPlay=function(){var message=_this.state.message;if(!message)return;_this.setState({playing:true});var player=_this.videoRef.current;if(!player)return;TdLibController.clientUpdate({'@type':'clientUpdateMediaPlay',chatId:message.chat_id,messageId:message.id,currentTime:player.currentTime,duration:player.duration,timestamp:Date.now()});};_this.handleVideoPause=function(){var message=_this.state.message;if(!message)return;_this.setState({playing:false});var player=_this.videoRef.current;if(!player)return;TdLibController.clientUpdate({'@type':'clientUpdateMediaPause',chatId:message.chat_id,messageId:message.id});};_this.handlePlaybackRate=function(){var playbackRate=_this.state.playbackRate;var nextPlaybackRate=playbackRate===PLAYER_PLAYBACKRATE_NORMAL?PLAYER_PLAYBACKRATE_FAST:PLAYER_PLAYBACKRATE_NORMAL;_this.setState({playbackRate:nextPlaybackRate},function(){var player=_this.videoRef.current;if(!player)return;player.playbackRate=nextPlaybackRate;});TdLibController.clientUpdate({'@type':'clientUpdateMediaPlaybackRate',playbackRate:nextPlaybackRate});};_this.hasPrev=function(message,playlist){if(!message)return false;if(!playlist||!playlist.messages.length)return false;var chat_id=message.chat_id,id=message.id;var index=playlist.messages.findIndex(function(x){return x.chat_id===chat_id&&x.id===id;});if(index===-1)return false;return index+1<playlist.messages.length;};_this.hasNext=function(message,playlist){if(!message)return false;if(!playlist||!playlist.messages.length)return false;var chat_id=message.chat_id,id=message.id;var index=playlist.messages.findIndex(function(x){return x.chat_id===chat_id&&x.id===id;});if(index===-1)return false;return index-1>=0;};_this.handleTitleMouseEnter=function(){TdLibController.clientUpdate({'@type':'clientUpdateMediaTitleMouseOver',over:true});};_this.handleTitleMouseLeave=function(){TdLibController.clientUpdate({'@type':'clientUpdateMediaTitleMouseOver',over:false});};_this.handleTitleClick=function(){var message=_this.state.message;if(!message)return;openChat(message.chat_id,message.id);};_this.videoRef=React.createRef();var _message=PlayerStore.message,_playlist=PlayerStore.playlist;_this.startTime=PLAYER_STARTTIME;_this.state={currentTime:0,currentTimeString:getDurationString(0),message:_message,playlist:_playlist,playing:false,src:_this.getMediaSrc(_message)};return _this;}_createClass(HeaderPlayer,[{key:\"shouldComponentUpdate\",value:function shouldComponentUpdate(nextProps,nextState,nextContext){var theme=this.props.theme;var _this$state2=this.state,message=_this$state2.message,playlist=_this$state2.playlist,src=_this$state2.src,playing=_this$state2.playing;if(nextProps.theme!==theme){return true;}if(nextState.message!==message){return true;}if(nextState.playlist!==playlist){return true;}if(nextState.src!==src){return true;}if(nextState.playing!==playing){return true;}return false;}},{key:\"componentDidMount\",value:function componentDidMount(){FileStore.on('clientUpdateVoiceNoteBlob',this.onClientUpdateMediaBlob);FileStore.on('clientUpdateVideoNoteBlob',this.onClientUpdateMediaBlob);FileStore.on('clientUpdateAudioBlob',this.onClientUpdateMediaBlob);PlayerStore.on('clientUpdateMediaActive',this.onClientUpdateMediaActive);PlayerStore.on('clientUpdateMediaClose',this.onClientUpdateMediaClose);PlayerStore.on('clientUpdateMediaPlaylist',this.onClientUpdateMediaPlaylist);PlayerStore.on('clientUpdateMediaViewerPlay',this.onClientUpdateMediaViewerPlay);PlayerStore.on('clientUpdateMediaViewerPause',this.onClientUpdateMediaViewerPause);PlayerStore.on('clientUpdateMediaViewerEnded',this.onClientUpdateMediaViewerEnded);PlayerStore.on('clientUpdateMediaVolume',this.onClientUpdateMediaVolume);PlayerStore.on('clientUpdateMediaPlaybackRate',this.onClientUpdateMediaPlaybackRate);ApplicationStore.on('clientUpdateMediaViewerContent',this.onClientUpdateMediaViewerContent);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){FileStore.removeListener('clientUpdateVoiceNoteBlob',this.onClientUpdateMediaBlob);FileStore.removeListener('clientUpdateVideoNoteBlob',this.onClientUpdateMediaBlob);FileStore.removeListener('clientUpdateAudioBlob',this.onClientUpdateMediaBlob);PlayerStore.removeListener('clientUpdateMediaActive',this.onClientUpdateMediaActive);PlayerStore.removeListener('clientUpdateMediaClose',this.onClientUpdateMediaClose);PlayerStore.removeListener('clientUpdateMediaPlaylist',this.onClientUpdateMediaPlaylist);PlayerStore.removeListener('clientUpdateMediaViewerPlay',this.onClientUpdateMediaViewerPlay);PlayerStore.removeListener('clientUpdateMediaViewerPause',this.onClientUpdateMediaViewerPause);PlayerStore.removeListener('clientUpdateMediaViewerEnded',this.onClientUpdateMediaViewerEnded);PlayerStore.removeListener('clientUpdateMediaVolume',this.onClientUpdateMediaVolume);PlayerStore.removeListener('clientUpdateMediaPlaybackRate',this.onClientUpdateMediaPlaybackRate);ApplicationStore.removeListener('clientUpdateMediaViewerContent',this.onClientUpdateMediaViewerContent);}},{key:\"render\",value:function render(){var classes=this.props.classes;var _this$state3=this.state,playing=_this$state3.playing,message=_this$state3.message,playlist=_this$state3.playlist,src=_this$state3.src;var audio=false;if(message){var chat_id=message.chat_id,id=message.id;audio=hasAudio(chat_id,id);}var date=message?message.date:null;var title=getMediaTitle(message);var dateHintStr=getDateHint(date);var dateStr=getDate(date);var showDate=!audio;var showPlaybackRate=!audio;var showRepeat=audio;var showShuffle=audio;var hasPrev=this.hasPrev(message,playlist);var hasNext=this.hasNext(message,playlist);return React.createElement(React.Fragment,null,React.createElement(\"video\",{className:\"header-player-video\",ref:this.videoRef,src:src,autoPlay:true,controls:false,width:44,height:44,onCanPlay:this.handleCanPlay,onPlay:this.handleVideoPlay,onPause:this.handleVideoPause,onTimeUpdate:this.handleTimeUpdate,onEnded:this.handleVideoEnded}),message&&React.createElement(\"div\",{className:classNames(classes.borderColor,'header-player')},React.createElement(IconButton,{disabled:!hasPrev,className:classes.iconButton,color:\"primary\",onClick:this.handlePrev},React.createElement(SkipPreviousIcon,{fontSize:\"small\"})),React.createElement(IconButton,{className:classes.iconButton,color:\"primary\",disabled:!src,onClick:this.handlePlay},playing?React.createElement(PauseIcon,null):React.createElement(PlayArrowIcon,null)),React.createElement(IconButton,{disabled:!hasNext,className:classes.iconButton,color:\"primary\",onClick:this.handleNext},React.createElement(SkipNextIcon,{fontSize:\"small\"})),React.createElement(Playlist,null),React.createElement(\"div\",{className:\"header-player-content\",onMouseEnter:this.handleTitleMouseEnter,onMouseLeave:this.handleTitleMouseLeave,onClick:this.handleTitleClick},React.createElement(\"div\",{className:\"header-player-title\"},title,showDate&&React.createElement(\"span\",{title:dateHintStr},\"\\xA0\",dateStr)),\"\\xA0\",React.createElement(Time,null)),React.createElement(VolumeButton,null),showPlaybackRate&&React.createElement(PlaybackRateButton,null),showRepeat&&React.createElement(RepeatButton,null),showShuffle&&React.createElement(ShuffleButton,null),React.createElement(IconButton,{className:classes.iconButton,onClick:this.handleClose},React.createElement(CloseIcon,{fontSize:\"small\"}))));}}]);return HeaderPlayer;}(React.Component);var enhance=compose(withTranslation(),withStyles(styles,{withTheme:true}));export default enhance(HeaderPlayer);","map":{"version":3,"sources":["/home/me-admin/Downloads/my-app/src/Components/Player/HeaderPlayer.js"],"names":["React","classNames","compose","withTranslation","withStyles","PlayArrowIcon","PauseIcon","SkipNextIcon","SkipPreviousIcon","CloseIcon","IconButton","VolumeButton","RepeatButton","ShuffleButton","PlaybackRateButton","Time","Playlist","borderStyle","getSrc","openChat","getDurationString","getDate","getDateHint","getMediaTitle","hasAudio","PLAYER_PLAYBACKRATE_FAST","PLAYER_PLAYBACKRATE_NORMAL","PLAYER_STARTTIME","PlayerStore","FileStore","ApplicationStore","TdLibController","styles","theme","iconButton","padding","HeaderPlayer","props","onClientUpdateMediaPlaybackRate","update","playbackRate","player","videoRef","current","onClientUpdateMediaVolume","volume","onClientUpdateMediaViewerContent","playingMediaViewer","Boolean","mediaViewerContent","onClientUpdateMediaViewerEnded","onClientUpdateMediaViewerPause","onClientUpdateMediaViewerPlay","pause","startPlayingFile","file","message","chat_id","id","setState","src","getMediaSrc","clientUpdate","chatId","messageId","onClientUpdateMediaBlob","state","content","web_page","audio","voice_note","video_note","voice","video","onClientUpdateMediaPlaylist","playlist","onClientUpdateMediaClose","playing","onClientUpdateMediaActive","paused","play","currentTime","startTime","handlePrev","handlePlay","handleNext","handleEnded","moveNext","handleVideoEnded","handleClose","handleTimeUpdate","currentTimeString","Math","floor","duration","timestamp","Date","now","handleCanPlay","muted","stream","captureStream","mozCaptureStream","handleVideoPlay","handleVideoPause","handlePlaybackRate","nextPlaybackRate","hasPrev","messages","length","index","findIndex","x","hasNext","handleTitleMouseEnter","over","handleTitleMouseLeave","handleTitleClick","createRef","nextProps","nextState","nextContext","on","removeListener","classes","date","title","dateHintStr","dateStr","showDate","showPlaybackRate","showRepeat","showShuffle","borderColor","Component","enhance","withTheme"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport classNames from 'classnames';\nimport { compose } from 'recompose';\nimport { withTranslation } from 'react-i18next';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport PlayArrowIcon from '@material-ui/icons/PlayArrow';\nimport PauseIcon from '@material-ui/icons/Pause';\nimport SkipNextIcon from '@material-ui/icons/SkipNext';\nimport SkipPreviousIcon from '@material-ui/icons/SkipPrevious';\nimport CloseIcon from '@material-ui/icons/Close';\nimport IconButton from '@material-ui/core/IconButton';\nimport VolumeButton from '../Player/VolumeButton';\nimport RepeatButton from '../Player/RepeatButton';\nimport ShuffleButton from '../Player/ShuffleButton';\nimport PlaybackRateButton from './PlaybackRateButton';\nimport Time from '../Player/Time';\nimport Playlist from '../Player/Playlist';\nimport { borderStyle } from '../Theme';\nimport { getSrc } from '../../Utils/File';\nimport { openChat } from '../../Actions/Client';\nimport { getDurationString } from '../../Utils/Common';\nimport { getDate, getDateHint, getMediaTitle, hasAudio } from '../../Utils/Message';\nimport { PLAYER_PLAYBACKRATE_FAST, PLAYER_PLAYBACKRATE_NORMAL, PLAYER_STARTTIME } from '../../Constants';\nimport PlayerStore from '../../Stores/PlayerStore';\nimport FileStore from '../../Stores/FileStore';\nimport ApplicationStore from '../../Stores/ApplicationStore';\nimport TdLibController from '../../Controllers/TdLibController';\nimport './HeaderPlayer.css';\n\nconst styles = theme => ({\n    iconButton: {\n        padding: 4\n    },\n    ...borderStyle(theme)\n});\n\nclass HeaderPlayer extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.videoRef = React.createRef();\n\n        const { message, playlist } = PlayerStore;\n\n        this.startTime = PLAYER_STARTTIME;\n\n        this.state = {\n            currentTime: 0,\n            currentTimeString: getDurationString(0),\n            message: message,\n            playlist: playlist,\n            playing: false,\n            src: this.getMediaSrc(message)\n        };\n    }\n\n    shouldComponentUpdate(nextProps, nextState, nextContext) {\n        const { theme } = this.props;\n        const { message, playlist, src, playing } = this.state;\n\n        if (nextProps.theme !== theme) {\n            return true;\n        }\n\n        if (nextState.message !== message) {\n            return true;\n        }\n\n        if (nextState.playlist !== playlist) {\n            return true;\n        }\n\n        if (nextState.src !== src) {\n            return true;\n        }\n\n        if (nextState.playing !== playing) {\n            return true;\n        }\n\n        return false;\n    }\n\n    componentDidMount() {\n        FileStore.on('clientUpdateVoiceNoteBlob', this.onClientUpdateMediaBlob);\n        FileStore.on('clientUpdateVideoNoteBlob', this.onClientUpdateMediaBlob);\n        FileStore.on('clientUpdateAudioBlob', this.onClientUpdateMediaBlob);\n        PlayerStore.on('clientUpdateMediaActive', this.onClientUpdateMediaActive);\n        PlayerStore.on('clientUpdateMediaClose', this.onClientUpdateMediaClose);\n        PlayerStore.on('clientUpdateMediaPlaylist', this.onClientUpdateMediaPlaylist);\n        PlayerStore.on('clientUpdateMediaViewerPlay', this.onClientUpdateMediaViewerPlay);\n        PlayerStore.on('clientUpdateMediaViewerPause', this.onClientUpdateMediaViewerPause);\n        PlayerStore.on('clientUpdateMediaViewerEnded', this.onClientUpdateMediaViewerEnded);\n        PlayerStore.on('clientUpdateMediaVolume', this.onClientUpdateMediaVolume);\n        PlayerStore.on('clientUpdateMediaPlaybackRate', this.onClientUpdateMediaPlaybackRate);\n\n        ApplicationStore.on('clientUpdateMediaViewerContent', this.onClientUpdateMediaViewerContent);\n    }\n\n    componentWillUnmount() {\n        FileStore.removeListener('clientUpdateVoiceNoteBlob', this.onClientUpdateMediaBlob);\n        FileStore.removeListener('clientUpdateVideoNoteBlob', this.onClientUpdateMediaBlob);\n        FileStore.removeListener('clientUpdateAudioBlob', this.onClientUpdateMediaBlob);\n        PlayerStore.removeListener('clientUpdateMediaActive', this.onClientUpdateMediaActive);\n        PlayerStore.removeListener('clientUpdateMediaClose', this.onClientUpdateMediaClose);\n        PlayerStore.removeListener('clientUpdateMediaPlaylist', this.onClientUpdateMediaPlaylist);\n        PlayerStore.removeListener('clientUpdateMediaViewerPlay', this.onClientUpdateMediaViewerPlay);\n        PlayerStore.removeListener('clientUpdateMediaViewerPause', this.onClientUpdateMediaViewerPause);\n        PlayerStore.removeListener('clientUpdateMediaViewerEnded', this.onClientUpdateMediaViewerEnded);\n        PlayerStore.removeListener('clientUpdateMediaVolume', this.onClientUpdateMediaVolume);\n        PlayerStore.removeListener('clientUpdateMediaPlaybackRate', this.onClientUpdateMediaPlaybackRate);\n\n        ApplicationStore.removeListener('clientUpdateMediaViewerContent', this.onClientUpdateMediaViewerContent);\n    }\n\n    onClientUpdateMediaPlaybackRate = update => {\n        const { playbackRate } = update;\n\n        const player = this.videoRef.current;\n        if (!player) return;\n\n        player.playbackRate = playbackRate;\n    };\n\n    onClientUpdateMediaVolume = update => {\n        const { volume } = update;\n\n        const player = this.videoRef.current;\n        if (!player) return;\n\n        player.volume = volume;\n    };\n\n    onClientUpdateMediaViewerContent = update => {\n        this.playingMediaViewer = Boolean(ApplicationStore.mediaViewerContent);\n    };\n\n    onClientUpdateMediaViewerEnded = update => {\n        this.playingMediaViewer = false;\n    };\n\n    onClientUpdateMediaViewerPause = update => {\n        this.playingMediaViewer = false;\n    };\n\n    onClientUpdateMediaViewerPlay = update => {\n        this.playingMediaViewer = true;\n\n        const player = this.videoRef.current;\n        if (!player) return;\n\n        player.pause();\n    };\n\n    startPlayingFile = (file, message) => {\n        const { chat_id, id } = message;\n\n        this.setState(\n            {\n                src: this.getMediaSrc(message)\n            },\n            () => {\n                const player = this.videoRef.current;\n                if (player) {\n                    if (this.playingMediaViewer) {\n                        player.pause();\n\n                        TdLibController.clientUpdate({\n                            '@type': 'clientUpdateMediaPause',\n                            chatId: chat_id,\n                            messageId: id\n                        });\n                    }\n                }\n            }\n        );\n    };\n\n    onClientUpdateMediaBlob = update => {\n        const { chatId, messageId } = update;\n        const { message } = this.state;\n\n        if (!message) return;\n\n        const { chat_id, id, content } = message;\n        if (!content) return;\n        if (chatId !== chat_id || messageId !== id) return;\n\n        switch (content['@type']) {\n            case 'messageText': {\n                const { web_page } = content;\n                if (web_page) {\n                    const { audio, voice_note, video_note } = web_page;\n\n                    if (audio) {\n                        const file = audio.audio;\n                        if (file) {\n                            this.startPlayingFile(file, message);\n                        }\n                    }\n\n                    if (voice_note) {\n                        const { voice } = voice_note;\n                        if (voice) {\n                            this.startPlayingFile(voice, message);\n                        }\n                    }\n\n                    if (video_note) {\n                        const { video } = video_note;\n                        if (video) {\n                            this.startPlayingFile(video, message);\n                        }\n                    }\n                }\n\n                break;\n            }\n            case 'messageAudio': {\n                const { audio } = content;\n                if (audio) {\n                    const file = audio.audio;\n                    if (file) {\n                        this.startPlayingFile(file, message);\n                    }\n                }\n\n                break;\n            }\n            case 'messageVoiceNote': {\n                const { voice_note } = content;\n                if (voice_note) {\n                    const { voice } = voice_note;\n                    if (voice) {\n                        this.startPlayingFile(voice, message);\n                    }\n                }\n\n                break;\n            }\n            case 'messageVideoNote': {\n                const { video_note } = content;\n                if (video_note) {\n                    const { video } = video_note;\n                    if (video) {\n                        this.startPlayingFile(video, message);\n                    }\n                }\n\n                break;\n            }\n        }\n    };\n\n    onClientUpdateMediaPlaylist = update => {\n        const { playlist } = update;\n        const { chatId, messageId } = playlist;\n        const { message } = this.state;\n\n        if (message && message.chat_id === chatId && message.id === messageId) {\n            this.setState({ playlist: playlist });\n        }\n    };\n\n    onClientUpdateMediaClose = update => {\n        this.setState({\n            message: null,\n            playlist: null,\n            playing: false,\n            src: null\n        });\n    };\n\n    onClientUpdateMediaActive = update => {\n        const { chatId, messageId } = update;\n        const { message, src } = this.state;\n\n        if (message && message.chat_id === chatId && message.id === messageId) {\n            if (src) {\n                const player = this.videoRef.current;\n                if (player) {\n                    if (player.paused) {\n                        player.play();\n                    } else {\n                        player.pause();\n                    }\n                }\n            }\n        } else {\n            const src = this.getMediaSrc(PlayerStore.message);\n            const playing = Boolean(src);\n            const playlist = PlayerStore.playlist;\n            this.setState(\n                {\n                    message: PlayerStore.message,\n                    playlist: PlayerStore.playlist,\n                    playing: playing,\n                    src: src\n                },\n                () => {\n                    const player = this.videoRef.current;\n                    if (player) {\n                        player.currentTime = this.startTime;\n                        if (this.playingMediaViewer) {\n                            player.pause();\n\n                            //this.handleVideoPause();\n                        } else if (player.paused) {\n                            player.play();\n                        }\n                    }\n                }\n            );\n        }\n    };\n\n    handlePrev = () => {\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateMediaPrev'\n        });\n    };\n\n    handlePlay = () => {\n        const { message } = this.state;\n        if (!message) return;\n\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateMediaActive',\n            chatId: message.chat_id,\n            messageId: message.id\n        });\n    };\n\n    handleNext = () => {\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateMediaNext'\n        });\n    };\n\n    getMediaSrc = message => {\n        if (message) {\n            const { content } = message;\n            if (content) {\n                const { audio, voice_note, video_note, web_page } = content;\n\n                if (audio) {\n                    const file = audio.audio;\n                    if (file) {\n                        return getSrc(file);\n                    }\n                }\n\n                if (voice_note) {\n                    const { voice } = voice_note;\n                    if (voice) {\n                        return getSrc(voice);\n                    }\n                }\n\n                if (video_note) {\n                    const { video } = video_note;\n                    if (video) {\n                        return getSrc(video);\n                    }\n                }\n\n                if (web_page) {\n                    if (web_page.audio) {\n                        const file = web_page.audio.audio;\n                        if (file) {\n                            return getSrc(file);\n                        }\n                    }\n\n                    if (web_page.voice_note) {\n                        const { voice } = web_page.voice_note;\n                        if (voice) {\n                            return getSrc(voice);\n                        }\n                    }\n\n                    if (web_page.video_note) {\n                        const { video } = web_page.video_note;\n                        if (video) {\n                            return getSrc(video);\n                        }\n                    }\n                }\n            }\n        }\n\n        return '';\n    };\n\n    handleEnded = (moveNext = true) => {\n        const { message } = this.state;\n        if (!message) return;\n\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateMediaEnding',\n            chatId: message.chat_id,\n            messageId: message.id,\n            moveNext: moveNext\n        });\n\n        this.setState(\n            {\n                //playing: false,\n                //message: null,\n                //src: null\n            },\n            () => {\n                TdLibController.clientUpdate({\n                    '@type': 'clientUpdateMediaEnd',\n                    chatId: message.chat_id,\n                    messageId: message.id,\n                    moveNext: moveNext\n                });\n            }\n        );\n    };\n\n    handleVideoEnded = () => {\n        this.handleEnded(true);\n    };\n\n    handleClose = () => {\n        const player = this.videoRef.current;\n        if (player) {\n            player.pause();\n        }\n\n        this.handleEnded(false);\n    };\n\n    handleTimeUpdate = () => {\n        const { message } = this.state;\n        if (!message) return;\n\n        const player = this.videoRef.current;\n        if (!player) return;\n\n        this.setState({\n            currentTime: player.currentTime,\n            currentTimeString: getDurationString(Math.floor(player.currentTime || 0))\n        });\n\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateMediaTime',\n            chatId: message.chat_id,\n            messageId: message.id,\n            duration: player.duration,\n            currentTime: player.currentTime,\n            timestamp: Date.now()\n        });\n    };\n\n    handleCanPlay = () => {\n        const { message } = this.state;\n        if (!message) return;\n\n        const player = this.videoRef.current;\n        if (!player) return;\n\n        const { playbackRate, volume } = PlayerStore;\n\n        const { chat_id, id } = message;\n        const audio = hasAudio(chat_id, id);\n\n        player.playbackRate = audio ? PLAYER_PLAYBACKRATE_NORMAL : playbackRate;\n        player.volume = volume;\n        player.muted = false;\n\n        if (audio) {\n            return;\n        }\n\n        let stream = null;\n        if ('captureStream' in player) {\n            stream = player.captureStream();\n        } else if ('mozCaptureStream' in player) {\n            stream = player.mozCaptureStream();\n        }\n\n        if (!stream) {\n            return;\n        }\n\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateMediaCaptureStream',\n            chatId: message.chat_id,\n            messageId: message.id,\n            stream: stream\n        });\n    };\n\n    handleVideoPlay = () => {\n        const { message } = this.state;\n        if (!message) return;\n\n        this.setState({\n            playing: true\n        });\n\n        const player = this.videoRef.current;\n        if (!player) return;\n\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateMediaPlay',\n            chatId: message.chat_id,\n            messageId: message.id,\n            currentTime: player.currentTime,\n            duration: player.duration,\n            timestamp: Date.now()\n        });\n    };\n\n    handleVideoPause = () => {\n        const { message } = this.state;\n        if (!message) return;\n\n        this.setState({\n            playing: false\n        });\n\n        const player = this.videoRef.current;\n        if (!player) return;\n\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateMediaPause',\n            chatId: message.chat_id,\n            messageId: message.id\n        });\n    };\n\n    handlePlaybackRate = () => {\n        const { playbackRate } = this.state;\n\n        const nextPlaybackRate =\n            playbackRate === PLAYER_PLAYBACKRATE_NORMAL ? PLAYER_PLAYBACKRATE_FAST : PLAYER_PLAYBACKRATE_NORMAL;\n\n        this.setState(\n            {\n                playbackRate: nextPlaybackRate\n            },\n            () => {\n                const player = this.videoRef.current;\n                if (!player) return;\n\n                player.playbackRate = nextPlaybackRate;\n            }\n        );\n\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateMediaPlaybackRate',\n            playbackRate: nextPlaybackRate\n        });\n    };\n\n    hasPrev = (message, playlist) => {\n        if (!message) return false;\n        if (!playlist || !playlist.messages.length) return false;\n\n        const { chat_id, id } = message;\n\n        const index = playlist.messages.findIndex(x => x.chat_id === chat_id && x.id === id);\n        if (index === -1) return false;\n\n        return index + 1 < playlist.messages.length;\n    };\n\n    hasNext = (message, playlist) => {\n        if (!message) return false;\n        if (!playlist || !playlist.messages.length) return false;\n\n        const { chat_id, id } = message;\n\n        const index = playlist.messages.findIndex(x => x.chat_id === chat_id && x.id === id);\n        if (index === -1) return false;\n\n        return index - 1 >= 0;\n    };\n\n    handleTitleMouseEnter = () => {\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateMediaTitleMouseOver',\n            over: true\n        });\n    };\n\n    handleTitleMouseLeave = () => {\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateMediaTitleMouseOver',\n            over: false\n        });\n    };\n\n    handleTitleClick = () => {\n        const { message } = this.state;\n        if (!message) return;\n\n        openChat(message.chat_id, message.id);\n    };\n\n    render() {\n        const { classes } = this.props;\n        const { playing, message, playlist, src } = this.state;\n\n        let audio = false;\n        if (message) {\n            const { chat_id, id } = message;\n            audio = hasAudio(chat_id, id);\n        }\n\n        const date = message ? message.date : null;\n\n        const title = getMediaTitle(message);\n        const dateHintStr = getDateHint(date);\n        const dateStr = getDate(date);\n        const showDate = !audio;\n        const showPlaybackRate = !audio;\n        const showRepeat = audio;\n        const showShuffle = audio;\n        const hasPrev = this.hasPrev(message, playlist);\n        const hasNext = this.hasNext(message, playlist);\n\n        return (\n            <>\n                <video\n                    className='header-player-video'\n                    ref={this.videoRef}\n                    src={src}\n                    autoPlay={true}\n                    controls={false}\n                    width={44}\n                    height={44}\n                    onCanPlay={this.handleCanPlay}\n                    onPlay={this.handleVideoPlay}\n                    onPause={this.handleVideoPause}\n                    onTimeUpdate={this.handleTimeUpdate}\n                    onEnded={this.handleVideoEnded}\n                />\n                {message && (\n                    <div className={classNames(classes.borderColor, 'header-player')}>\n                        <IconButton\n                            disabled={!hasPrev}\n                            className={classes.iconButton}\n                            color='primary'\n                            onClick={this.handlePrev}>\n                            <SkipPreviousIcon fontSize='small' />\n                        </IconButton>\n                        <IconButton\n                            className={classes.iconButton}\n                            color='primary'\n                            disabled={!src}\n                            onClick={this.handlePlay}>\n                            {playing ? <PauseIcon /> : <PlayArrowIcon />}\n                        </IconButton>\n                        <IconButton\n                            disabled={!hasNext}\n                            className={classes.iconButton}\n                            color='primary'\n                            onClick={this.handleNext}>\n                            <SkipNextIcon fontSize='small' />\n                        </IconButton>\n                        <Playlist />\n                        <div\n                            className='header-player-content'\n                            onMouseEnter={this.handleTitleMouseEnter}\n                            onMouseLeave={this.handleTitleMouseLeave}\n                            onClick={this.handleTitleClick}>\n                            <div className='header-player-title'>\n                                {title}\n                                {showDate && (\n                                    <span title={dateHintStr}>\n                                        &nbsp;\n                                        {dateStr}\n                                    </span>\n                                )}\n                            </div>\n                            &nbsp;\n                            <Time />\n                        </div>\n                        <VolumeButton />\n                        {showPlaybackRate && <PlaybackRateButton />}\n                        {showRepeat && <RepeatButton />}\n                        {showShuffle && <ShuffleButton />}\n                        <IconButton className={classes.iconButton} onClick={this.handleClose}>\n                            <CloseIcon fontSize='small' />\n                        </IconButton>\n                    </div>\n                )}\n            </>\n        );\n    }\n}\n\nconst enhance = compose(\n    withTranslation(),\n    withStyles(styles, { withTheme: true })\n);\n\nexport default enhance(HeaderPlayer);\n"]},"metadata":{},"sourceType":"module"}