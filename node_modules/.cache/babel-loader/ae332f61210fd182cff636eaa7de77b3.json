{"ast":null,"code":"import _defineProperty from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/inherits\";/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */import React from'react';import classNames from'classnames';import{compose}from'recompose';import withStyles from'@material-ui/core/styles/withStyles';import{withTranslation}from'react-i18next';import Button from'@material-ui/core/Button';import Dialog from'@material-ui/core/Dialog';import DialogActions from'@material-ui/core/DialogActions';import DialogContent from'@material-ui/core/DialogContent';import DialogTitle from'@material-ui/core/DialogTitle';import Typography from'@material-ui/core/Typography';import ShareStickerSetButton from'./ShareStickerSetButton';import Sticker,{StickerSourceEnum}from'../Message/Media/Sticker';import StickerPreview from'../ColumnMiddle/StickerPreview';import{loadStickerContent,loadStickerSetContent}from'../../Utils/File';import{STICKER_SMALL_DISPLAY_SIZE}from'../../Constants';import FileStore from'../../Stores/FileStore';import StickerStore from'../../Stores/StickerStore';import TdLibController from'../../Controllers/TdLibController';import'./StickerSetDialog.css';var styles=function styles(theme){return{contentRoot:{display:'flex',flexWrap:'wrap',maxHeight:480,padding:'0 12px 24px',background:'transparent'},paperRoot:{width:344},dialogTitleRoot:{display:'flex',flexDirection:'row',alignItems:'center'},dialogRoot:{color:theme.palette.text.primary},shareButtonRoot:{margin:'-24px -12px -24px 0'},typographyRoot:{flexGrow:1,flexShrink:1},disablePointerEvents:{pointerEvents:'none'}};};var StickerSetDialog=/*#__PURE__*/function(_React$Component){_inherits(StickerSetDialog,_React$Component);function StickerSetDialog(props){var _this;_classCallCheck(this,StickerSetDialog);_this=_possibleConstructorReturn(this,_getPrototypeOf(StickerSetDialog).call(this,props));_this.handleUpdateInstalledStickerSets=function(update){var stickerSet=StickerStore.stickerSet;_this.setState({stickerSet:stickerSet});};_this.handleClientUpdateStickerSet=function(update){var stickerSet=update.stickerSet;_this.setState({stickerSet:stickerSet});if(stickerSet){var store=FileStore.getStore();loadStickerSetContent(store,stickerSet);}};_this.handleClose=function(){TdLibController.clientUpdate({'@type':'clientUpdateStickerSet',stickerSet:null});};_this.handleDone=function(){var stickerSet=_this.state.stickerSet;if(!stickerSet)return;var is_installed=stickerSet.is_installed;TdLibController.send({'@type':'changeStickerSet',set_id:stickerSet.id,is_installed:!is_installed});_this.handleClose();};_this.loadPreviewContent=function(stickerId){var stickerSet=_this.state.stickerSet;var stickers=stickerSet.stickers;var sticker=stickers.find(function(x){return x.sticker.id===stickerId;});if(!sticker)return;var store=FileStore.getStore();loadStickerContent(store,sticker,null);var preloadStickers=_this.getNeighborStickers(stickerId);preloadStickers.forEach(function(x){loadStickerContent(store,x,null);});};_this.getNeighborStickers=function(stickerId){var stickerSet=_this.state.stickerSet;if(!stickerSet)return[];var stickers=stickerSet.stickers;if(!stickers)return[];var indexes=[];var index=stickers.findIndex(function(x){return x.sticker.id===stickerId;});if(index===-1)return[];var STICKERS_PER_ROW=4;var row=Math.floor(index/STICKERS_PER_ROW);var column=index%STICKERS_PER_ROW;var prevRow=row-1;var nextRow=row+1;var prevColumn=column-1;var nextColumn=column+1;if(prevRow>=0){if(prevColumn>=0){indexes.push(STICKERS_PER_ROW*prevRow+prevColumn);}indexes.push(STICKERS_PER_ROW*prevRow+column);if(nextColumn<STICKERS_PER_ROW){indexes.push(STICKERS_PER_ROW*prevRow+nextColumn);}}if(prevColumn>=0){indexes.push(STICKERS_PER_ROW*row+prevColumn);}if(nextColumn<STICKERS_PER_ROW){indexes.push(STICKERS_PER_ROW*row+nextColumn);}if(nextRow<Math.ceil(stickers.length/STICKERS_PER_ROW)){if(prevColumn>=0){indexes.push(STICKERS_PER_ROW*nextRow+prevColumn);}indexes.push(STICKERS_PER_ROW*nextRow+column);if(nextColumn<STICKERS_PER_ROW){indexes.push(STICKERS_PER_ROW*nextRow+nextColumn);}}return indexes.map(function(i){return stickers[i];});};_this.handleMouseUp=function(){var sticker=null;_this.setState({sticker:sticker});TdLibController.clientUpdate({'@type':'clientUpdateStickerPreview',sticker:sticker});_this.mouseDown=false;document.removeEventListener('mouseup',_this.handleMouseUp);};_this.handleMouseEnter=function(event){var stickerId=Number(event.currentTarget.dataset.stickerId);var sticker=_this.getSticker(stickerId);if(!sticker)return;if(!_this.mouseDown)return;_this.setState({sticker:sticker});TdLibController.clientUpdate({'@type':'clientUpdateStickerPreview',sticker:sticker});_this.loadPreviewContent(stickerId);};_this.handleMouseDown=function(event){var stickerId=Number(event.currentTarget.dataset.stickerId);var sticker=_this.getSticker(stickerId);if(!sticker)return;_this.setState({sticker:sticker});TdLibController.clientUpdate({'@type':'clientUpdateStickerPreview',sticker:sticker});_this.loadPreviewContent(stickerId);_this.mouseDown=true;document.addEventListener('mouseup',_this.handleMouseUp);event.preventDefault();event.stopPropagation();return false;};_this.state={stickerSet:StickerStore.stickerSet,stickerId:0};return _this;}_createClass(StickerSetDialog,[{key:\"shouldComponentUpdate\",value:function shouldComponentUpdate(nextProps,nextState,nextContext){var _this$state=this.state,stickerSet=_this$state.stickerSet,sticker=_this$state.sticker;return stickerSet!==nextState.stickerSet||sticker!==nextState.sticker;}},{key:\"componentDidMount\",value:function componentDidMount(){StickerStore.on('clientUpdateStickerSet',this.handleClientUpdateStickerSet);StickerStore.on('updateInstalledStickerSets',this.handleUpdateInstalledStickerSets);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){StickerStore.removeListener('clientUpdateStickerSet',this.handleClientUpdateStickerSet);StickerStore.removeListener('updateInstalledStickerSets',this.handleUpdateInstalledStickerSets);}},{key:\"getSticker\",// handleMouseOver = event => {\n//     const stickerId = Number(event.target.dataset.stickerId);\n//     if (!stickerId) return;\n//\n//     if (!this.mouseDown) return;\n//\n//     this.setState({ stickerId });\n//     this.loadPreviewContent(stickerId);\n// };\n// handleMouseDown = event => {\n//     const stickerId = Number(event.target.dataset.stickerId);\n//     if (!stickerId) return;\n//\n//     this.setState({ stickerId });\n//     this.loadPreviewContent(stickerId);\n//\n//     this.mouseDown = true;\n//     document.addEventListener('mouseup', this.handleMouseUp);\n//\n//     event.preventDefault();\n//     event.stopPropagation();\n//     return false;\n// };\nvalue:function getSticker(stickerId){var stickerSet=this.state.stickerSet;if(!stickerSet)return null;var stickers=stickerSet.stickers;var stickerIndex=stickers.findIndex(function(x){return x.sticker.id===stickerId;});return stickerIndex!==-1?stickers[stickerIndex]:null;}},{key:\"render\",value:function render(){var _this2=this;var _this$props=this.props,t=_this$props.t,classes=_this$props.classes;var _this$state2=this.state,stickerSet=_this$state2.stickerSet,sticker=_this$state2.sticker;if(!stickerSet)return null;var title=stickerSet.title,stickers=stickerSet.stickers,is_installed=stickerSet.is_installed;var items=stickers.map(function(x){return React.createElement(\"div\",{className:\"sticker-set-dialog-item\",key:x.sticker.id,\"data-sticker-id\":x.sticker.id,style:{width:76,height:76},onMouseEnter:_this2.handleMouseEnter,onMouseDown:_this2.handleMouseDown},React.createElement(Sticker,{key:x.sticker.id,className:\"sticker-set-dialog-item-sticker\",sticker:x,autoplay:false,blur:false,displaySize:STICKER_SMALL_DISPLAY_SIZE,preview:true,source:StickerSourceEnum.STICKER_SET}),React.createElement(\"div\",{className:\"sticker-set-dialog-item-emoji\"},x.emoji));});return React.createElement(Dialog,{className:classes.dialogRoot,open:true,transitionDuration:0,onClose:this.handleClose,\"aria-labelledby\":\"sticker-set-dialog-title-text\",classes:{paper:classes.paperRoot}},React.createElement(DialogTitle,{id:\"sticker-set-dialog-title-text\",className:classNames(classes.dialogTitleRoot,_defineProperty({},classes.disablePointerEvents,Boolean(sticker))),disableTypography:true},React.createElement(Typography,{variant:\"h6\",className:classes.typographyRoot,noWrap:true},title),React.createElement(ShareStickerSetButton,{className:classes.shareButtonRoot})),React.createElement(DialogContent,{classes:{root:classes.contentRoot},onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut},items),React.createElement(DialogActions,{className:classNames(_defineProperty({},classes.disablePointerEvents,Boolean(sticker)))},React.createElement(Button,{color:\"primary\",onClick:this.handleClose},t('Cancel')),React.createElement(Button,{color:\"primary\",onClick:this.handleDone},is_installed?t('StickersRemove'):t('Add'))),React.createElement(StickerPreview,{sticker:sticker}));}}]);return StickerSetDialog;}(React.Component);var enhance=compose(withStyles(styles),withTranslation());export default enhance(StickerSetDialog);","map":{"version":3,"sources":["/home/me-admin/Downloads/my-app/src/Components/Popup/StickerSetDialog.js"],"names":["React","classNames","compose","withStyles","withTranslation","Button","Dialog","DialogActions","DialogContent","DialogTitle","Typography","ShareStickerSetButton","Sticker","StickerSourceEnum","StickerPreview","loadStickerContent","loadStickerSetContent","STICKER_SMALL_DISPLAY_SIZE","FileStore","StickerStore","TdLibController","styles","theme","contentRoot","display","flexWrap","maxHeight","padding","background","paperRoot","width","dialogTitleRoot","flexDirection","alignItems","dialogRoot","color","palette","text","primary","shareButtonRoot","margin","typographyRoot","flexGrow","flexShrink","disablePointerEvents","pointerEvents","StickerSetDialog","props","handleUpdateInstalledStickerSets","update","stickerSet","setState","handleClientUpdateStickerSet","store","getStore","handleClose","clientUpdate","handleDone","state","is_installed","send","set_id","id","loadPreviewContent","stickerId","stickers","sticker","find","x","preloadStickers","getNeighborStickers","forEach","indexes","index","findIndex","STICKERS_PER_ROW","row","Math","floor","column","prevRow","nextRow","prevColumn","nextColumn","push","ceil","length","map","i","handleMouseUp","mouseDown","document","removeEventListener","handleMouseEnter","event","Number","currentTarget","dataset","getSticker","handleMouseDown","addEventListener","preventDefault","stopPropagation","nextProps","nextState","nextContext","on","removeListener","stickerIndex","t","classes","title","items","height","STICKER_SET","emoji","paper","Boolean","root","handleMouseOver","handleMouseOut","Component","enhance"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { compose } from 'recompose';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport { withTranslation } from 'react-i18next';\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Typography from '@material-ui/core/Typography';\nimport ShareStickerSetButton from './ShareStickerSetButton';\nimport Sticker, { StickerSourceEnum } from '../Message/Media/Sticker';\nimport StickerPreview from '../ColumnMiddle/StickerPreview';\nimport { loadStickerContent, loadStickerSetContent } from '../../Utils/File';\nimport { STICKER_SMALL_DISPLAY_SIZE } from '../../Constants';\nimport FileStore from '../../Stores/FileStore';\nimport StickerStore from '../../Stores/StickerStore';\nimport TdLibController from '../../Controllers/TdLibController';\nimport './StickerSetDialog.css';\n\nconst styles = theme => ({\n    contentRoot: {\n        display: 'flex',\n        flexWrap: 'wrap',\n        maxHeight: 480,\n        padding: '0 12px 24px',\n        background: 'transparent'\n    },\n    paperRoot: {\n        width: 344\n    },\n    dialogTitleRoot: {\n        display: 'flex',\n        flexDirection: 'row',\n        alignItems: 'center'\n    },\n    dialogRoot: {\n        color: theme.palette.text.primary\n    },\n    shareButtonRoot: {\n        margin: '-24px -12px -24px 0'\n    },\n    typographyRoot: {\n        flexGrow: 1,\n        flexShrink: 1\n    },\n    disablePointerEvents: {\n        pointerEvents: 'none'\n    }\n});\n\nclass StickerSetDialog extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            stickerSet: StickerStore.stickerSet,\n            stickerId: 0\n        };\n    }\n\n    shouldComponentUpdate(nextProps, nextState, nextContext) {\n        const { stickerSet, sticker } = this.state;\n\n        return stickerSet !== nextState.stickerSet || sticker !== nextState.sticker;\n    }\n\n    componentDidMount() {\n        StickerStore.on('clientUpdateStickerSet', this.handleClientUpdateStickerSet);\n        StickerStore.on('updateInstalledStickerSets', this.handleUpdateInstalledStickerSets);\n    }\n\n    componentWillUnmount() {\n        StickerStore.removeListener('clientUpdateStickerSet', this.handleClientUpdateStickerSet);\n        StickerStore.removeListener('updateInstalledStickerSets', this.handleUpdateInstalledStickerSets);\n    }\n\n    handleUpdateInstalledStickerSets = update => {\n        const { stickerSet } = StickerStore;\n\n        this.setState({ stickerSet });\n    };\n\n    handleClientUpdateStickerSet = update => {\n        const { stickerSet } = update;\n\n        this.setState({ stickerSet });\n\n        if (stickerSet) {\n            const store = FileStore.getStore();\n            loadStickerSetContent(store, stickerSet);\n        }\n    };\n\n    handleClose = () => {\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateStickerSet',\n            stickerSet: null\n        });\n    };\n\n    handleDone = () => {\n        const { stickerSet } = this.state;\n        if (!stickerSet) return;\n\n        const { is_installed } = stickerSet;\n\n        TdLibController.send({\n            '@type': 'changeStickerSet',\n            set_id: stickerSet.id,\n            is_installed: !is_installed\n        });\n\n        this.handleClose();\n    };\n\n    loadPreviewContent = stickerId => {\n        const { stickerSet } = this.state;\n        const { stickers } = stickerSet;\n        const sticker = stickers.find(x => x.sticker.id === stickerId);\n        if (!sticker) return;\n\n        const store = FileStore.getStore();\n        loadStickerContent(store, sticker, null);\n\n        const preloadStickers = this.getNeighborStickers(stickerId);\n        preloadStickers.forEach(x => {\n            loadStickerContent(store, x, null);\n        });\n    };\n\n    getNeighborStickers = stickerId => {\n        const { stickerSet } = this.state;\n        if (!stickerSet) return [];\n\n        const { stickers } = stickerSet;\n        if (!stickers) return [];\n\n        const indexes = [];\n        const index = stickers.findIndex(x => x.sticker.id === stickerId);\n        if (index === -1) return [];\n\n        const STICKERS_PER_ROW = 4;\n        const row = Math.floor(index / STICKERS_PER_ROW);\n        const column = index % STICKERS_PER_ROW;\n\n        const prevRow = row - 1;\n        const nextRow = row + 1;\n        const prevColumn = column - 1;\n        const nextColumn = column + 1;\n\n        if (prevRow >= 0) {\n            if (prevColumn >= 0) {\n                indexes.push(STICKERS_PER_ROW * prevRow + prevColumn);\n            }\n            indexes.push(STICKERS_PER_ROW * prevRow + column);\n            if (nextColumn < STICKERS_PER_ROW) {\n                indexes.push(STICKERS_PER_ROW * prevRow + nextColumn);\n            }\n        }\n\n        if (prevColumn >= 0) {\n            indexes.push(STICKERS_PER_ROW * row + prevColumn);\n        }\n        if (nextColumn < STICKERS_PER_ROW) {\n            indexes.push(STICKERS_PER_ROW * row + nextColumn);\n        }\n\n        if (nextRow < Math.ceil(stickers.length / STICKERS_PER_ROW)) {\n            if (prevColumn >= 0) {\n                indexes.push(STICKERS_PER_ROW * nextRow + prevColumn);\n            }\n            indexes.push(STICKERS_PER_ROW * nextRow + column);\n            if (nextColumn < STICKERS_PER_ROW) {\n                indexes.push(STICKERS_PER_ROW * nextRow + nextColumn);\n            }\n        }\n\n        return indexes.map(i => stickers[i]);\n    };\n\n    // handleMouseOver = event => {\n    //     const stickerId = Number(event.target.dataset.stickerId);\n    //     if (!stickerId) return;\n    //\n    //     if (!this.mouseDown) return;\n    //\n    //     this.setState({ stickerId });\n    //     this.loadPreviewContent(stickerId);\n    // };\n\n    // handleMouseDown = event => {\n    //     const stickerId = Number(event.target.dataset.stickerId);\n    //     if (!stickerId) return;\n    //\n    //     this.setState({ stickerId });\n    //     this.loadPreviewContent(stickerId);\n    //\n    //     this.mouseDown = true;\n    //     document.addEventListener('mouseup', this.handleMouseUp);\n    //\n    //     event.preventDefault();\n    //     event.stopPropagation();\n    //     return false;\n    // };\n\n    getSticker(stickerId) {\n        const { stickerSet } = this.state;\n        if (!stickerSet) return null;\n\n        const { stickers } = stickerSet;\n\n        const stickerIndex = stickers.findIndex(x => x.sticker.id === stickerId);\n        return stickerIndex !== -1 ? stickers[stickerIndex] : null;\n    }\n\n    handleMouseUp = () => {\n        const sticker = null;\n        this.setState({ sticker });\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateStickerPreview',\n            sticker\n        });\n        this.mouseDown = false;\n        document.removeEventListener('mouseup', this.handleMouseUp);\n    };\n\n    handleMouseEnter = event => {\n        const stickerId = Number(event.currentTarget.dataset.stickerId);\n        const sticker = this.getSticker(stickerId);\n        if (!sticker) return;\n\n        if (!this.mouseDown) return;\n\n        this.setState({ sticker });\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateStickerPreview',\n            sticker\n        });\n        this.loadPreviewContent(stickerId);\n    };\n\n    handleMouseDown = event => {\n        const stickerId = Number(event.currentTarget.dataset.stickerId);\n        const sticker = this.getSticker(stickerId);\n        if (!sticker) return;\n\n        this.setState({ sticker });\n        TdLibController.clientUpdate({\n            '@type': 'clientUpdateStickerPreview',\n            sticker\n        });\n        this.loadPreviewContent(stickerId);\n\n        this.mouseDown = true;\n        document.addEventListener('mouseup', this.handleMouseUp);\n\n        event.preventDefault();\n        event.stopPropagation();\n        return false;\n    };\n\n    render() {\n        const { t, classes } = this.props;\n        const { stickerSet, sticker } = this.state;\n        if (!stickerSet) return null;\n\n        const { title, stickers, is_installed } = stickerSet;\n\n        const items = stickers.map(x => (\n            <div\n                className='sticker-set-dialog-item'\n                key={x.sticker.id}\n                data-sticker-id={x.sticker.id}\n                style={{ width: 76, height: 76 }}\n                onMouseEnter={this.handleMouseEnter}\n                onMouseDown={this.handleMouseDown}>\n                <Sticker\n                    key={x.sticker.id}\n                    className='sticker-set-dialog-item-sticker'\n                    sticker={x}\n                    autoplay={false}\n                    blur={false}\n                    displaySize={STICKER_SMALL_DISPLAY_SIZE}\n                    preview\n                    source={StickerSourceEnum.STICKER_SET}\n                />\n                <div className='sticker-set-dialog-item-emoji'>{x.emoji}</div>\n            </div>\n        ));\n\n        return (\n            <Dialog\n                className={classes.dialogRoot}\n                open\n                transitionDuration={0}\n                onClose={this.handleClose}\n                aria-labelledby='sticker-set-dialog-title-text'\n                classes={{ paper: classes.paperRoot }}>\n                <DialogTitle\n                    id='sticker-set-dialog-title-text'\n                    className={classNames(classes.dialogTitleRoot, {\n                        [classes.disablePointerEvents]: Boolean(sticker)\n                    })}\n                    disableTypography>\n                    <Typography variant='h6' className={classes.typographyRoot} noWrap>\n                        {title}\n                    </Typography>\n                    <ShareStickerSetButton className={classes.shareButtonRoot} />\n                </DialogTitle>\n                <DialogContent\n                    classes={{ root: classes.contentRoot }}\n                    onMouseOver={this.handleMouseOver}\n                    onMouseOut={this.handleMouseOut}>\n                    {items}\n                </DialogContent>\n                <DialogActions className={classNames({ [classes.disablePointerEvents]: Boolean(sticker) })}>\n                    <Button color='primary' onClick={this.handleClose}>\n                        {t('Cancel')}\n                    </Button>\n                    <Button color='primary' onClick={this.handleDone}>\n                        {is_installed ? t('StickersRemove') : t('Add')}\n                    </Button>\n                </DialogActions>\n                {<StickerPreview sticker={sticker} />}\n            </Dialog>\n        );\n    }\n}\n\nStickerSetDialog.propTypes = {};\n\nconst enhance = compose(\n    withStyles(styles),\n    withTranslation()\n);\n\nexport default enhance(StickerSetDialog);\n"]},"metadata":{},"sourceType":"module"}