{"ast":null,"code":"import _regeneratorRuntime from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/yosuahalim/Documents/Projects/telegram-app/node_modules/@babel/runtime/helpers/esm/inherits\";/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */import React from'react';import classNames from'classnames';import{compose}from'recompose';import{withTranslation}from'react-i18next';import withStyles from'@material-ui/core/styles/withStyles';import Button from'@material-ui/core/Button';import Checkbox from'@material-ui/core/Checkbox/';import Dialog from'@material-ui/core/Dialog';import DialogActions from'@material-ui/core/DialogActions';import DialogContent from'@material-ui/core/DialogContent';import DialogContentText from'@material-ui/core/DialogContentText';import DialogTitle from'@material-ui/core/DialogTitle';import FormControlLabel from'@material-ui/core/FormControlLabel';import MenuItem from'@material-ui/core/MenuItem';import MenuList from'@material-ui/core/MenuList';import Popover from'@material-ui/core/Popover';import AudioAction from'../../Message/Media/AudioAction';import MediaStatus from'../../Message/Media/MediaStatus';import MessageAuthor from'../../Message/MessageAuthor';import VoiceNoteTile from'../VoiceNoteTile';import{getChatShortTitle,isPrivateChat}from'../../../Utils/Chat';import MessageStore from'../../../Stores/MessageStore';import'./SharedVoiceNote.css';import{forwardMessages,openChat}from'../../../Actions/Client';import TdLibController from'../../../Controllers/TdLibController';var styles=function styles(theme){return{voiceNoteMeta:{color:theme.palette.text.secondary}};};var SharedVoiceNote=/*#__PURE__*/function(_React$Component){_inherits(SharedVoiceNote,_React$Component);function SharedVoiceNote(props){var _this;_classCallCheck(this,SharedVoiceNote);_this=_possibleConstructorReturn(this,_getPrototypeOf(SharedVoiceNote).call(this,props));_this.handleOpenMessage=function(event){_this.handleCloseContextMenu(event);var _this$props=_this.props,chatId=_this$props.chatId,messageId=_this$props.messageId;openChat(chatId,messageId);};_this.handleForward=function(event){_this.handleCloseContextMenu(event);var _this$props2=_this.props,chatId=_this$props2.chatId,messageId=_this$props2.messageId;forwardMessages(chatId,[messageId]);};_this.handleDelete=function(event){_this.handleCloseContextMenu(event);var _this$props3=_this.props,chatId=_this$props3.chatId,messageId=_this$props3.messageId;var message=MessageStore.get(chatId,messageId);if(!message)return null;var can_be_deleted_for_all_users=message.can_be_deleted_for_all_users;_this.setState({openDeleteDialog:true,canBeDeletedForAllUsers:can_be_deleted_for_all_users,revoke:can_be_deleted_for_all_users});};_this.handleContextMenu=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var contextMenu,left,top;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(event){event.preventDefault();event.stopPropagation();}contextMenu=_this.state.contextMenu;if(contextMenu){_this.setState({contextMenu:false});}else{left=event.clientX;top=event.clientY;_this.setState({contextMenu:true,left:left,top:top});}case 3:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.handleCloseContextMenu=function(event){if(event){event.stopPropagation();}_this.setState({contextMenu:false});};_this.handleRevokeChange=function(){_this.setState({revoke:!_this.state.revoke});};_this.handleCloseDelete=function(){_this.setState({openDeleteDialog:false});};_this.handleDeleteContinue=function(){var _this$props4=_this.props,chatId=_this$props4.chatId,messageId=_this$props4.messageId;var revoke=_this.state.revoke;_this.handleCloseDelete();TdLibController.send({'@type':'deleteMessages',chat_id:chatId,message_ids:[messageId],revoke:revoke});};_this.state={contextMenu:false,left:0,top:0,openDeleteDialog:false,revoke:false};return _this;}_createClass(SharedVoiceNote,[{key:\"render\",value:function render(){var _this$props5=this.props,chatId=_this$props5.chatId,classes=_this$props5.classes,i18n=_this$props5.i18n,messageId=_this$props5.messageId,voiceNote=_this$props5.voiceNote,openMedia=_this$props5.openMedia,showOpenMessage=_this$props5.showOpenMessage,t=_this$props5.t;var _this$state=this.state,contextMenu=_this$state.contextMenu,left=_this$state.left,top=_this$state.top,openDeleteDialog=_this$state.openDeleteDialog,revoke=_this$state.revoke;if(!voiceNote)return null;var message=MessageStore.get(chatId,messageId);if(!message)return null;var can_be_forwarded=message.can_be_forwarded,can_be_deleted_only_for_self=message.can_be_deleted_only_for_self,can_be_deleted_for_all_users=message.can_be_deleted_for_all_users;var count=1;var date=message.date,sender_user_id=message.sender_user_id;var dateString=new Date(date*1000).toLocaleDateString([i18n.language],{day:'numeric',month:'short',year:'numeric',hour:'numeric',minute:'numeric',hour12:false});var duration=voiceNote.duration,file=voiceNote.voice;return React.createElement(\"div\",{className:\"shared-voice-note\",onContextMenu:this.handleContextMenu},React.createElement(VoiceNoteTile,{chatId:chatId,messageId:messageId,file:file,openMedia:openMedia}),React.createElement(\"div\",{className:\"voice-note-content\"},React.createElement(MessageAuthor,{chatId:chatId,messageId:messageId,userId:sender_user_id}),React.createElement(\"div\",{className:classNames(classes.voiceNoteMeta,'voice-note-meta')},React.createElement(AudioAction,{chatId:chatId,messageId:messageId,duration:duration,file:file,title:\"\".concat(dateString,\", \")}),React.createElement(MediaStatus,{chatId:chatId,messageId:messageId,icon:\"\\xA0\\u2022\"}))),React.createElement(Popover,{open:contextMenu,onClose:this.handleCloseContextMenu,anchorReference:\"anchorPosition\",anchorPosition:{top:top,left:left},anchorOrigin:{vertical:'bottom',horizontal:'right'},transformOrigin:{vertical:'top',horizontal:'left'},onMouseDown:function onMouseDown(e){return e.stopPropagation();}},React.createElement(MenuList,{classes:{root:classes.menuListRoot},onClick:function onClick(e){return e.stopPropagation();}},showOpenMessage&&React.createElement(MenuItem,{onClick:this.handleOpenMessage},t('GoToMessage')),can_be_forwarded&&React.createElement(MenuItem,{onClick:this.handleForward},t('Forward')),(can_be_deleted_only_for_self||can_be_deleted_for_all_users)&&React.createElement(MenuItem,{onClick:this.handleDelete},t('Delete')))),React.createElement(Dialog,{transitionDuration:0,open:openDeleteDialog,onClose:this.handleCloseDelete,\"aria-labelledby\":\"delete-dialog-title\"},React.createElement(DialogTitle,{id:\"delete-dialog-title\"},\"Confirm\"),React.createElement(DialogContent,null,React.createElement(DialogContentText,null,count===1?'Are you sure you want to delete 1 message?':\"Are you sure you want to delete \".concat(count,\" messages?\")),can_be_deleted_for_all_users&&React.createElement(FormControlLabel,{control:React.createElement(Checkbox,{checked:revoke,onChange:this.handleRevokeChange,color:\"primary\"}),label:isPrivateChat(chatId)?\"Delete for \".concat(getChatShortTitle(chatId)):'Delete for all'})),React.createElement(DialogActions,null,React.createElement(Button,{onClick:this.handleCloseDelete,color:\"primary\"},\"Cancel\"),React.createElement(Button,{onClick:this.handleDeleteContinue,color:\"primary\"},\"Ok\"))));}}]);return SharedVoiceNote;}(React.Component);var enhance=compose(withStyles(styles,{withTheme:true}),withTranslation());export default enhance(SharedVoiceNote);","map":{"version":3,"sources":["/Users/yosuahalim/Documents/Projects/telegram-app/src/Components/Tile/SharedMedia/SharedVoiceNote.js"],"names":["React","classNames","compose","withTranslation","withStyles","Button","Checkbox","Dialog","DialogActions","DialogContent","DialogContentText","DialogTitle","FormControlLabel","MenuItem","MenuList","Popover","AudioAction","MediaStatus","MessageAuthor","VoiceNoteTile","getChatShortTitle","isPrivateChat","MessageStore","forwardMessages","openChat","TdLibController","styles","theme","voiceNoteMeta","color","palette","text","secondary","SharedVoiceNote","props","handleOpenMessage","event","handleCloseContextMenu","chatId","messageId","handleForward","handleDelete","message","get","can_be_deleted_for_all_users","setState","openDeleteDialog","canBeDeletedForAllUsers","revoke","handleContextMenu","preventDefault","stopPropagation","contextMenu","state","left","clientX","top","clientY","handleRevokeChange","handleCloseDelete","handleDeleteContinue","send","chat_id","message_ids","classes","i18n","voiceNote","openMedia","showOpenMessage","t","can_be_forwarded","can_be_deleted_only_for_self","count","date","sender_user_id","dateString","Date","toLocaleDateString","language","day","month","year","hour","minute","hour12","duration","file","voice","vertical","horizontal","e","root","menuListRoot","Component","enhance","withTheme"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { compose } from 'recompose';\nimport { withTranslation } from 'react-i18next';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport Button from '@material-ui/core/Button';\nimport Checkbox from '@material-ui/core/Checkbox/';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport MenuList from '@material-ui/core/MenuList';\nimport Popover from '@material-ui/core/Popover';\nimport AudioAction from '../../Message/Media/AudioAction';\nimport MediaStatus from '../../Message/Media/MediaStatus';\nimport MessageAuthor from '../../Message/MessageAuthor';\nimport VoiceNoteTile from '../VoiceNoteTile';\nimport { getChatShortTitle, isPrivateChat } from '../../../Utils/Chat';\nimport MessageStore from '../../../Stores/MessageStore';\nimport './SharedVoiceNote.css';\nimport { forwardMessages, openChat } from '../../../Actions/Client';\nimport TdLibController from '../../../Controllers/TdLibController';\n\nconst styles = theme => ({\n    voiceNoteMeta: {\n        color: theme.palette.text.secondary\n    }\n});\n\nclass SharedVoiceNote extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            contextMenu: false,\n            left: 0,\n            top: 0,\n            openDeleteDialog: false,\n            revoke: false\n        };\n    }\n\n    handleOpenMessage = event => {\n        this.handleCloseContextMenu(event);\n\n        const { chatId, messageId } = this.props;\n\n        openChat(chatId, messageId);\n    };\n\n    handleForward = event => {\n        this.handleCloseContextMenu(event);\n\n        const { chatId, messageId } = this.props;\n\n        forwardMessages(chatId, [messageId]);\n    };\n\n    handleDelete = event => {\n        this.handleCloseContextMenu(event);\n\n        const { chatId, messageId } = this.props;\n\n        const message = MessageStore.get(chatId, messageId);\n        if (!message) return null;\n\n        const { can_be_deleted_for_all_users } = message;\n\n        this.setState({\n            openDeleteDialog: true,\n            canBeDeletedForAllUsers: can_be_deleted_for_all_users,\n            revoke: can_be_deleted_for_all_users\n        });\n    };\n\n    handleContextMenu = async event => {\n        if (event) {\n            event.preventDefault();\n            event.stopPropagation();\n        }\n        const { contextMenu } = this.state;\n\n        if (contextMenu) {\n            this.setState({ contextMenu: false });\n        } else {\n            const left = event.clientX;\n            const top = event.clientY;\n\n            this.setState({\n                contextMenu: true,\n                left,\n                top\n            });\n        }\n    };\n\n    handleCloseContextMenu = event => {\n        if (event) {\n            event.stopPropagation();\n        }\n\n        this.setState({ contextMenu: false });\n    };\n\n    handleRevokeChange = () => {\n        this.setState({ revoke: !this.state.revoke });\n    };\n\n    handleCloseDelete = () => {\n        this.setState({ openDeleteDialog: false });\n    };\n\n    handleDeleteContinue = () => {\n        const { chatId, messageId } = this.props;\n        const { revoke } = this.state;\n\n        this.handleCloseDelete();\n\n        TdLibController.send({\n            '@type': 'deleteMessages',\n            chat_id: chatId,\n            message_ids: [messageId],\n            revoke: revoke\n        });\n    };\n\n    render() {\n        const { chatId, classes, i18n, messageId, voiceNote, openMedia, showOpenMessage, t } = this.props;\n        const { contextMenu, left, top, openDeleteDialog, revoke } = this.state;\n\n        if (!voiceNote) return null;\n\n        const message = MessageStore.get(chatId, messageId);\n        if (!message) return null;\n\n        const { can_be_forwarded, can_be_deleted_only_for_self, can_be_deleted_for_all_users } = message;\n        const count = 1;\n\n        const { date, sender_user_id } = message;\n        const dateString = new Date(date * 1000).toLocaleDateString([i18n.language], {\n            day: 'numeric',\n            month: 'short',\n            year: 'numeric',\n            hour: 'numeric',\n            minute: 'numeric',\n            hour12: false\n        });\n\n        const { duration, voice: file } = voiceNote;\n\n        return (\n            <div className='shared-voice-note' onContextMenu={this.handleContextMenu}>\n                <VoiceNoteTile chatId={chatId} messageId={messageId} file={file} openMedia={openMedia} />\n                <div className='voice-note-content'>\n                    <MessageAuthor chatId={chatId} messageId={messageId} userId={sender_user_id} />\n                    <div className={classNames(classes.voiceNoteMeta, 'voice-note-meta')}>\n                        <AudioAction\n                            chatId={chatId}\n                            messageId={messageId}\n                            duration={duration}\n                            file={file}\n                            title={`${dateString}, `}\n                        />\n                        <MediaStatus chatId={chatId} messageId={messageId} icon={'\\u00A0•'} />\n                    </div>\n                </div>\n                <Popover\n                    open={contextMenu}\n                    onClose={this.handleCloseContextMenu}\n                    anchorReference='anchorPosition'\n                    anchorPosition={{ top, left }}\n                    anchorOrigin={{\n                        vertical: 'bottom',\n                        horizontal: 'right'\n                    }}\n                    transformOrigin={{\n                        vertical: 'top',\n                        horizontal: 'left'\n                    }}\n                    onMouseDown={e => e.stopPropagation()}>\n                    <MenuList classes={{ root: classes.menuListRoot }} onClick={e => e.stopPropagation()}>\n                        {showOpenMessage && <MenuItem onClick={this.handleOpenMessage}>{t('GoToMessage')}</MenuItem>}\n                        {can_be_forwarded && <MenuItem onClick={this.handleForward}>{t('Forward')}</MenuItem>}\n                        {(can_be_deleted_only_for_self || can_be_deleted_for_all_users) && (\n                            <MenuItem onClick={this.handleDelete}>{t('Delete')}</MenuItem>\n                        )}\n                    </MenuList>\n                </Popover>\n                <Dialog\n                    transitionDuration={0}\n                    open={openDeleteDialog}\n                    onClose={this.handleCloseDelete}\n                    aria-labelledby='delete-dialog-title'>\n                    <DialogTitle id='delete-dialog-title'>Confirm</DialogTitle>\n                    <DialogContent>\n                        <DialogContentText>\n                            {count === 1\n                                ? 'Are you sure you want to delete 1 message?'\n                                : `Are you sure you want to delete ${count} messages?`}\n                        </DialogContentText>\n                        {can_be_deleted_for_all_users && (\n                            <FormControlLabel\n                                control={\n                                    <Checkbox checked={revoke} onChange={this.handleRevokeChange} color='primary' />\n                                }\n                                label={\n                                    isPrivateChat(chatId) ? `Delete for ${getChatShortTitle(chatId)}` : 'Delete for all'\n                                }\n                            />\n                        )}\n                    </DialogContent>\n                    <DialogActions>\n                        <Button onClick={this.handleCloseDelete} color='primary'>\n                            Cancel\n                        </Button>\n                        <Button onClick={this.handleDeleteContinue} color='primary'>\n                            Ok\n                        </Button>\n                    </DialogActions>\n                </Dialog>\n            </div>\n        );\n    }\n}\n\nSharedVoiceNote.propTypes = {\n    chatId: PropTypes.number.isRequired,\n    messageId: PropTypes.number.isRequired,\n    voiceNote: PropTypes.object.isRequired,\n\n    openMedia: PropTypes.func\n};\n\nconst enhance = compose(\n    withStyles(styles, { withTheme: true }),\n    withTranslation()\n);\n\nexport default enhance(SharedVoiceNote);\n"]},"metadata":{},"sourceType":"module"}