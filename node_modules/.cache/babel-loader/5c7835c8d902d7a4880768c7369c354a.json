{"ast":null,"code":"import _regeneratorRuntime from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _defineProperty from\"/home/me-admin/Downloads/my-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */import React from'react';import classNames from'classnames';import{compose}from'recompose';import withStyles from'@material-ui/core/styles/withStyles';import{withTranslation}from'react-i18next';import Button from'@material-ui/core/Button';import Checkbox from'@material-ui/core/Checkbox/';import Dialog from'@material-ui/core/Dialog';import DialogActions from'@material-ui/core/DialogActions';import DialogContent from'@material-ui/core/DialogContent';import DialogContentText from'@material-ui/core/DialogContentText';import DialogTitle from'@material-ui/core/DialogTitle';import FormControlLabel from'@material-ui/core/FormControlLabel';import MenuItem from'@material-ui/core/MenuItem';import MenuList from'@material-ui/core/MenuList';import Popover from'@material-ui/core/Popover';import Photo from'../../Message/Media/Photo';import SafeLink from'../../Additional/SafeLink';import{accentStyles}from'../../Theme';import{openMedia,substring}from'../../../Utils/Message';import{getChatShortTitle,isPrivateChat}from'../../../Utils/Chat';import{forwardMessages,openChat}from'../../../Actions/Client';import punycode from'../../../Utils/Punycode';import MessageStore from'../../../Stores/MessageStore';import TdLibController from'../../../Controllers/TdLibController';import'./SharedLink.css';var styles=function styles(theme){return _objectSpread({},accentStyles(theme));};var SharedLink=/*#__PURE__*/function(_React$Component){_inherits(SharedLink,_React$Component);function SharedLink(props){var _this;_classCallCheck(this,SharedLink);_this=_possibleConstructorReturn(this,_getPrototypeOf(SharedLink).call(this,props));_this.handleOpenMessage=function(event){_this.handleCloseContextMenu(event);var _this$props=_this.props,chatId=_this$props.chatId,messageId=_this$props.messageId;openChat(chatId,messageId);};_this.handleForward=function(event){_this.handleCloseContextMenu(event);var _this$props2=_this.props,chatId=_this$props2.chatId,messageId=_this$props2.messageId;forwardMessages(chatId,[messageId]);};_this.handleDelete=function(event){_this.handleCloseContextMenu(event);var _this$props3=_this.props,chatId=_this$props3.chatId,messageId=_this$props3.messageId;var message=MessageStore.get(chatId,messageId);if(!message)return null;var can_be_deleted_for_all_users=message.can_be_deleted_for_all_users;_this.setState({openDeleteDialog:true,canBeDeletedForAllUsers:can_be_deleted_for_all_users,revoke:can_be_deleted_for_all_users});};_this.handleContextMenu=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var contextMenu,left,top;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(event){event.preventDefault();event.stopPropagation();}contextMenu=_this.state.contextMenu;if(contextMenu){_this.setState({contextMenu:false});}else{left=event.clientX;top=event.clientY;_this.setState({contextMenu:true,left:left,top:top});}case 3:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.handleCloseContextMenu=function(event){if(event){event.stopPropagation();}_this.setState({contextMenu:false});};_this.handleRevokeChange=function(){_this.setState({revoke:!_this.state.revoke});};_this.handleCloseDelete=function(){_this.setState({openDeleteDialog:false});};_this.handleDeleteContinue=function(){var _this$props4=_this.props,chatId=_this$props4.chatId,messageId=_this$props4.messageId;var revoke=_this.state.revoke;_this.handleCloseDelete();TdLibController.send({'@type':'deleteMessages',chat_id:chatId,message_ids:[messageId],revoke:revoke});};_this.state={contextMenu:false,left:0,top:0,openDeleteDialog:false,revoke:false};return _this;}_createClass(SharedLink,[{key:\"isValidEntityType\",value:function isValidEntityType(type){if(!type)return false;return type.type['@type']==='textEntityTypeUrl'||type.type['@type']==='textEntityTypeTextUrl'||type.type['@type']==='textEntityTypeEmailAddress';}},{key:\"getTitleFromUrl\",value:function getTitleFromUrl(url){try{url=url.startsWith('http')?url:'http://'+url;var decodedUrl=decodeURI(url);var hostname=new URL(decodedUrl).hostname.split('.');var domain=hostname.length>=2?hostname[hostname.length-2]:new URL(decodedUrl).hostname;console.log('getTitleFromUrl',punycode);return punycode.ToUnicode(domain);}catch(error){console.error('url: '+url+'\\n'+error);}return null;}},{key:\"render\",value:function render(){var _this2=this;var _this$props5=this.props,chatId=_this$props5.chatId,classes=_this$props5.classes,messageId=_this$props5.messageId,webPage=_this$props5.webPage,showOpenMessage=_this$props5.showOpenMessage,t=_this$props5.t;var _this$state=this.state,contextMenu=_this$state.contextMenu,left=_this$state.left,top=_this$state.top,openDeleteDialog=_this$state.openDeleteDialog,revoke=_this$state.revoke;var message=MessageStore.get(chatId,messageId);if(!message)return null;var can_be_forwarded=message.can_be_forwarded,can_be_deleted_only_for_self=message.can_be_deleted_only_for_self,can_be_deleted_for_all_users=message.can_be_deleted_for_all_users;var count=1;var content=null;var _ref2=webPage||{title:'',description:'',photo:null,url:''},display_url=_ref2.display_url,description=_ref2.description,photo=_ref2.photo,title=_ref2.title,url=_ref2.url;if(webPage){title=title||this.getTitleFromUrl(url);content=React.createElement(SafeLink,{className:\"shared-link-url\",url:url},display_url);}else{var text=message.content.text;if(text){var entities=text.entities;if(entities&&entities.length>0){content=entities.filter(this.isValidEntityType).map(function(x){var entityText=substring(text.text,x.offset,x.offset+x.length);var url=entityText;var mail=false;switch(x.type['@type']){case'textEntityTypeTextUrl':{var typeUrl=x.type.url;if(typeUrl){url=typeUrl;}break;}case'textEntityTypeUrl':{break;}case'textEntityTypeEmailAddress':mail=true;break;}title=title||_this2.getTitleFromUrl(url);return React.createElement(SafeLink,{className:\"shared-link-url\",url:url,mail:mail},entityText);});}}}var tileColor=\"tile_color_\".concat(Math.abs(title.charCodeAt(0))%8+1);return React.createElement(\"div\",{className:\"shared-link\",onContextMenu:this.handleContextMenu},React.createElement(\"div\",{className:classNames('shared-link-photo',tileColor)},title.charAt(0),photo&&React.createElement(Photo,{displaySize:90,chatId:chatId,messageId:messageId,photo:photo,openMedia:openMedia,showProgress:false,style:{width:48,height:48,position:'absolute',top:0,left:0}})),React.createElement(\"div\",{className:\"shared-link-content\"},title&&React.createElement(\"div\",{className:\"web-page-title\"},title),description&&React.createElement(\"div\",{className:\"web-page-description\"},description),content),React.createElement(Popover,{open:contextMenu,onClose:this.handleCloseContextMenu,anchorReference:\"anchorPosition\",anchorPosition:{top:top,left:left},anchorOrigin:{vertical:'bottom',horizontal:'right'},transformOrigin:{vertical:'top',horizontal:'left'},onMouseDown:function onMouseDown(e){return e.stopPropagation();}},React.createElement(MenuList,{classes:{root:classes.menuListRoot},onClick:function onClick(e){return e.stopPropagation();}},showOpenMessage&&React.createElement(MenuItem,{onClick:this.handleOpenMessage},t('GoToMessage')),can_be_forwarded&&React.createElement(MenuItem,{onClick:this.handleForward},t('Forward')),(can_be_deleted_only_for_self||can_be_deleted_for_all_users)&&React.createElement(MenuItem,{onClick:this.handleDelete},t('Delete')))),React.createElement(Dialog,{transitionDuration:0,open:openDeleteDialog,onClose:this.handleCloseDelete,\"aria-labelledby\":\"delete-dialog-title\"},React.createElement(DialogTitle,{id:\"delete-dialog-title\"},\"Confirm\"),React.createElement(DialogContent,null,React.createElement(DialogContentText,null,count===1?'Are you sure you want to delete 1 message?':\"Are you sure you want to delete \".concat(count,\" messages?\")),can_be_deleted_for_all_users&&React.createElement(FormControlLabel,{control:React.createElement(Checkbox,{checked:revoke,onChange:this.handleRevokeChange,color:\"primary\"}),label:isPrivateChat(chatId)?\"Delete for \".concat(getChatShortTitle(chatId)):'Delete for all'})),React.createElement(DialogActions,null,React.createElement(Button,{onClick:this.handleCloseDelete,color:\"primary\"},\"Cancel\"),React.createElement(Button,{onClick:this.handleDeleteContinue,color:\"primary\"},\"Ok\"))));}}]);return SharedLink;}(React.Component);var enhance=compose(withStyles(styles,{withTheme:true}),withTranslation());export default enhance(SharedLink);","map":{"version":3,"sources":["/home/me-admin/Downloads/my-app/src/Components/Tile/SharedMedia/SharedLink.js"],"names":["React","classNames","compose","withStyles","withTranslation","Button","Checkbox","Dialog","DialogActions","DialogContent","DialogContentText","DialogTitle","FormControlLabel","MenuItem","MenuList","Popover","Photo","SafeLink","accentStyles","openMedia","substring","getChatShortTitle","isPrivateChat","forwardMessages","openChat","punycode","MessageStore","TdLibController","styles","theme","SharedLink","props","handleOpenMessage","event","handleCloseContextMenu","chatId","messageId","handleForward","handleDelete","message","get","can_be_deleted_for_all_users","setState","openDeleteDialog","canBeDeletedForAllUsers","revoke","handleContextMenu","preventDefault","stopPropagation","contextMenu","state","left","clientX","top","clientY","handleRevokeChange","handleCloseDelete","handleDeleteContinue","send","chat_id","message_ids","type","url","startsWith","decodedUrl","decodeURI","hostname","URL","split","domain","length","console","log","ToUnicode","error","classes","webPage","showOpenMessage","t","can_be_forwarded","can_be_deleted_only_for_self","count","content","title","description","photo","display_url","getTitleFromUrl","text","entities","filter","isValidEntityType","map","x","entityText","offset","mail","typeUrl","tileColor","Math","abs","charCodeAt","charAt","width","height","position","vertical","horizontal","e","root","menuListRoot","Component","enhance","withTheme"],"mappings":"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","sourcesContent":["/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { compose } from 'recompose';\nimport withStyles from '@material-ui/core/styles/withStyles';\nimport { withTranslation } from 'react-i18next';\nimport Button from '@material-ui/core/Button';\nimport Checkbox from '@material-ui/core/Checkbox/';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport MenuList from '@material-ui/core/MenuList';\nimport Popover from '@material-ui/core/Popover';\nimport Photo from '../../Message/Media/Photo';\nimport SafeLink from '../../Additional/SafeLink';\nimport { accentStyles } from '../../Theme';\nimport { openMedia, substring } from '../../../Utils/Message';\nimport { getChatShortTitle, isPrivateChat } from '../../../Utils/Chat';\nimport { forwardMessages, openChat } from '../../../Actions/Client';\nimport punycode from '../../../Utils/Punycode';\nimport MessageStore from '../../../Stores/MessageStore';\nimport TdLibController from '../../../Controllers/TdLibController';\nimport './SharedLink.css';\n\nconst styles = theme => ({\n    ...accentStyles(theme)\n});\n\nclass SharedLink extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            contextMenu: false,\n            left: 0,\n            top: 0,\n            openDeleteDialog: false,\n            revoke: false\n        };\n    }\n\n    handleOpenMessage = event => {\n        this.handleCloseContextMenu(event);\n\n        const { chatId, messageId } = this.props;\n\n        openChat(chatId, messageId);\n    };\n\n    handleForward = event => {\n        this.handleCloseContextMenu(event);\n\n        const { chatId, messageId } = this.props;\n\n        forwardMessages(chatId, [messageId]);\n    };\n\n    handleDelete = event => {\n        this.handleCloseContextMenu(event);\n\n        const { chatId, messageId } = this.props;\n\n        const message = MessageStore.get(chatId, messageId);\n        if (!message) return null;\n\n        const { can_be_deleted_for_all_users } = message;\n\n        this.setState({\n            openDeleteDialog: true,\n            canBeDeletedForAllUsers: can_be_deleted_for_all_users,\n            revoke: can_be_deleted_for_all_users\n        });\n    };\n\n    handleContextMenu = async event => {\n        if (event) {\n            event.preventDefault();\n            event.stopPropagation();\n        }\n        const { contextMenu } = this.state;\n\n        if (contextMenu) {\n            this.setState({ contextMenu: false });\n        } else {\n            const left = event.clientX;\n            const top = event.clientY;\n\n            this.setState({\n                contextMenu: true,\n                left,\n                top\n            });\n        }\n    };\n\n    handleCloseContextMenu = event => {\n        if (event) {\n            event.stopPropagation();\n        }\n\n        this.setState({ contextMenu: false });\n    };\n\n    handleRevokeChange = () => {\n        this.setState({ revoke: !this.state.revoke });\n    };\n\n    handleCloseDelete = () => {\n        this.setState({ openDeleteDialog: false });\n    };\n\n    handleDeleteContinue = () => {\n        const { chatId, messageId } = this.props;\n        const { revoke } = this.state;\n\n        this.handleCloseDelete();\n\n        TdLibController.send({\n            '@type': 'deleteMessages',\n            chat_id: chatId,\n            message_ids: [messageId],\n            revoke: revoke\n        });\n    };\n\n    isValidEntityType(type) {\n        if (!type) return false;\n\n        return (\n            type.type['@type'] === 'textEntityTypeUrl' ||\n            type.type['@type'] === 'textEntityTypeTextUrl' ||\n            type.type['@type'] === 'textEntityTypeEmailAddress'\n        );\n    }\n\n    getTitleFromUrl(url) {\n        try {\n            url = url.startsWith('http') ? url : 'http://' + url;\n            const decodedUrl = decodeURI(url);\n\n            const hostname = new URL(decodedUrl).hostname.split('.');\n            const domain = hostname.length >= 2 ? hostname[hostname.length - 2] : new URL(decodedUrl).hostname;\n\n            console.log('getTitleFromUrl', punycode);\n\n            return punycode.ToUnicode(domain);\n        } catch (error) {\n            console.error('url: ' + url + '\\n' + error);\n        }\n\n        return null;\n    }\n\n    render() {\n        const { chatId, classes, messageId, webPage, showOpenMessage, t } = this.props;\n        const { contextMenu, left, top, openDeleteDialog, revoke } = this.state;\n\n        const message = MessageStore.get(chatId, messageId);\n        if (!message) return null;\n\n        const { can_be_forwarded, can_be_deleted_only_for_self, can_be_deleted_for_all_users } = message;\n        const count = 1;\n\n        let content = null;\n        let { display_url, description, photo, title, url } = webPage || {\n            title: '',\n            description: '',\n            photo: null,\n            url: ''\n        };\n        if (webPage) {\n            title = title || this.getTitleFromUrl(url);\n\n            content = (\n                <SafeLink className='shared-link-url' url={url}>\n                    {display_url}\n                </SafeLink>\n            );\n        } else {\n            const { text } = message.content;\n            if (text) {\n                const { entities } = text;\n                if (entities && entities.length > 0) {\n                    content = entities.filter(this.isValidEntityType).map(x => {\n                        const entityText = substring(text.text, x.offset, x.offset + x.length);\n                        let url = entityText;\n                        let mail = false;\n\n                        switch (x.type['@type']) {\n                            case 'textEntityTypeTextUrl': {\n                                const { url: typeUrl } = x.type;\n                                if (typeUrl) {\n                                    url = typeUrl;\n                                }\n                                break;\n                            }\n                            case 'textEntityTypeUrl': {\n                                break;\n                            }\n                            case 'textEntityTypeEmailAddress':\n                                mail = true;\n                                break;\n                        }\n\n                        title = title || this.getTitleFromUrl(url);\n\n                        return (\n                            <SafeLink className='shared-link-url' url={url} mail={mail}>\n                                {entityText}\n                            </SafeLink>\n                        );\n                    });\n                }\n            }\n        }\n\n        const tileColor = `tile_color_${(Math.abs(title.charCodeAt(0)) % 8) + 1}`;\n\n        return (\n            <div className='shared-link' onContextMenu={this.handleContextMenu}>\n                <div className={classNames('shared-link-photo', tileColor)}>\n                    {title.charAt(0)}\n                    {photo && (\n                        <Photo\n                            displaySize={90}\n                            chatId={chatId}\n                            messageId={messageId}\n                            photo={photo}\n                            openMedia={openMedia}\n                            showProgress={false}\n                            style={{ width: 48, height: 48, position: 'absolute', top: 0, left: 0 }}\n                        />\n                    )}\n                </div>\n                <div className='shared-link-content'>\n                    {title && <div className='web-page-title'>{title}</div>}\n                    {description && <div className='web-page-description'>{description}</div>}\n                    {content}\n                </div>\n                <Popover\n                    open={contextMenu}\n                    onClose={this.handleCloseContextMenu}\n                    anchorReference='anchorPosition'\n                    anchorPosition={{ top, left }}\n                    anchorOrigin={{\n                        vertical: 'bottom',\n                        horizontal: 'right'\n                    }}\n                    transformOrigin={{\n                        vertical: 'top',\n                        horizontal: 'left'\n                    }}\n                    onMouseDown={e => e.stopPropagation()}>\n                    <MenuList classes={{ root: classes.menuListRoot }} onClick={e => e.stopPropagation()}>\n                        {showOpenMessage && <MenuItem onClick={this.handleOpenMessage}>{t('GoToMessage')}</MenuItem>}\n                        {can_be_forwarded && <MenuItem onClick={this.handleForward}>{t('Forward')}</MenuItem>}\n                        {(can_be_deleted_only_for_self || can_be_deleted_for_all_users) && (\n                            <MenuItem onClick={this.handleDelete}>{t('Delete')}</MenuItem>\n                        )}\n                    </MenuList>\n                </Popover>\n                <Dialog\n                    transitionDuration={0}\n                    open={openDeleteDialog}\n                    onClose={this.handleCloseDelete}\n                    aria-labelledby='delete-dialog-title'>\n                    <DialogTitle id='delete-dialog-title'>Confirm</DialogTitle>\n                    <DialogContent>\n                        <DialogContentText>\n                            {count === 1\n                                ? 'Are you sure you want to delete 1 message?'\n                                : `Are you sure you want to delete ${count} messages?`}\n                        </DialogContentText>\n                        {can_be_deleted_for_all_users && (\n                            <FormControlLabel\n                                control={\n                                    <Checkbox checked={revoke} onChange={this.handleRevokeChange} color='primary' />\n                                }\n                                label={\n                                    isPrivateChat(chatId) ? `Delete for ${getChatShortTitle(chatId)}` : 'Delete for all'\n                                }\n                            />\n                        )}\n                    </DialogContent>\n                    <DialogActions>\n                        <Button onClick={this.handleCloseDelete} color='primary'>\n                            Cancel\n                        </Button>\n                        <Button onClick={this.handleDeleteContinue} color='primary'>\n                            Ok\n                        </Button>\n                    </DialogActions>\n                </Dialog>\n            </div>\n        );\n    }\n}\n\nSharedLink.propTypes = {\n    chatId: PropTypes.number.isRequired,\n    messageId: PropTypes.number.isRequired,\n    webPage: PropTypes.object,\n\n    openMedia: PropTypes.func\n};\n\nconst enhance = compose(\n    withStyles(styles, { withTheme: true }),\n    withTranslation()\n);\n\nexport default enhance(SharedLink);\n"]},"metadata":{},"sourceType":"module"}